(function(V,Tt){typeof exports=="object"&&typeof module<"u"?Tt(exports):typeof define=="function"&&define.amd?define(["exports"],Tt):(V=typeof globalThis<"u"?globalThis:V||self,Tt(V["@walletconnect/core"]={}))})(this,function(V){"use strict";var Tt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nf(e){var t=e.default;if(typeof t=="function"){var n=function(){return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var lt={exports:{}},ar=typeof Reflect=="object"?Reflect:null,rf=ar&&typeof ar.apply=="function"?ar.apply:function(t,n,r){return Function.prototype.apply.call(t,n,r)},Ui;ar&&typeof ar.ownKeys=="function"?Ui=ar.ownKeys:Object.getOwnPropertySymbols?Ui=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Ui=function(t){return Object.getOwnPropertyNames(t)};function bp(e){console&&console.warn&&console.warn(e)}var sf=Number.isNaN||function(t){return t!==t};function ae(){ae.init.call(this)}lt.exports=ae,lt.exports.once=Ep,ae.EventEmitter=ae,ae.prototype._events=void 0,ae.prototype._eventsCount=0,ae.prototype._maxListeners=void 0;var of=10;function Fi(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(ae,"defaultMaxListeners",{enumerable:!0,get:function(){return of},set:function(e){if(typeof e!="number"||e<0||sf(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");of=e}}),ae.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ae.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||sf(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function af(e){return e._maxListeners===void 0?ae.defaultMaxListeners:e._maxListeners}ae.prototype.getMaxListeners=function(){return af(this)},ae.prototype.emit=function(t){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=t==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var f=s[t];if(f===void 0)return!1;if(typeof f=="function")rf(f,this,n);else for(var c=f.length,u=hf(f,c),r=0;r<c;++r)rf(u[r],this,n);return!0};function cf(e,t,n,r){var i,s,o;if(Fi(n),s=e._events,s===void 0?(s=e._events=Object.create(null),e._eventsCount=0):(s.newListener!==void 0&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]),o===void 0)o=s[t]=n,++e._eventsCount;else if(typeof o=="function"?o=s[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),i=af(e),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,bp(a)}return e}ae.prototype.addListener=function(t,n){return cf(this,t,n,!1)},ae.prototype.on=ae.prototype.addListener,ae.prototype.prependListener=function(t,n){return cf(this,t,n,!0)};function yp(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ff(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=yp.bind(r);return i.listener=n,r.wrapFn=i,i}ae.prototype.once=function(t,n){return Fi(n),this.on(t,ff(this,t,n)),this},ae.prototype.prependOnceListener=function(t,n){return Fi(n),this.prependListener(t,ff(this,t,n)),this},ae.prototype.removeListener=function(t,n){var r,i,s,o,a;if(Fi(n),i=this._events,i===void 0)return this;if(r=i[t],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||n));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===n||r[o].listener===n){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():mp(r,s),r.length===1&&(i[t]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",t,a||n)}return this},ae.prototype.off=ae.prototype.removeListener,ae.prototype.removeAllListeners=function(t){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var s=Object.keys(r),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[t],typeof n=="function")this.removeListener(t,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(t,n[i]);return this};function uf(e,t,n){var r=e._events;if(r===void 0)return[];var i=r[t];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?wp(i):hf(i,i.length)}ae.prototype.listeners=function(t){return uf(this,t,!0)},ae.prototype.rawListeners=function(t){return uf(this,t,!1)},ae.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):lf.call(e,t)},ae.prototype.listenerCount=lf;function lf(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}ae.prototype.eventNames=function(){return this._eventsCount>0?Ui(this._events):[]};function hf(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function mp(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function wp(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function Ep(e,t){return new Promise(function(n,r){function i(o){e.removeListener(t,s),r(o)}function s(){typeof e.removeListener=="function"&&e.removeListener("error",i),n([].slice.call(arguments))}df(e,t,s,{once:!0}),t!=="error"&&vp(e,i,{once:!0})})}function vp(e,t,n){typeof e.on=="function"&&df(e,"error",t,n)}function df(e,t,n,r){if(typeof e.on=="function")r.once?e.once(t,n):e.on(t,n);else if(typeof e.addEventListener=="function")e.addEventListener(t,function i(s){r.once&&e.removeEventListener(t,i),n(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var W={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var fo=function(e,t){return fo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},fo(e,t)};function _p(e,t){fo(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var uo=function(){return uo=Object.assign||function(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},uo.apply(this,arguments)};function xp(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function Sp(e,t,n,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}function Ip(e,t){return function(n,r){t(n,r,e)}}function Op(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function Bp(e,t,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function f(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,f)}c((r=r.apply(e,t||[])).next())})}function Dp(e,t){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return f([c,u])}}function f(c){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=t.call(e,n)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Ap(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}function Tp(e,t){for(var n in e)n!=="default"&&!t.hasOwnProperty(n)&&(t[n]=e[n])}function lo(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function gf(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,s=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function Rp(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(gf(arguments[t]));return e}function Np(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function Vr(e){return this instanceof Vr?(this.v=e,this):new Vr(e)}function Cp(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(e,t||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(h){r[h]&&(i[h]=function(l){return new Promise(function(b,m){s.push([h,l,b,m])>1||a(h,l)})})}function a(h,l){try{f(r[h](l))}catch(b){d(s[0][3],b)}}function f(h){h.value instanceof Vr?Promise.resolve(h.value.v).then(c,u):d(s[0][2],h)}function c(h){a("next",h)}function u(h){a("throw",h)}function d(h,l){h(l),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Pp(e){var t,n;return t={},r("next"),r("throw",function(i){throw i}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(i,s){t[i]=e[i]?function(o){return(n=!n)?{value:Vr(e[i](o)),done:i==="return"}:s?s(o):o}:s}}function $p(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof lo=="function"?lo(e):e[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=e[s]&&function(o){return new Promise(function(a,f){o=e[s](o),i(a,f,o.done,o.value)})}}function i(s,o,a,f){Promise.resolve(f).then(function(c){s({value:c,done:a})},o)}}function Lp(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function Up(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function Fp(e){return e&&e.__esModule?e:{default:e}}function jp(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function Mp(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n}var kp=Object.freeze({__proto__:null,__extends:_p,get __assign(){return uo},__rest:xp,__decorate:Sp,__param:Ip,__metadata:Op,__awaiter:Bp,__generator:Dp,__createBinding:Ap,__exportStar:Tp,__values:lo,__read:gf,__spread:Rp,__spreadArrays:Np,__await:Vr,__asyncGenerator:Cp,__asyncDelegator:Pp,__asyncValues:$p,__makeTemplateObject:Lp,__importStar:Up,__importDefault:Fp,__classPrivateFieldGet:jp,__classPrivateFieldSet:Mp}),ji=nf(kp),ho={},Kr={},pf;function zp(){if(pf)return Kr;pf=1,Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.delay=void 0;function e(t){return new Promise(n=>{setTimeout(()=>{n(!0)},t)})}return Kr.delay=e,Kr}var Un={},go={},Fn={},bf;function qp(){return bf||(bf=1,Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.ONE_THOUSAND=Fn.ONE_HUNDRED=void 0,Fn.ONE_HUNDRED=100,Fn.ONE_THOUSAND=1e3),Fn}var po={},yf;function Hp(){return yf||(yf=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ONE_YEAR=e.FOUR_WEEKS=e.THREE_WEEKS=e.TWO_WEEKS=e.ONE_WEEK=e.THIRTY_DAYS=e.SEVEN_DAYS=e.FIVE_DAYS=e.THREE_DAYS=e.ONE_DAY=e.TWENTY_FOUR_HOURS=e.TWELVE_HOURS=e.SIX_HOURS=e.THREE_HOURS=e.ONE_HOUR=e.SIXTY_MINUTES=e.THIRTY_MINUTES=e.TEN_MINUTES=e.FIVE_MINUTES=e.ONE_MINUTE=e.SIXTY_SECONDS=e.THIRTY_SECONDS=e.TEN_SECONDS=e.FIVE_SECONDS=e.ONE_SECOND=void 0,e.ONE_SECOND=1,e.FIVE_SECONDS=5,e.TEN_SECONDS=10,e.THIRTY_SECONDS=30,e.SIXTY_SECONDS=60,e.ONE_MINUTE=e.SIXTY_SECONDS,e.FIVE_MINUTES=e.ONE_MINUTE*5,e.TEN_MINUTES=e.ONE_MINUTE*10,e.THIRTY_MINUTES=e.ONE_MINUTE*30,e.SIXTY_MINUTES=e.ONE_MINUTE*60,e.ONE_HOUR=e.SIXTY_MINUTES,e.THREE_HOURS=e.ONE_HOUR*3,e.SIX_HOURS=e.ONE_HOUR*6,e.TWELVE_HOURS=e.ONE_HOUR*12,e.TWENTY_FOUR_HOURS=e.ONE_HOUR*24,e.ONE_DAY=e.TWENTY_FOUR_HOURS,e.THREE_DAYS=e.ONE_DAY*3,e.FIVE_DAYS=e.ONE_DAY*5,e.SEVEN_DAYS=e.ONE_DAY*7,e.THIRTY_DAYS=e.ONE_DAY*30,e.ONE_WEEK=e.SEVEN_DAYS,e.TWO_WEEKS=e.ONE_WEEK*2,e.THREE_WEEKS=e.ONE_WEEK*3,e.FOUR_WEEKS=e.ONE_WEEK*4,e.ONE_YEAR=e.ONE_DAY*365}(po)),po}var mf;function wf(){return mf||(mf=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=ji;t.__exportStar(qp(),e),t.__exportStar(Hp(),e)}(go)),go}var Ef;function Vp(){if(Ef)return Un;Ef=1,Object.defineProperty(Un,"__esModule",{value:!0}),Un.fromMiliseconds=Un.toMiliseconds=void 0;const e=wf();function t(r){return r*e.ONE_THOUSAND}Un.toMiliseconds=t;function n(r){return Math.floor(r/e.ONE_THOUSAND)}return Un.fromMiliseconds=n,Un}var vf;function Kp(){return vf||(vf=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=ji;t.__exportStar(zp(),e),t.__exportStar(Vp(),e)}(ho)),ho}var cr={},_f;function Gp(){if(_f)return cr;_f=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.Watch=void 0;class e{constructor(){this.timestamps=new Map}start(n){if(this.timestamps.has(n))throw new Error(`Watch already started for label: ${n}`);this.timestamps.set(n,{started:Date.now()})}stop(n){const r=this.get(n);if(typeof r.elapsed<"u")throw new Error(`Watch already stopped for label: ${n}`);const i=Date.now()-r.started;this.timestamps.set(n,{started:r.started,elapsed:i})}get(n){const r=this.timestamps.get(n);if(typeof r>"u")throw new Error(`No timestamp found for label: ${n}`);return r}elapsed(n){const r=this.get(n);return r.elapsed||Date.now()-r.started}}return cr.Watch=e,cr.default=e,cr}var bo={},Gr={},xf;function Zp(){if(xf)return Gr;xf=1,Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.IWatch=void 0;class e{}return Gr.IWatch=e,Gr}var Sf;function Yp(){return Sf||(Sf=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),ji.__exportStar(Zp(),e)}(bo)),bo}(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=ji;t.__exportStar(Kp(),e),t.__exportStar(Gp(),e),t.__exportStar(Yp(),e),t.__exportStar(wf(),e)})(W);class jn{}class Wp extends jn{constructor(t){super()}}const If=W.FIVE_SECONDS,Mn={pulse:"heartbeat_pulse"};class yo extends Wp{constructor(t){super(t),this.events=new lt.exports.EventEmitter,this.interval=If,this.interval=t?.interval||If}static async init(t){const n=new yo(t);return await n.init(),n}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(t,n){this.events.on(t,n)}once(t,n){this.events.once(t,n)}off(t,n){this.events.off(t,n)}removeListener(t,n){this.events.removeListener(t,n)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),W.toMiliseconds(this.interval))}pulse(){this.events.emit(Mn.pulse)}}const Xp=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Jp=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Qp=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function eb(e,t){if(e==="__proto__"||e==="constructor"&&t&&typeof t=="object"&&"prototype"in t){tb(e);return}return t}function tb(e){console.warn(`[destr] Dropping "${e}" key to prevent prototype pollution.`)}function Mi(e,t={}){if(typeof e!="string")return e;if(e[0]==='"'&&e[e.length-1]==='"'&&e.indexOf("\\")===-1)return e.slice(1,-1);const n=e.trim();if(n.length<=9)switch(n.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!Qp.test(e)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return e}try{if(Xp.test(e)||Jp.test(e)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(e,eb)}return JSON.parse(e)}catch(r){if(t.strict)throw r;return e}}function nb(e){return!e||typeof e.then!="function"?Promise.resolve(e):e}function ve(e,...t){try{return nb(e(...t))}catch(n){return Promise.reject(n)}}function rb(e){const t=typeof e;return e===null||t!=="object"&&t!=="function"}function ib(e){const t=Object.getPrototypeOf(e);return!t||t.isPrototypeOf(Object)}function ki(e){if(rb(e))return String(e);if(ib(e)||Array.isArray(e))return JSON.stringify(e);if(typeof e.toJSON=="function")return ki(e.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const mo="base64:";function sb(e){return typeof e=="string"?e:mo+cb(e)}function ob(e){return typeof e!="string"||!e.startsWith(mo)?e:ab(e.slice(mo.length))}function ab(e){return globalThis.Buffer?Buffer.from(e,"base64"):Uint8Array.from(globalThis.atob(e),t=>t.codePointAt(0))}function cb(e){return globalThis.Buffer?Buffer.from(e).toString("base64"):globalThis.btoa(String.fromCodePoint(...e))}function Ke(e){return e&&e.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function fb(...e){return Ke(e.join(":"))}function zi(e){return e=Ke(e),e?e+":":""}function ub(e,t){if(t===void 0)return!0;let n=0,r=e.indexOf(":");for(;r>-1;)n++,r=e.indexOf(":",r+1);return n<=t}function lb(e,t){return t?e.startsWith(t)&&e[e.length-1]!=="$":e[e.length-1]!=="$"}function Fx(e){return e}const hb="memory",db=()=>{const e=new Map;return{name:hb,getInstance:()=>e,hasItem(t){return e.has(t)},getItem(t){return e.get(t)??null},getItemRaw(t){return e.get(t)??null},setItem(t,n){e.set(t,n)},setItemRaw(t,n){e.set(t,n)},removeItem(t){e.delete(t)},getKeys(){return[...e.keys()]},clear(){e.clear()},dispose(){e.clear()}}};function gb(e={}){const t={mounts:{"":e.driver||db()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},n=c=>{for(const u of t.mountpoints)if(c.startsWith(u))return{base:u,relativeKey:c.slice(u.length),driver:t.mounts[u]};return{base:"",relativeKey:c,driver:t.mounts[""]}},r=(c,u)=>t.mountpoints.filter(d=>d.startsWith(c)||u&&c.startsWith(d)).map(d=>({relativeBase:c.length>d.length?c.slice(d.length):void 0,mountpoint:d,driver:t.mounts[d]})),i=(c,u)=>{if(t.watching){u=Ke(u);for(const d of t.watchListeners)d(c,u)}},s=async()=>{if(!t.watching){t.watching=!0;for(const c in t.mounts)t.unwatch[c]=await Of(t.mounts[c],i,c)}},o=async()=>{if(t.watching){for(const c in t.unwatch)await t.unwatch[c]();t.unwatch={},t.watching=!1}},a=(c,u,d)=>{const h=new Map,l=b=>{let m=h.get(b.base);return m||(m={driver:b.driver,base:b.base,items:[]},h.set(b.base,m)),m};for(const b of c){const m=typeof b=="string",v=Ke(m?b:b.key),D=m?void 0:b.value,C=m||!b.options?u:{...u,...b.options},x=n(v);l(x).items.push({key:v,value:D,relativeKey:x.relativeKey,options:C})}return Promise.all([...h.values()].map(b=>d(b))).then(b=>b.flat())},f={hasItem(c,u={}){c=Ke(c);const{relativeKey:d,driver:h}=n(c);return ve(h.hasItem,d,u)},getItem(c,u={}){c=Ke(c);const{relativeKey:d,driver:h}=n(c);return ve(h.getItem,d,u).then(l=>Mi(l))},getItems(c,u={}){return a(c,u,d=>d.driver.getItems?ve(d.driver.getItems,d.items.map(h=>({key:h.relativeKey,options:h.options})),u).then(h=>h.map(l=>({key:fb(d.base,l.key),value:Mi(l.value)}))):Promise.all(d.items.map(h=>ve(d.driver.getItem,h.relativeKey,h.options).then(l=>({key:h.key,value:Mi(l)})))))},getItemRaw(c,u={}){c=Ke(c);const{relativeKey:d,driver:h}=n(c);return h.getItemRaw?ve(h.getItemRaw,d,u):ve(h.getItem,d,u).then(l=>ob(l))},async setItem(c,u,d={}){if(u===void 0)return f.removeItem(c);c=Ke(c);const{relativeKey:h,driver:l}=n(c);l.setItem&&(await ve(l.setItem,h,ki(u),d),l.watch||i("update",c))},async setItems(c,u){await a(c,u,async d=>{if(d.driver.setItems)return ve(d.driver.setItems,d.items.map(h=>({key:h.relativeKey,value:ki(h.value),options:h.options})),u);d.driver.setItem&&await Promise.all(d.items.map(h=>ve(d.driver.setItem,h.relativeKey,ki(h.value),h.options)))})},async setItemRaw(c,u,d={}){if(u===void 0)return f.removeItem(c,d);c=Ke(c);const{relativeKey:h,driver:l}=n(c);if(l.setItemRaw)await ve(l.setItemRaw,h,u,d);else if(l.setItem)await ve(l.setItem,h,sb(u),d);else return;l.watch||i("update",c)},async removeItem(c,u={}){typeof u=="boolean"&&(u={removeMeta:u}),c=Ke(c);const{relativeKey:d,driver:h}=n(c);h.removeItem&&(await ve(h.removeItem,d,u),(u.removeMeta||u.removeMata)&&await ve(h.removeItem,d+"$",u),h.watch||i("remove",c))},async getMeta(c,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),c=Ke(c);const{relativeKey:d,driver:h}=n(c),l=Object.create(null);if(h.getMeta&&Object.assign(l,await ve(h.getMeta,d,u)),!u.nativeOnly){const b=await ve(h.getItem,d+"$",u).then(m=>Mi(m));b&&typeof b=="object"&&(typeof b.atime=="string"&&(b.atime=new Date(b.atime)),typeof b.mtime=="string"&&(b.mtime=new Date(b.mtime)),Object.assign(l,b))}return l},setMeta(c,u,d={}){return this.setItem(c+"$",u,d)},removeMeta(c,u={}){return this.removeItem(c+"$",u)},async getKeys(c,u={}){c=zi(c);const d=r(c,!0);let h=[];const l=[];let b=!0;for(const v of d){v.driver.flags?.maxDepth||(b=!1);const D=await ve(v.driver.getKeys,v.relativeBase,u);for(const C of D){const x=v.mountpoint+Ke(C);h.some(_=>x.startsWith(_))||l.push(x)}h=[v.mountpoint,...h.filter(C=>!C.startsWith(v.mountpoint))]}const m=u.maxDepth!==void 0&&!b;return l.filter(v=>(!m||ub(v,u.maxDepth))&&lb(v,c))},async clear(c,u={}){c=zi(c),await Promise.all(r(c,!1).map(async d=>{if(d.driver.clear)return ve(d.driver.clear,d.relativeBase,u);if(d.driver.removeItem){const h=await d.driver.getKeys(d.relativeBase||"",u);return Promise.all(h.map(l=>d.driver.removeItem(l,u)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(c=>Bf(c)))},async watch(c){return await s(),t.watchListeners.push(c),async()=>{t.watchListeners=t.watchListeners.filter(u=>u!==c),t.watchListeners.length===0&&await o()}},async unwatch(){t.watchListeners=[],await o()},mount(c,u){if(c=zi(c),c&&t.mounts[c])throw new Error(`already mounted at ${c}`);return c&&(t.mountpoints.push(c),t.mountpoints.sort((d,h)=>h.length-d.length)),t.mounts[c]=u,t.watching&&Promise.resolve(Of(u,i,c)).then(d=>{t.unwatch[c]=d}).catch(console.error),f},async unmount(c,u=!0){c=zi(c),!(!c||!t.mounts[c])&&(t.watching&&c in t.unwatch&&(t.unwatch[c]?.(),delete t.unwatch[c]),u&&await Bf(t.mounts[c]),t.mountpoints=t.mountpoints.filter(d=>d!==c),delete t.mounts[c])},getMount(c=""){c=Ke(c)+":";const u=n(c);return{driver:u.driver,base:u.base}},getMounts(c="",u={}){return c=Ke(c),r(c,u.parents).map(h=>({driver:h.driver,base:h.mountpoint}))},keys:(c,u={})=>f.getKeys(c,u),get:(c,u={})=>f.getItem(c,u),set:(c,u,d={})=>f.setItem(c,u,d),has:(c,u={})=>f.hasItem(c,u),del:(c,u={})=>f.removeItem(c,u),remove:(c,u={})=>f.removeItem(c,u)};return f}function Of(e,t,n){return e.watch?e.watch((r,i)=>t(r,n+i)):()=>{}}async function Bf(e){typeof e.dispose=="function"&&await ve(e.dispose)}function kn(e){return new Promise((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)})}function Df(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=kn(n);return(i,s)=>r.then(o=>s(o.transaction(t,i).objectStore(t)))}let wo;function Zr(){return wo||(wo=Df("keyval-store","keyval")),wo}function Af(e,t=Zr()){return t("readonly",n=>kn(n.get(e)))}function pb(e,t,n=Zr()){return n("readwrite",r=>(r.put(t,e),kn(r.transaction)))}function bb(e,t=Zr()){return t("readwrite",n=>(n.delete(e),kn(n.transaction)))}function yb(e=Zr()){return e("readwrite",t=>(t.clear(),kn(t.transaction)))}function mb(e,t){return e.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},kn(e.transaction)}function wb(e=Zr()){return e("readonly",t=>{if(t.getAllKeys)return kn(t.getAllKeys());const n=[];return mb(t,r=>n.push(r.key)).then(()=>n)})}const Eb=e=>JSON.stringify(e,(t,n)=>typeof n=="bigint"?n.toString()+"n":n),vb=e=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,n=e.replace(t,'$1"$2n"$3');return JSON.parse(n,(r,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function fr(e){if(typeof e!="string")throw new Error(`Cannot safe json parse value of type ${typeof e}`);try{return vb(e)}catch{return e}}function zn(e){return typeof e=="string"?e:Eb(e)||""}const _b="idb-keyval";var xb=(e={})=>{const t=e.base&&e.base.length>0?`${e.base}:`:"",n=i=>t+i;let r;return e.dbName&&e.storeName&&(r=Df(e.dbName,e.storeName)),{name:_b,options:e,async hasItem(i){return!(typeof await Af(n(i),r)>"u")},async getItem(i){return await Af(n(i),r)??null},setItem(i,s){return pb(n(i),s,r)},removeItem(i){return bb(n(i),r)},getKeys(){return wb(r)},clear(){return yb(r)}}};const Sb="WALLET_CONNECT_V2_INDEXED_DB",Ib="keyvaluestorage";class Ob{constructor(){this.indexedDb=gb({driver:xb({dbName:Sb,storeName:Ib})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const n=await this.indexedDb.getItem(t);if(n!==null)return n}async setItem(t,n){await this.indexedDb.setItem(t,zn(n))}async removeItem(t){await this.indexedDb.removeItem(t)}}var Eo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},qi={exports:{}};(function(){let e;function t(){}e=t,e.prototype.getItem=function(n){return this.hasOwnProperty(n)?String(this[n]):null},e.prototype.setItem=function(n,r){this[n]=String(r)},e.prototype.removeItem=function(n){delete this[n]},e.prototype.clear=function(){const n=this;Object.keys(n).forEach(function(r){n[r]=void 0,delete n[r]})},e.prototype.key=function(n){return n=n||0,Object.keys(this)[n]},e.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Eo<"u"&&Eo.localStorage?qi.exports=Eo.localStorage:typeof window<"u"&&window.localStorage?qi.exports=window.localStorage:qi.exports=new t})();function Bb(e){var t;return[e[0],fr((t=e[1])!=null?t:"")]}class Db{constructor(){this.localStorage=qi.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Bb)}async getItem(t){const n=this.localStorage.getItem(t);if(n!==null)return fr(n)}async setItem(t,n){this.localStorage.setItem(t,zn(n))}async removeItem(t){this.localStorage.removeItem(t)}}const Ab="wc_storage_version",Tf=1,Tb=async(e,t,n)=>{const r=Ab,i=await t.getItem(r);if(i&&i>=Tf){n(t);return}const s=await e.getKeys();if(!s.length){n(t);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const f=a.toLowerCase();if(f.includes("wc@")||f.includes("walletconnect")||f.includes("wc_")||f.includes("wallet_connect")){const c=await e.getItem(a);await t.setItem(a,c),o.push(a)}}await t.setItem(r,Tf),n(t),Rb(e,o)},Rb=async(e,t)=>{t.length&&t.forEach(async n=>{await e.removeItem(n)})};class Nb{constructor(){this.initialized=!1,this.setInitialized=n=>{this.storage=n,this.initialized=!0};const t=new Db;this.storage=t;try{const n=new Ob;Tb(t,n,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,n){return await this.initialize(),this.storage.setItem(t,n)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const n=setInterval(()=>{this.initialized&&(clearInterval(n),t())},20)})}}var Rt={exports:{}};function Cb(e){try{return JSON.stringify(e)}catch{return'"[Circular]"'}}var Pb=$b;function $b(e,t,n){var r=n&&n.stringify||Cb,i=1;if(typeof e=="object"&&e!==null){var s=t.length+i;if(s===1)return e;var o=new Array(s);o[0]=r(e);for(var a=1;a<s;a++)o[a]=r(t[a]);return o.join(" ")}if(typeof e!="string")return e;var f=t.length;if(f===0)return e;for(var c="",u=1-i,d=-1,h=e&&e.length||0,l=0;l<h;){if(e.charCodeAt(l)===37&&l+1<h){switch(d=d>-1?d:0,e.charCodeAt(l+1)){case 100:case 102:if(u>=f||t[u]==null)break;d<l&&(c+=e.slice(d,l)),c+=Number(t[u]),d=l+2,l++;break;case 105:if(u>=f||t[u]==null)break;d<l&&(c+=e.slice(d,l)),c+=Math.floor(Number(t[u])),d=l+2,l++;break;case 79:case 111:case 106:if(u>=f||t[u]===void 0)break;d<l&&(c+=e.slice(d,l));var b=typeof t[u];if(b==="string"){c+="'"+t[u]+"'",d=l+2,l++;break}if(b==="function"){c+=t[u].name||"<anonymous>",d=l+2,l++;break}c+=r(t[u]),d=l+2,l++;break;case 115:if(u>=f)break;d<l&&(c+=e.slice(d,l)),c+=String(t[u]),d=l+2,l++;break;case 37:d<l&&(c+=e.slice(d,l)),c+="%",d=l+2,l++,u--;break}++u}++l}return d===-1?e:(d<h&&(c+=e.slice(d)),c)}const Rf=Pb;Rt.exports=jt;const Yr=Wb().console||{},Lb={mapHttpRequest:Hi,mapHttpResponse:Hi,wrapRequestSerializer:Io,wrapResponseSerializer:Io,wrapErrorSerializer:Io,req:Hi,res:Hi,err:Cf,errWithCause:Cf};function un(e,t){return e==="silent"?1/0:t.levels.values[e]}const vo=Symbol("pino.logFuncs"),_o=Symbol("pino.hierarchy"),Ub={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function Nf(e,t){const n={logger:t,parent:e[_o]};t[_o]=n}function Fb(e,t,n){const r={};t.forEach(i=>{r[i]=n[i]?n[i]:Yr[i]||Yr[Ub[i]||"log"]||ur}),e[vo]=r}function jb(e,t){return Array.isArray(e)?e.filter(function(r){return r!=="!stdSerializers.err"}):e===!0?Object.keys(t):!1}function jt(e){e=e||{},e.browser=e.browser||{};const t=e.browser.transmit;if(t&&typeof t.send!="function")throw Error("pino: transmit option must have a send function");const n=e.browser.write||Yr;e.browser.write&&(e.browser.asObject=!0);const r=e.serializers||{},i=jb(e.browser.serialize,r);let s=e.browser.serialize;Array.isArray(e.browser.serialize)&&e.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=Object.keys(e.customLevels||{}),a=["error","fatal","warn","info","debug","trace"].concat(o);typeof n=="function"&&a.forEach(function(m){n[m]=n}),(e.enabled===!1||e.browser.disabled)&&(e.level="silent");const f=e.level||"info",c=Object.create(n);c.log||(c.log=ur),Fb(c,a,n),Nf({},c),Object.defineProperty(c,"levelVal",{get:d}),Object.defineProperty(c,"level",{get:h,set:l});const u={transmit:t,serialize:i,asObject:e.browser.asObject,asObjectBindingsOnly:e.browser.asObjectBindingsOnly,formatters:e.browser.formatters,levels:a,timestamp:Gb(e),messageKey:e.messageKey||"msg",onChild:e.onChild||ur};c.levels=Mb(e),c.level=f,c.isLevelEnabled=function(m){return this.levels.values[m]?this.levels.values[m]>=this.levels.values[this.level]:!1},c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=ur,c.serializers=r,c._serialize=i,c._stdErrSerialize=s,c.child=function(...m){return b.call(this,u,...m)},t&&(c._logEvent=So());function d(){return un(this.level,this)}function h(){return this._level}function l(m){if(m!=="silent"&&!this.levels.values[m])throw Error("unknown level "+m);this._level=m,qn(this,u,c,"error"),qn(this,u,c,"fatal"),qn(this,u,c,"warn"),qn(this,u,c,"info"),qn(this,u,c,"debug"),qn(this,u,c,"trace"),o.forEach(v=>{qn(this,u,c,v)})}function b(m,v,D){if(!v)throw new Error("missing bindings for child Pino");D=D||{},i&&v.serializers&&(D.serializers=v.serializers);const C=D.serializers;if(i&&C){var x=Object.assign({},r,C),_=e.browser.serialize===!0?Object.keys(x):i;delete v.serializers,xo([v],_,x,this._stdErrSerialize)}function R(F){this._childLevel=(F._childLevel|0)+1,this.bindings=v,x&&(this.serializers=x,this._serialize=_),t&&(this._logEvent=So([].concat(F._logEvent.bindings,v)))}R.prototype=this;const $=new R(this);return Nf(this,$),$.child=function(...F){return b.call(this,m,...F)},$.level=D.level||this.level,m.onChild($),$}return c}function Mb(e){const t=e.customLevels||{},n=Object.assign({},jt.levels.values,t),r=Object.assign({},jt.levels.labels,kb(t));return{values:n,labels:r}}function kb(e){const t={};return Object.keys(e).forEach(function(n){t[e[n]]=n}),t}jt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},jt.stdSerializers=Lb,jt.stdTimeFunctions=Object.assign({},{nullTime:Pf,epochTime:$f,unixTime:Zb,isoTime:Yb});function zb(e){const t=[];e.bindings&&t.push(e.bindings);let n=e[_o];for(;n.parent;)n=n.parent,n.logger.bindings&&t.push(n.logger.bindings);return t.reverse()}function qn(e,t,n,r){if(Object.defineProperty(e,r,{value:un(e.level,n)>un(r,n)?ur:n[vo][r],writable:!0,enumerable:!0,configurable:!0}),e[r]===ur){if(!t.transmit)return;const s=t.transmit.level||e.level,o=un(s,n);if(un(r,n)<o)return}e[r]=Hb(e,t,n,r);const i=zb(e);i.length!==0&&(e[r]=qb(i,e[r]))}function qb(e,t){return function(){return t.apply(this,[...e,...arguments])}}function Hb(e,t,n,r){return function(i){return function(){const o=t.timestamp(),a=new Array(arguments.length),f=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Yr?Yr:this;for(var c=0;c<a.length;c++)a[c]=arguments[c];var u=!1;if(t.serialize&&(xo(a,this._serialize,this.serializers,this._stdErrSerialize),u=!0),t.asObject||t.formatters?i.call(f,...Vb(this,r,a,o,t)):i.apply(f,a),t.transmit){const d=t.transmit.level||e._level,h=un(d,n),l=un(r,n);if(l<h)return;Kb(this,{ts:o,methodLevel:r,methodValue:l,transmitLevel:d,transmitValue:n.levels.values[t.transmit.level||e._level],send:t.transmit.send,val:un(e._level,n)},a,u)}}}(e[vo][r])}function Vb(e,t,n,r,i){const{level:s,log:o=d=>d}=i.formatters||{},a=n.slice();let f=a[0];const c={};let u=(e._childLevel|0)+1;if(u<1&&(u=1),r&&(c.time=r),s){const d=s(t,e.levels.values[t]);Object.assign(c,d)}else c.level=e.levels.values[t];if(i.asObjectBindingsOnly){if(f!==null&&typeof f=="object")for(;u--&&typeof a[0]=="object";)Object.assign(c,a.shift());return[o(c),...a]}else{if(f!==null&&typeof f=="object"){for(;u--&&typeof a[0]=="object";)Object.assign(c,a.shift());f=a.length?Rf(a.shift(),a):void 0}else typeof f=="string"&&(f=Rf(a.shift(),a));return f!==void 0&&(c[i.messageKey]=f),[o(c)]}}function xo(e,t,n,r){for(const i in e)if(r&&e[i]instanceof Error)e[i]=jt.stdSerializers.err(e[i]);else if(typeof e[i]=="object"&&!Array.isArray(e[i])&&t)for(const s in e[i])t.indexOf(s)>-1&&s in n&&(e[i][s]=n[s](e[i][s]))}function Kb(e,t,n,r=!1){const i=t.send,s=t.ts,o=t.methodLevel,a=t.methodValue,f=t.val,c=e._logEvent.bindings;r||xo(n,e._serialize||Object.keys(e.serializers),e.serializers,e._stdErrSerialize===void 0?!0:e._stdErrSerialize),e._logEvent.ts=s,e._logEvent.messages=n.filter(function(u){return c.indexOf(u)===-1}),e._logEvent.level.label=o,e._logEvent.level.value=a,i(o,e._logEvent,f),e._logEvent=So(c)}function So(e){return{ts:0,messages:[],bindings:e||[],level:{label:"",value:0}}}function Cf(e){const t={type:e.constructor.name,msg:e.message,stack:e.stack};for(const n in e)t[n]===void 0&&(t[n]=e[n]);return t}function Gb(e){return typeof e.timestamp=="function"?e.timestamp:e.timestamp===!1?Pf:$f}function Hi(){return{}}function Io(e){return e}function ur(){}function Pf(){return!1}function $f(){return Date.now()}function Zb(){return Math.round(Date.now()/1e3)}function Yb(){return new Date(Date.now()).toISOString()}function Wb(){function e(t){return typeof t<"u"&&t}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return e(self)||e(window)||e(this)||{}}}Rt.exports.default=jt,Rt.exports.pino=jt;const Xb={level:"info"},Vi="custom_context",Oo=1e3*1024;var Jb=Object.defineProperty,Qb=(e,t,n)=>t in e?Jb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ln=(e,t,n)=>Qb(e,typeof t!="symbol"?t+"":t,n);class e1{constructor(t){ln(this,"nodeValue"),ln(this,"sizeInBytes"),ln(this,"next"),this.nodeValue=t,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class Lf{constructor(t){ln(this,"lengthInNodes"),ln(this,"sizeInBytes"),ln(this,"head"),ln(this,"tail"),ln(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=t,this.sizeInBytes=0}append(t){const n=new e1(t);if(n.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${t} with size ${n.size}`);for(;this.size+n.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=n),this.tail=n):(this.head=n,this.tail=n),this.lengthInNodes++,this.sizeInBytes+=n.size}shift(){if(!this.head)return;const t=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=t.size}toArray(){const t=[];let n=this.head;for(;n!==null;)t.push(n.value),n=n.next;return t}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let t=this.head;return{next:()=>{if(!t)return{done:!0,value:null};const n=t.value;return t=t.next,{done:!1,value:n}}}}}var t1=Object.defineProperty,n1=(e,t,n)=>t in e?t1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ki=(e,t,n)=>n1(e,typeof t!="symbol"?t+"":t,n);class Uf{constructor(t,n=Oo){Ki(this,"logs"),Ki(this,"level"),Ki(this,"levelValue"),Ki(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=t??"error",this.levelValue=Rt.exports.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=n,this.logs=new Lf(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(t,n){n===Rt.exports.levels.values.error?console.error(t):n===Rt.exports.levels.values.warn?console.warn(t):n===Rt.exports.levels.values.debug?console.debug(t):n===Rt.exports.levels.values.trace?console.trace(t):console.log(t)}appendToLogs(t){this.logs.append(zn({timestamp:new Date().toISOString(),log:t}));const n=typeof t=="string"?JSON.parse(t).level:t.level;n>=this.levelValue&&this.forwardToConsole(t,n)}getLogs(){return this.logs}clearLogs(){this.logs=new Lf(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(t){const n=this.getLogArray();return n.push(zn({extraMetadata:t})),new Blob(n,{type:"application/json"})}}var r1=Object.defineProperty,i1=(e,t,n)=>t in e?r1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,s1=(e,t,n)=>i1(e,typeof t!="symbol"?t+"":t,n);class o1{constructor(t,n=Oo){s1(this,"baseChunkLogger"),this.baseChunkLogger=new Uf(t,n)}write(t){this.baseChunkLogger.appendToLogs(t)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(t){return this.baseChunkLogger.logsToBlob(t)}downloadLogsBlobInBrowser(t){const n=URL.createObjectURL(this.logsToBlob(t)),r=document.createElement("a");r.href=n,r.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}}var a1=Object.defineProperty,c1=(e,t,n)=>t in e?a1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,f1=(e,t,n)=>c1(e,typeof t!="symbol"?t+"":t,n);class u1{constructor(t,n=Oo){f1(this,"baseChunkLogger"),this.baseChunkLogger=new Uf(t,n)}write(t){this.baseChunkLogger.appendToLogs(t)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(t){return this.baseChunkLogger.logsToBlob(t)}}var l1=Object.defineProperty,h1=Object.defineProperties,d1=Object.getOwnPropertyDescriptors,Ff=Object.getOwnPropertySymbols,g1=Object.prototype.hasOwnProperty,p1=Object.prototype.propertyIsEnumerable,jf=(e,t,n)=>t in e?l1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Gi=(e,t)=>{for(var n in t||(t={}))g1.call(t,n)&&jf(e,n,t[n]);if(Ff)for(var n of Ff(t))p1.call(t,n)&&jf(e,n,t[n]);return e},Zi=(e,t)=>h1(e,d1(t));function b1(e){return Zi(Gi({},e),{level:e?.level||Xb.level})}function y1(e,t,n=Vi){return e[n]=t,e}function rt(e,t=Vi){return e[t]||""}function m1(e,t,n=Vi){const r=rt(e,n);return r.trim()?`${r}/${t}`:t}function it(e,t,n=Vi){const r=m1(e,t,n),i=e.child({context:r});return y1(i,r,n)}function w1(e){var t,n;const r=new o1((t=e.opts)==null?void 0:t.level,e.maxSizeInBytes);return{logger:Rt.exports(Zi(Gi({},e.opts),{level:"trace",browser:Zi(Gi({},(n=e.opts)==null?void 0:n.browser),{write:i=>r.write(i)})})),chunkLoggerController:r}}function E1(e){var t;const n=new u1((t=e.opts)==null?void 0:t.level,e.maxSizeInBytes);return{logger:Rt.exports(Zi(Gi({},e.opts),{level:"trace"}),n),chunkLoggerController:n}}function Mf(e){return typeof e.loggerOverride<"u"&&typeof e.loggerOverride!="string"?{logger:e.loggerOverride,chunkLoggerController:null}:typeof window<"u"?w1(e):E1(e)}var v1=Object.defineProperty,_1=(e,t,n)=>t in e?v1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,kf=(e,t,n)=>_1(e,typeof t!="symbol"?t+"":t,n);class x1 extends jn{constructor(t){super(),this.opts=t,kf(this,"protocol","wc"),kf(this,"version",2)}}var S1=Object.defineProperty,I1=(e,t,n)=>t in e?S1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,O1=(e,t,n)=>I1(e,typeof t!="symbol"?t+"":t,n);class B1 extends jn{constructor(t,n){super(),this.core=t,this.logger=n,O1(this,"records",new Map)}}class D1{constructor(t,n){this.logger=t,this.core=n}}class A1 extends jn{constructor(t,n){super(),this.relayer=t,this.logger=n}}class T1 extends jn{constructor(t){super()}}class R1{constructor(t,n,r,i){this.core=t,this.logger=n,this.name=r}}class N1 extends jn{constructor(t,n){super(),this.relayer=t,this.logger=n}}class C1 extends jn{constructor(t,n){super(),this.core=t,this.logger=n}}class P1{constructor(t,n,r){this.core=t,this.logger=n,this.store=r}}class $1{constructor(t,n){this.projectId=t,this.logger=n}}class L1{constructor(t,n,r){this.core=t,this.logger=n,this.telemetryEnabled=r}}const Bo="wc",Do=2,Wr="core",Et=`${Bo}@2:${Wr}:`,zf={name:Wr,logger:"error"},qf={database:":memory:"},Hf="crypto",Ao="client_ed25519_seed",Vf=W.ONE_DAY,Kf="keychain",Gf="0.3",Zf="messages",Yf="0.3",Wf=W.SIX_HOURS,Xf="publisher",Jf="irn",Qf="error",To="wss://relay.walletconnect.org",eu="relayer",be={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},tu="_subscription",st={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},nu=.1,U1={database:":memory:"},Yi="2.23.0",F1=1e4,Hn={link_mode:"link_mode",relay:"relay"},Xr={inbound:"inbound",outbound:"outbound"},ru="0.3",iu="WALLETCONNECT_CLIENT_ID",Ro="WALLETCONNECT_LINK_MODE_APPS",Ge={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},j1=W.THIRTY_DAYS,su="subscription",ou="0.3",M1=W.FIVE_SECONDS*1e3,au="pairing",cu="0.3",k1=W.THIRTY_DAYS,lr={wc_pairingDelete:{req:{ttl:W.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:W.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:W.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:W.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:W.ONE_DAY,prompt:!1,tag:0},res:{ttl:W.ONE_DAY,prompt:!1,tag:0}}},hr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},ht={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},fu="history",uu="0.3",lu="expirer",dt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},hu="0.3",z1=W.ONE_DAY,du="verify-api",q1="https://verify.walletconnect.com",gu="https://verify.walletconnect.org",Jr=gu,pu=`${Jr}/v3`,bu=[q1,gu],yu="echo",mu="https://echo.walletconnect.com",H1="event-client",Nt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Mt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},V1={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},K1={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},G1={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},Z1={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},wu=.1,Eu="event-client",vu=86400,_u="https://pulse.walletconnect.org/batch";function Y1(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function xu(e,...t){if(!Y1(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Su(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function W1(e,t){xu(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}const dr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const No=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);function X1(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))}function Iu(e){return typeof e=="string"&&(e=X1(e)),xu(e),e}class J1{clone(){return this._cloneInto()}}function Q1(e){const t=r=>e().update(Iu(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Ou(e=32){if(dr&&typeof dr.getRandomValues=="function")return dr.getRandomValues(new Uint8Array(e));if(dr&&typeof dr.randomBytes=="function")return dr.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}function ey(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),f=r?4:0,c=r?0:4;e.setUint32(t+f,o,r),e.setUint32(t+c,a,r)}class ty extends J1{constructor(t,n,r,i){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=No(this.buffer)}update(t){Su(this);const{view:n,buffer:r,blockLen:i}=this;t=Iu(t);const s=t.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const f=No(t);for(;i<=s-o;o+=i)this.process(f,o);continue}r.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Su(this),W1(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;ey(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=No(t),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=f/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return t.length=i,t.pos=a,t.finished=s,t.destroyed=o,i%n&&t.buffer.set(r),t}}const Wi=BigInt(2**32-1),Co=BigInt(32);function Bu(e,t=!1){return t?{h:Number(e&Wi),l:Number(e>>Co&Wi)}:{h:Number(e>>Co&Wi)|0,l:Number(e&Wi)|0}}function ny(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let i=0;i<e.length;i++){const{h:s,l:o}=Bu(e[i],t);[n[i],r[i]]=[s,o]}return[n,r]}const ry=(e,t)=>BigInt(e>>>0)<<Co|BigInt(t>>>0),iy=(e,t,n)=>e>>>n,sy=(e,t,n)=>e<<32-n|t>>>n,oy=(e,t,n)=>e>>>n|t<<32-n,ay=(e,t,n)=>e<<32-n|t>>>n,cy=(e,t,n)=>e<<64-n|t>>>n-32,fy=(e,t,n)=>e>>>n-32|t<<64-n,uy=(e,t)=>t,ly=(e,t)=>e,hy=(e,t,n)=>e<<n|t>>>32-n,dy=(e,t,n)=>t<<n|e>>>32-n,gy=(e,t,n)=>t<<n-32|e>>>64-n,py=(e,t,n)=>e<<n-32|t>>>64-n;function by(e,t,n,r){const i=(t>>>0)+(r>>>0);return{h:e+n+(i/2**32|0)|0,l:i|0}}const yy=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),my=(e,t,n,r)=>t+n+r+(e/2**32|0)|0,wy=(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),Ey=(e,t,n,r,i)=>t+n+r+i+(e/2**32|0)|0,vy=(e,t,n,r,i)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(i>>>0),_y=(e,t,n,r,i,s)=>t+n+r+i+s+(e/2**32|0)|0,Q={fromBig:Bu,split:ny,toBig:ry,shrSH:iy,shrSL:sy,rotrSH:oy,rotrSL:ay,rotrBH:cy,rotrBL:fy,rotr32H:uy,rotr32L:ly,rotlSH:hy,rotlSL:dy,rotlBH:gy,rotlBL:py,add:by,add3L:yy,add3H:my,add4L:wy,add4H:Ey,add5H:_y,add5L:vy},[xy,Sy]=Q.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),hn=new Uint32Array(80),dn=new Uint32Array(80);class Iy extends ty{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:f,Eh:c,El:u,Fh:d,Fl:h,Gh:l,Gl:b,Hh:m,Hl:v}=this;return[t,n,r,i,s,o,a,f,c,u,d,h,l,b,m,v]}set(t,n,r,i,s,o,a,f,c,u,d,h,l,b,m,v){this.Ah=t|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=f|0,this.Eh=c|0,this.El=u|0,this.Fh=d|0,this.Fl=h|0,this.Gh=l|0,this.Gl=b|0,this.Hh=m|0,this.Hl=v|0}process(t,n){for(let x=0;x<16;x++,n+=4)hn[x]=t.getUint32(n),dn[x]=t.getUint32(n+=4);for(let x=16;x<80;x++){const _=hn[x-15]|0,R=dn[x-15]|0,$=Q.rotrSH(_,R,1)^Q.rotrSH(_,R,8)^Q.shrSH(_,R,7),F=Q.rotrSL(_,R,1)^Q.rotrSL(_,R,8)^Q.shrSL(_,R,7),U=hn[x-2]|0,A=dn[x-2]|0,q=Q.rotrSH(U,A,19)^Q.rotrBH(U,A,61)^Q.shrSH(U,A,6),k=Q.rotrSL(U,A,19)^Q.rotrBL(U,A,61)^Q.shrSL(U,A,6),E=Q.add4L(F,k,dn[x-7],dn[x-16]),p=Q.add4H(E,$,q,hn[x-7],hn[x-16]);hn[x]=p|0,dn[x]=E|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:f,Dh:c,Dl:u,Eh:d,El:h,Fh:l,Fl:b,Gh:m,Gl:v,Hh:D,Hl:C}=this;for(let x=0;x<80;x++){const _=Q.rotrSH(d,h,14)^Q.rotrSH(d,h,18)^Q.rotrBH(d,h,41),R=Q.rotrSL(d,h,14)^Q.rotrSL(d,h,18)^Q.rotrBL(d,h,41),$=d&l^~d&m,F=h&b^~h&v,U=Q.add5L(C,R,F,Sy[x],dn[x]),A=Q.add5H(U,D,_,$,xy[x],hn[x]),q=U|0,k=Q.rotrSH(r,i,28)^Q.rotrBH(r,i,34)^Q.rotrBH(r,i,39),E=Q.rotrSL(r,i,28)^Q.rotrBL(r,i,34)^Q.rotrBL(r,i,39),p=r&s^r&a^s&a,w=i&o^i&f^o&f;D=m|0,C=v|0,m=l|0,v=b|0,l=d|0,b=h|0,{h:d,l:h}=Q.add(c|0,u|0,A|0,q|0),c=a|0,u=f|0,a=s|0,f=o|0,s=r|0,o=i|0;const g=Q.add3L(q,E,w);r=Q.add3H(g,A,k,p),i=g|0}({h:r,l:i}=Q.add(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=Q.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:f}=Q.add(this.Ch|0,this.Cl|0,a|0,f|0),{h:c,l:u}=Q.add(this.Dh|0,this.Dl|0,c|0,u|0),{h:d,l:h}=Q.add(this.Eh|0,this.El|0,d|0,h|0),{h:l,l:b}=Q.add(this.Fh|0,this.Fl|0,l|0,b|0),{h:m,l:v}=Q.add(this.Gh|0,this.Gl|0,m|0,v|0),{h:D,l:C}=Q.add(this.Hh|0,this.Hl|0,D|0,C|0),this.set(r,i,s,o,a,f,c,u,d,h,l,b,m,v,D,C)}roundClean(){hn.fill(0),dn.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Oy=Q1(()=>new Iy);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Po=BigInt(0),Du=BigInt(1),By=BigInt(2);function $o(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Lo(e){if(!$o(e))throw new Error("Uint8Array expected")}function Uo(e,t){if(typeof t!="boolean")throw new Error(e+" boolean expected, got "+t)}const Dy=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Fo(e){Lo(e);let t="";for(let n=0;n<e.length;n++)t+=Dy[e[n]];return t}function Au(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?Po:BigInt("0x"+e)}const kt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Tu(e){if(e>=kt._0&&e<=kt._9)return e-kt._0;if(e>=kt.A&&e<=kt.F)return e-(kt.A-10);if(e>=kt.a&&e<=kt.f)return e-(kt.a-10)}function Ru(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=Tu(e.charCodeAt(s)),a=Tu(e.charCodeAt(s+1));if(o===void 0||a===void 0){const f=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+f+'" at index '+s)}r[i]=o*16+a}return r}function Ay(e){return Au(Fo(e))}function Xi(e){return Lo(e),Au(Fo(Uint8Array.from(e).reverse()))}function Nu(e,t){return Ru(e.toString(16).padStart(t*2,"0"))}function jo(e,t){return Nu(e,t).reverse()}function zt(e,t,n){let r;if(typeof t=="string")try{r=Ru(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if($o(t))r=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(e+" of length "+n+" expected, got "+i);return r}function Cu(...e){let t=0;for(let r=0;r<e.length;r++){const i=e[r];Lo(i),t+=i.length}const n=new Uint8Array(t);for(let r=0,i=0;r<e.length;r++){const s=e[r];n.set(s,i),i+=s.length}return n}const Mo=e=>typeof e=="bigint"&&Po<=e;function Ty(e,t,n){return Mo(e)&&Mo(t)&&Mo(n)&&t<=e&&e<n}function Qr(e,t,n,r){if(!Ty(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}function Ry(e){let t;for(t=0;e>Po;e>>=Du,t+=1);return t}const Ny=e=>(By<<BigInt(e-1))-Du,Cy={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||$o(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function ko(e,t,n={}){const r=(i,s,o)=>{const a=Cy[s];if(typeof a!="function")throw new Error("invalid validator function");const f=e[i];if(!(o&&f===void 0)&&!a(f,e))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+f)};for(const[i,s]of Object.entries(t))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return e}function Pu(e){const t=new WeakMap;return(n,...r)=>{const i=t.get(n);if(i!==void 0)return i;const s=e(n,...r);return t.set(n,s),s}}const _e=BigInt(0),ge=BigInt(1),Vn=BigInt(2),Py=BigInt(3),zo=BigInt(4),$u=BigInt(5),Lu=BigInt(8);function me(e,t){const n=e%t;return n>=_e?n:t+n}function $y(e,t,n){if(t<_e)throw new Error("invalid exponent, negatives unsupported");if(n<=_e)throw new Error("invalid modulus");if(n===ge)return _e;let r=ge;for(;t>_e;)t&ge&&(r=r*e%n),e=e*e%n,t>>=ge;return r}function Ct(e,t,n){let r=e;for(;t-- >_e;)r*=r,r%=n;return r}function Uu(e,t){if(e===_e)throw new Error("invert: expected non-zero number");if(t<=_e)throw new Error("invert: expected positive modulus, got "+t);let n=me(e,t),r=t,i=_e,s=ge;for(;n!==_e;){const o=r/n,a=r%n,f=i-s*o;r=n,n=a,i=s,s=f}if(r!==ge)throw new Error("invert: does not exist");return me(i,t)}function Ly(e){const t=(e-ge)/Vn;let n,r,i;for(n=e-ge,r=0;n%Vn===_e;n/=Vn,r++);for(i=Vn;i<e&&$y(i,t,e)!==e-ge;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(e+ge)/zo;return function(a,f){const c=a.pow(f,o);if(!a.eql(a.sqr(c),f))throw new Error("Cannot find square root");return c}}const s=(n+ge)/Vn;return function(o,a){if(o.pow(a,t)===o.neg(o.ONE))throw new Error("Cannot find square root");let f=r,c=o.pow(o.mul(o.ONE,i),n),u=o.pow(a,s),d=o.pow(a,n);for(;!o.eql(d,o.ONE);){if(o.eql(d,o.ZERO))return o.ZERO;let h=1;for(let b=o.sqr(d);h<f&&!o.eql(b,o.ONE);h++)b=o.sqr(b);const l=o.pow(c,ge<<BigInt(f-h-1));c=o.sqr(l),u=o.mul(u,l),d=o.mul(d,c),f=h}return u}}function Uy(e){if(e%zo===Py){const t=(e+ge)/zo;return function(n,r){const i=n.pow(r,t);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(e%Lu===$u){const t=(e-$u)/Lu;return function(n,r){const i=n.mul(r,Vn),s=n.pow(i,t),o=n.mul(r,s),a=n.mul(n.mul(o,Vn),s),f=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(f),r))throw new Error("Cannot find square root");return f}}return Ly(e)}const Fy=(e,t)=>(me(e,t)&ge)===ge,jy=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function My(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=jy.reduce((r,i)=>(r[i]="function",r),t);return ko(e,n)}function ky(e,t,n){if(n<_e)throw new Error("invalid exponent, negatives unsupported");if(n===_e)return e.ONE;if(n===ge)return t;let r=e.ONE,i=t;for(;n>_e;)n&ge&&(r=e.mul(r,i)),i=e.sqr(i),n>>=ge;return r}function zy(e,t){const n=new Array(t.length),r=t.reduce((s,o,a)=>e.is0(o)?s:(n[a]=s,e.mul(s,o)),e.ONE),i=e.inv(r);return t.reduceRight((s,o,a)=>e.is0(o)?s:(n[a]=e.mul(s,n[a]),e.mul(s,o)),i),n}function Fu(e,t){const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function ju(e,t,n=!1,r={}){if(e<=_e)throw new Error("invalid field: expected ORDER > 0, got "+e);const{nBitLength:i,nByteLength:s}=Fu(e,t);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:e,isLE:n,BITS:i,BYTES:s,MASK:Ny(i),ZERO:_e,ONE:ge,create:f=>me(f,e),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return _e<=f&&f<e},is0:f=>f===_e,isOdd:f=>(f&ge)===ge,neg:f=>me(-f,e),eql:(f,c)=>f===c,sqr:f=>me(f*f,e),add:(f,c)=>me(f+c,e),sub:(f,c)=>me(f-c,e),mul:(f,c)=>me(f*c,e),pow:(f,c)=>ky(a,f,c),div:(f,c)=>me(f*Uu(c,e),e),sqrN:f=>f*f,addN:(f,c)=>f+c,subN:(f,c)=>f-c,mulN:(f,c)=>f*c,inv:f=>Uu(f,e),sqrt:r.sqrt||(f=>(o||(o=Uy(e)),o(a,f))),invertBatch:f=>zy(a,f),cmov:(f,c,u)=>u?c:f,toBytes:f=>n?jo(f,s):Nu(f,s),fromBytes:f=>{if(f.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+f.length);return n?Xi(f):Ay(f)}});return Object.freeze(a)}const Mu=BigInt(0),Ji=BigInt(1);function qo(e,t){const n=t.negate();return e?n:t}function ku(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Ho(e,t){ku(e,t);const n=Math.ceil(t/e)+1,r=2**(e-1);return{windows:n,windowSize:r}}function qy(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((n,r)=>{if(!(n instanceof t))throw new Error("invalid point at index "+r)})}function Hy(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((n,r)=>{if(!t.isValid(n))throw new Error("invalid scalar at index "+r)})}const Vo=new WeakMap,zu=new WeakMap;function Ko(e){return zu.get(e)||1}function Vy(e,t){return{constTimeNegate:qo,hasPrecomputes(n){return Ko(n)!==1},unsafeLadder(n,r,i=e.ZERO){let s=n;for(;r>Mu;)r&Ji&&(i=i.add(s)),s=s.double(),r>>=Ji;return i},precomputeWindow(n,r){const{windows:i,windowSize:s}=Ho(r,t),o=[];let a=n,f=a;for(let c=0;c<i;c++){f=a,o.push(f);for(let u=1;u<s;u++)f=f.add(a),o.push(f);a=f.double()}return o},wNAF(n,r,i){const{windows:s,windowSize:o}=Ho(n,t);let a=e.ZERO,f=e.BASE;const c=BigInt(2**n-1),u=2**n,d=BigInt(n);for(let h=0;h<s;h++){const l=h*o;let b=Number(i&c);i>>=d,b>o&&(b-=u,i+=Ji);const m=l,v=l+Math.abs(b)-1,D=h%2!==0,C=b<0;b===0?f=f.add(qo(D,r[m])):a=a.add(qo(C,r[v]))}return{p:a,f}},wNAFUnsafe(n,r,i,s=e.ZERO){const{windows:o,windowSize:a}=Ho(n,t),f=BigInt(2**n-1),c=2**n,u=BigInt(n);for(let d=0;d<o;d++){const h=d*a;if(i===Mu)break;let l=Number(i&f);if(i>>=u,l>a&&(l-=c,i+=Ji),l===0)continue;let b=r[h+Math.abs(l)-1];l<0&&(b=b.negate()),s=s.add(b)}return s},getPrecomputes(n,r,i){let s=Vo.get(r);return s||(s=this.precomputeWindow(r,n),n!==1&&Vo.set(r,i(s))),s},wNAFCached(n,r,i){const s=Ko(n);return this.wNAF(s,this.getPrecomputes(s,n,i),r)},wNAFCachedUnsafe(n,r,i,s){const o=Ko(n);return o===1?this.unsafeLadder(n,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,n,i),r,s)},setWindowSize(n,r){ku(r,t),zu.set(n,r),Vo.delete(n)}}}function Ky(e,t,n,r){if(qy(n,e),Hy(r,t),n.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const i=e.ZERO,s=Ry(BigInt(n.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,f=new Array(a+1).fill(i),c=Math.floor((t.BITS-1)/o)*o;let u=i;for(let d=c;d>=0;d-=o){f.fill(i);for(let l=0;l<r.length;l++){const b=r[l],m=Number(b>>BigInt(d)&BigInt(a));f[m]=f[m].add(n[l])}let h=i;for(let l=f.length-1,b=i;l>0;l--)b=b.add(f[l]),h=h.add(b);if(u=u.add(h),d!==0)for(let l=0;l<o;l++)u=u.double()}return u}function Gy(e){return My(e.Fp),ko(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Fu(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}const vt=BigInt(0),Ze=BigInt(1),Qi=BigInt(2),Zy=BigInt(8),Yy={zip215:!0};function Wy(e){const t=Gy(e);return ko(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function Xy(e){const t=Wy(e),{Fp:n,n:r,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:f}=t,c=Qi<<BigInt(a*8)-Ze,u=n.create,d=ju(t.n,t.nBitLength),h=t.uvRatio||((g,y)=>{try{return{isValid:!0,value:n.sqrt(g*n.inv(y))}}catch{return{isValid:!1,value:vt}}}),l=t.adjustScalarBytes||(g=>g),b=t.domain||((g,y,S)=>{if(Uo("phflag",S),y.length||S)throw new Error("Contexts/pre-hash are not supported");return g});function m(g,y){Qr("coordinate "+g,y,vt,c)}function v(g){if(!(g instanceof x))throw new Error("ExtendedPoint expected")}const D=Pu((g,y)=>{const{ex:S,ey:I,ez:O}=g,B=g.is0();y==null&&(y=B?Zy:n.inv(O));const T=u(S*y),L=u(I*y),P=u(O*y);if(B)return{x:vt,y:Ze};if(P!==Ze)throw new Error("invZ was invalid");return{x:T,y:L}}),C=Pu(g=>{const{a:y,d:S}=t;if(g.is0())throw new Error("bad point: ZERO");const{ex:I,ey:O,ez:B,et:T}=g,L=u(I*I),P=u(O*O),j=u(B*B),N=u(j*j),M=u(L*y),z=u(j*u(M+P)),G=u(N+u(S*u(L*P)));if(z!==G)throw new Error("bad point: equation left != right (1)");const H=u(I*O),K=u(B*T);if(H!==K)throw new Error("bad point: equation left != right (2)");return!0});class x{constructor(y,S,I,O){this.ex=y,this.ey=S,this.ez=I,this.et=O,m("x",y),m("y",S),m("z",I),m("t",O),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(y){if(y instanceof x)throw new Error("extended point not allowed");const{x:S,y:I}=y||{};return m("x",S),m("y",I),new x(S,I,Ze,u(S*I))}static normalizeZ(y){const S=n.invertBatch(y.map(I=>I.ez));return y.map((I,O)=>I.toAffine(S[O])).map(x.fromAffine)}static msm(y,S){return Ky(x,d,y,S)}_setWindowSize(y){$.setWindowSize(this,y)}assertValidity(){C(this)}equals(y){v(y);const{ex:S,ey:I,ez:O}=this,{ex:B,ey:T,ez:L}=y,P=u(S*L),j=u(B*O),N=u(I*L),M=u(T*O);return P===j&&N===M}is0(){return this.equals(x.ZERO)}negate(){return new x(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:y}=t,{ex:S,ey:I,ez:O}=this,B=u(S*S),T=u(I*I),L=u(Qi*u(O*O)),P=u(y*B),j=S+I,N=u(u(j*j)-B-T),M=P+T,z=M-L,G=P-T,H=u(N*z),K=u(M*G),J=u(N*G),ee=u(z*M);return new x(H,K,ee,J)}add(y){v(y);const{a:S,d:I}=t,{ex:O,ey:B,ez:T,et:L}=this,{ex:P,ey:j,ez:N,et:M}=y;if(S===BigInt(-1)){const fp=u((B-O)*(j+P)),up=u((B+O)*(j-P)),tf=u(up-fp);if(tf===vt)return this.double();const lp=u(T*Qi*M),hp=u(L*Qi*N),dp=hp+lp,gp=up+fp,pp=hp-lp,Px=u(dp*tf),$x=u(gp*pp),Lx=u(dp*pp),Ux=u(tf*gp);return new x(Px,$x,Ux,Lx)}const z=u(O*P),G=u(B*j),H=u(L*I*M),K=u(T*N),J=u((O+B)*(P+j)-z-G),ee=K-H,re=K+H,he=u(G-S*z),de=u(J*ee),fn=u(re*he),co=u(J*he),Cx=u(ee*re);return new x(de,fn,Cx,co)}subtract(y){return this.add(y.negate())}wNAF(y){return $.wNAFCached(this,y,x.normalizeZ)}multiply(y){const S=y;Qr("scalar",S,Ze,r);const{p:I,f:O}=this.wNAF(S);return x.normalizeZ([I,O])[0]}multiplyUnsafe(y,S=x.ZERO){const I=y;return Qr("scalar",I,vt,r),I===vt?R:this.is0()||I===Ze?this:$.wNAFCachedUnsafe(this,I,x.normalizeZ,S)}isSmallOrder(){return this.multiplyUnsafe(f).is0()}isTorsionFree(){return $.unsafeLadder(this,r).is0()}toAffine(y){return D(this,y)}clearCofactor(){const{h:y}=t;return y===Ze?this:this.multiplyUnsafe(y)}static fromHex(y,S=!1){const{d:I,a:O}=t,B=n.BYTES;y=zt("pointHex",y,B),Uo("zip215",S);const T=y.slice(),L=y[B-1];T[B-1]=L&-129;const P=Xi(T),j=S?c:n.ORDER;Qr("pointHex.y",P,vt,j);const N=u(P*P),M=u(N-Ze),z=u(I*N-O);let{isValid:G,value:H}=h(M,z);if(!G)throw new Error("Point.fromHex: invalid y coordinate");const K=(H&Ze)===Ze,J=(L&128)!==0;if(!S&&H===vt&&J)throw new Error("Point.fromHex: x=0 and x_0=1");return J!==K&&(H=u(-H)),x.fromAffine({x:H,y:P})}static fromPrivateKey(y){return A(y).point}toRawBytes(){const{x:y,y:S}=this.toAffine(),I=jo(S,n.BYTES);return I[I.length-1]|=y&Ze?128:0,I}toHex(){return Fo(this.toRawBytes())}}x.BASE=new x(t.Gx,t.Gy,Ze,u(t.Gx*t.Gy)),x.ZERO=new x(vt,Ze,Ze,vt);const{BASE:_,ZERO:R}=x,$=Vy(x,a*8);function F(g){return me(g,r)}function U(g){return F(Xi(g))}function A(g){const y=n.BYTES;g=zt("private key",g,y);const S=zt("hashed private key",s(g),2*y),I=l(S.slice(0,y)),O=S.slice(y,2*y),B=U(I),T=_.multiply(B),L=T.toRawBytes();return{head:I,prefix:O,scalar:B,point:T,pointBytes:L}}function q(g){return A(g).pointBytes}function k(g=new Uint8Array,...y){const S=Cu(...y);return U(s(b(S,zt("context",g),!!i)))}function E(g,y,S={}){g=zt("message",g),i&&(g=i(g));const{prefix:I,scalar:O,pointBytes:B}=A(y),T=k(S.context,I,g),L=_.multiply(T).toRawBytes(),P=k(S.context,L,B,g),j=F(T+P*O);Qr("signature.s",j,vt,r);const N=Cu(L,jo(j,n.BYTES));return zt("result",N,n.BYTES*2)}const p=Yy;function w(g,y,S,I=p){const{context:O,zip215:B}=I,T=n.BYTES;g=zt("signature",g,2*T),y=zt("message",y),S=zt("publicKey",S,T),B!==void 0&&Uo("zip215",B),i&&(y=i(y));const L=Xi(g.slice(T,2*T));let P,j,N;try{P=x.fromHex(S,B),j=x.fromHex(g.slice(0,T),B),N=_.multiplyUnsafe(L)}catch{return!1}if(!B&&P.isSmallOrder())return!1;const M=k(O,j.toRawBytes(),P.toRawBytes(),y);return j.add(P.multiplyUnsafe(M)).subtract(N).clearCofactor().equals(x.ZERO)}return _._setWindowSize(8),{CURVE:t,getPublicKey:q,sign:E,verify:w,ExtendedPoint:x,utils:{getExtendedPublicKey:A,randomPrivateKey:()=>o(n.BYTES),precompute(g=8,y=x.BASE){return y._setWindowSize(g),y.multiply(BigInt(3)),y}}}}BigInt(0),BigInt(1);const Go=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),qu=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Jy=BigInt(1),Hu=BigInt(2);BigInt(3);const Qy=BigInt(5),em=BigInt(8);function tm(e){const t=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),s=Go,o=e*e%s*e%s,a=Ct(o,Hu,s)*o%s,f=Ct(a,Jy,s)*e%s,c=Ct(f,Qy,s)*f%s,u=Ct(c,t,s)*c%s,d=Ct(u,n,s)*u%s,h=Ct(d,r,s)*d%s,l=Ct(h,i,s)*h%s,b=Ct(l,i,s)*h%s,m=Ct(b,t,s)*c%s;return{pow_p_5_8:Ct(m,Hu,s)*e%s,b2:o}}function nm(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}function rm(e,t){const n=Go,r=me(t*t*t,n),i=me(r*r*t,n),s=tm(e*i).pow_p_5_8;let o=me(e*r*s,n);const a=me(t*o*o,n),f=o,c=me(o*qu,n),u=a===e,d=a===me(-e,n),h=a===me(-e*qu,n);return u&&(o=f),(d||h)&&(o=c),Fy(o,n)&&(o=me(-o,n)),{isValid:u||d,value:o}}const im=ju(Go,void 0,!0),sm={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:im,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:em,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Oy,randomBytes:Ou,adjustScalarBytes:nm,uvRatio:rm},Vu=Xy(sm),om="EdDSA",am="JWT",es=".",ts="base64url",Ku="utf8",Gu="utf8",cm=":",fm="did",um="key",Zu="base58btc",lm="z",hm="K36",dm=32;function Zo(e){return globalThis.Buffer!=null?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Yu(e=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Zo(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Wu(e,t){t||(t=e.reduce((i,s)=>i+s.length,0));const n=Yu(t);let r=0;for(const i of e)n.set(i,r),r+=i.length;return Zo(n)}function gm(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=e.length,f=e.charAt(0),c=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(b.length===0)return"";for(var m=0,v=0,D=0,C=b.length;D!==C&&b[D]===0;)D++,m++;for(var x=(C-D)*u+1>>>0,_=new Uint8Array(x);D!==C;){for(var R=b[D],$=0,F=x-1;(R!==0||$<v)&&F!==-1;F--,$++)R+=256*_[F]>>>0,_[F]=R%a>>>0,R=R/a>>>0;if(R!==0)throw new Error("Non-zero carry");v=$,D++}for(var U=x-v;U!==x&&_[U]===0;)U++;for(var A=f.repeat(m);U<x;++U)A+=e.charAt(_[U]);return A}function h(b){if(typeof b!="string")throw new TypeError("Expected String");if(b.length===0)return new Uint8Array;var m=0;if(b[m]!==" "){for(var v=0,D=0;b[m]===f;)v++,m++;for(var C=(b.length-m)*c+1>>>0,x=new Uint8Array(C);b[m];){var _=n[b.charCodeAt(m)];if(_===255)return;for(var R=0,$=C-1;(_!==0||R<D)&&$!==-1;$--,R++)_+=a*x[$]>>>0,x[$]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");D=R,m++}if(b[m]!==" "){for(var F=C-D;F!==C&&x[F]===0;)F++;for(var U=new Uint8Array(v+(C-F)),A=v;F!==C;)U[A++]=x[F++];return U}}}function l(b){var m=h(b);if(m)return m;throw new Error(`Non-${t} character`)}return{encode:d,decodeUnsafe:h,decode:l}}var pm=gm,bm=pm;const Xu=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},ym=e=>new TextEncoder().encode(e),mm=e=>new TextDecoder().decode(e);class wm{constructor(t,n,r){this.name=t,this.prefix=n,this.baseEncode=r}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class Em{constructor(t,n,r){if(this.name=t,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Ju(this,t)}}class vm{constructor(t){this.decoders=t}or(t){return Ju(this,t)}decode(t){const n=t[0],r=this.decoders[n];if(r)return r.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ju=(e,t)=>new vm({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class _m{constructor(t,n,r,i){this.name=t,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new wm(t,n,r),this.decoder=new Em(t,n,i)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const ns=({name:e,prefix:t,encode:n,decode:r})=>new _m(e,t,n,r),ei=({prefix:e,name:t,alphabet:n})=>{const{encode:r,decode:i}=bm(n,t);return ns({prefix:e,name:t,encode:r,decode:s=>Xu(i(s))})},xm=(e,t,n,r)=>{const i={};for(let u=0;u<t.length;++u)i[t[u]]=u;let s=e.length;for(;e[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,f=0,c=0;for(let u=0;u<s;++u){const d=i[e[u]];if(d===void 0)throw new SyntaxError(`Non-${r} character`);f=f<<n|d,a+=n,a>=8&&(a-=8,o[c++]=255&f>>a)}if(a>=n||255&f<<8-a)throw new SyntaxError("Unexpected end of data");return o},Sm=(e,t,n)=>{const r=t[t.length-1]==="=",i=(1<<n)-1;let s="",o=0,a=0;for(let f=0;f<e.length;++f)for(a=a<<8|e[f],o+=8;o>n;)o-=n,s+=t[i&a>>o];if(o&&(s+=t[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},Oe=({name:e,prefix:t,bitsPerChar:n,alphabet:r})=>ns({prefix:t,name:e,encode(i){return Sm(i,r,n)},decode(i){return xm(i,r,n,e)}}),Im=ns({prefix:"\0",name:"identity",encode:e=>mm(e),decode:e=>ym(e)});var Om=Object.freeze({__proto__:null,identity:Im});const Bm=Oe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Dm=Object.freeze({__proto__:null,base2:Bm});const Am=Oe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Tm=Object.freeze({__proto__:null,base8:Am});const Rm=ei({prefix:"9",name:"base10",alphabet:"0123456789"});var Nm=Object.freeze({__proto__:null,base10:Rm});const Cm=Oe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Pm=Oe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var $m=Object.freeze({__proto__:null,base16:Cm,base16upper:Pm});const Lm=Oe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Um=Oe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Fm=Oe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),jm=Oe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Mm=Oe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),km=Oe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),zm=Oe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),qm=Oe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Hm=Oe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Vm=Object.freeze({__proto__:null,base32:Lm,base32upper:Um,base32pad:Fm,base32padupper:jm,base32hex:Mm,base32hexupper:km,base32hexpad:zm,base32hexpadupper:qm,base32z:Hm});const Km=ei({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Gm=ei({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Zm=Object.freeze({__proto__:null,base36:Km,base36upper:Gm});const Ym=ei({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Wm=ei({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Xm=Object.freeze({__proto__:null,base58btc:Ym,base58flickr:Wm});const Jm=Oe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Qm=Oe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ew=Oe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),tw=Oe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var nw=Object.freeze({__proto__:null,base64:Jm,base64pad:Qm,base64url:ew,base64urlpad:tw});const Qu=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),rw=Qu.reduce((e,t,n)=>(e[n]=t,e),[]),iw=Qu.reduce((e,t,n)=>(e[t.codePointAt(0)]=n,e),[]);function sw(e){return e.reduce((t,n)=>(t+=rw[n],t),"")}function ow(e){const t=[];for(const n of e){const r=iw[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);t.push(r)}return new Uint8Array(t)}const aw=ns({prefix:"\u{1F680}",name:"base256emoji",encode:sw,decode:ow});var cw=Object.freeze({__proto__:null,base256emoji:aw}),fw=tl,el=128,uw=127,lw=~uw,hw=Math.pow(2,31);function tl(e,t,n){t=t||[],n=n||0;for(var r=n;e>=hw;)t[n++]=e&255|el,e/=128;for(;e&lw;)t[n++]=e&255|el,e>>>=7;return t[n]=e|0,tl.bytes=n-r+1,t}var dw=Yo,gw=128,nl=127;function Yo(e,r){var n=0,r=r||0,i=0,s=r,o,a=e.length;do{if(s>=a)throw Yo.bytes=0,new RangeError("Could not decode varint");o=e[s++],n+=i<28?(o&nl)<<i:(o&nl)*Math.pow(2,i),i+=7}while(o>=gw);return Yo.bytes=s-r,n}var pw=Math.pow(2,7),bw=Math.pow(2,14),yw=Math.pow(2,21),mw=Math.pow(2,28),ww=Math.pow(2,35),Ew=Math.pow(2,42),vw=Math.pow(2,49),_w=Math.pow(2,56),xw=Math.pow(2,63),Sw=function(e){return e<pw?1:e<bw?2:e<yw?3:e<mw?4:e<ww?5:e<Ew?6:e<vw?7:e<_w?8:e<xw?9:10},Iw={encode:fw,decode:dw,encodingLength:Sw},rl=Iw;const il=(e,t,n=0)=>(rl.encode(e,t,n),t),sl=e=>rl.encodingLength(e),Wo=(e,t)=>{const n=t.byteLength,r=sl(e),i=r+sl(n),s=new Uint8Array(i+n);return il(e,s,0),il(n,s,r),s.set(t,i),new Ow(e,n,t,s)};class Ow{constructor(t,n,r,i){this.code=t,this.size=n,this.digest=r,this.bytes=i}}const ol=({name:e,code:t,encode:n})=>new Bw(e,t,n);class Bw{constructor(t,n,r){this.name=t,this.code=n,this.encode=r}digest(t){if(t instanceof Uint8Array){const n=this.encode(t);return n instanceof Uint8Array?Wo(this.code,n):n.then(r=>Wo(this.code,r))}else throw Error("Unknown type, must be binary type")}}const al=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Dw=ol({name:"sha2-256",code:18,encode:al("SHA-256")}),Aw=ol({name:"sha2-512",code:19,encode:al("SHA-512")});var Tw=Object.freeze({__proto__:null,sha256:Dw,sha512:Aw});const cl=0,Rw="identity",fl=Xu;var Nw=Object.freeze({__proto__:null,identity:{code:cl,name:Rw,encode:fl,digest:e=>Wo(cl,fl(e))}});new TextEncoder,new TextDecoder;const ul={...Om,...Dm,...Tm,...Nm,...$m,...Vm,...Zm,...Xm,...nw,...cw};({...Tw,...Nw});function ll(e,t,n,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:n},decoder:{decode:r}}}const hl=ll("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),Xo=ll("ascii","a",e=>{let t="a";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},e=>{e=e.substring(1);const t=Yu(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}),dl={utf8:hl,"utf-8":hl,hex:ul.base16,latin1:Xo,ascii:Xo,binary:Xo,...ul};function rs(e,t="utf8"){const n=dl[t];if(!n)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8"):n.encoder.encode(e).substring(1)}function gr(e,t="utf8"){const n=dl[t];if(!n)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Zo(globalThis.Buffer.from(e,"utf-8")):n.decoder.decode(`${n.prefix}${e}`)}function gl(e){return fr(rs(gr(e,ts),Ku))}function is(e){return rs(gr(zn(e),Ku),ts)}function pl(e){const t=gr(hm,Zu),n=lm+rs(Wu([t,e]),Zu);return[fm,um,n].join(cm)}function Cw(e){return rs(e,ts)}function Pw(e){return gr(e,ts)}function $w(e){return gr([is(e.header),is(e.payload)].join(es),Gu)}function Lw(e){return[is(e.header),is(e.payload),Cw(e.signature)].join(es)}function Jo(e){const t=e.split(es),n=gl(t[0]),r=gl(t[1]),i=Pw(t[2]),s=gr(t.slice(0,2).join(es),Gu);return{header:n,payload:r,signature:i,data:s}}function bl(e=Ou(dm)){const t=Vu.getPublicKey(e);return{secretKey:Wu([e,t]),publicKey:t}}async function Uw(e,t,n,r,i=W.fromMiliseconds(Date.now())){const s={alg:om,typ:am},o=pl(r.publicKey),a=i+n,f={iss:o,sub:e,aud:t,iat:i,exp:a},c=$w({header:s,payload:f}),u=Vu.sign(c,r.secretKey.slice(0,32));return Lw({header:s,payload:f,signature:u})}function Fw(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=e.length,f=e.charAt(0),c=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(b.length===0)return"";for(var m=0,v=0,D=0,C=b.length;D!==C&&b[D]===0;)D++,m++;for(var x=(C-D)*u+1>>>0,_=new Uint8Array(x);D!==C;){for(var R=b[D],$=0,F=x-1;(R!==0||$<v)&&F!==-1;F--,$++)R+=256*_[F]>>>0,_[F]=R%a>>>0,R=R/a>>>0;if(R!==0)throw new Error("Non-zero carry");v=$,D++}for(var U=x-v;U!==x&&_[U]===0;)U++;for(var A=f.repeat(m);U<x;++U)A+=e.charAt(_[U]);return A}function h(b){if(typeof b!="string")throw new TypeError("Expected String");if(b.length===0)return new Uint8Array;var m=0;if(b[m]!==" "){for(var v=0,D=0;b[m]===f;)v++,m++;for(var C=(b.length-m)*c+1>>>0,x=new Uint8Array(C);b[m];){var _=n[b.charCodeAt(m)];if(_===255)return;for(var R=0,$=C-1;(_!==0||R<D)&&$!==-1;$--,R++)_+=a*x[$]>>>0,x[$]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");D=R,m++}if(b[m]!==" "){for(var F=C-D;F!==C&&x[F]===0;)F++;for(var U=new Uint8Array(v+(C-F)),A=v;F!==C;)U[A++]=x[F++];return U}}}function l(b){var m=h(b);if(m)return m;throw new Error(`Non-${t} character`)}return{encode:d,decodeUnsafe:h,decode:l}}var jw=Fw,Mw=jw;const yl=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},kw=e=>new TextEncoder().encode(e),zw=e=>new TextDecoder().decode(e);class qw{constructor(t,n,r){this.name=t,this.prefix=n,this.baseEncode=r}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class Hw{constructor(t,n,r){if(this.name=t,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return ml(this,t)}}class Vw{constructor(t){this.decoders=t}or(t){return ml(this,t)}decode(t){const n=t[0],r=this.decoders[n];if(r)return r.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ml=(e,t)=>new Vw({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Kw{constructor(t,n,r,i){this.name=t,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new qw(t,n,r),this.decoder=new Hw(t,n,i)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const ss=({name:e,prefix:t,encode:n,decode:r})=>new Kw(e,t,n,r),ti=({prefix:e,name:t,alphabet:n})=>{const{encode:r,decode:i}=Mw(n,t);return ss({prefix:e,name:t,encode:r,decode:s=>yl(i(s))})},Gw=(e,t,n,r)=>{const i={};for(let u=0;u<t.length;++u)i[t[u]]=u;let s=e.length;for(;e[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,f=0,c=0;for(let u=0;u<s;++u){const d=i[e[u]];if(d===void 0)throw new SyntaxError(`Non-${r} character`);f=f<<n|d,a+=n,a>=8&&(a-=8,o[c++]=255&f>>a)}if(a>=n||255&f<<8-a)throw new SyntaxError("Unexpected end of data");return o},Zw=(e,t,n)=>{const r=t[t.length-1]==="=",i=(1<<n)-1;let s="",o=0,a=0;for(let f=0;f<e.length;++f)for(a=a<<8|e[f],o+=8;o>n;)o-=n,s+=t[i&a>>o];if(o&&(s+=t[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},Be=({name:e,prefix:t,bitsPerChar:n,alphabet:r})=>ss({prefix:t,name:e,encode(i){return Zw(i,r,n)},decode(i){return Gw(i,r,n,e)}}),Yw=ss({prefix:"\0",name:"identity",encode:e=>zw(e),decode:e=>kw(e)});var Ww=Object.freeze({__proto__:null,identity:Yw});const Xw=Be({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Jw=Object.freeze({__proto__:null,base2:Xw});const Qw=Be({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var e2=Object.freeze({__proto__:null,base8:Qw});const t2=ti({prefix:"9",name:"base10",alphabet:"0123456789"});var n2=Object.freeze({__proto__:null,base10:t2});const r2=Be({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),i2=Be({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var s2=Object.freeze({__proto__:null,base16:r2,base16upper:i2});const o2=Be({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),a2=Be({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),c2=Be({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),f2=Be({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),u2=Be({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),l2=Be({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),h2=Be({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),d2=Be({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),g2=Be({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var p2=Object.freeze({__proto__:null,base32:o2,base32upper:a2,base32pad:c2,base32padupper:f2,base32hex:u2,base32hexupper:l2,base32hexpad:h2,base32hexpadupper:d2,base32z:g2});const b2=ti({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),y2=ti({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var m2=Object.freeze({__proto__:null,base36:b2,base36upper:y2});const w2=ti({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),E2=ti({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var v2=Object.freeze({__proto__:null,base58btc:w2,base58flickr:E2});const _2=Be({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),x2=Be({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),S2=Be({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),I2=Be({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var O2=Object.freeze({__proto__:null,base64:_2,base64pad:x2,base64url:S2,base64urlpad:I2});const wl=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),B2=wl.reduce((e,t,n)=>(e[n]=t,e),[]),D2=wl.reduce((e,t,n)=>(e[t.codePointAt(0)]=n,e),[]);function A2(e){return e.reduce((t,n)=>(t+=B2[n],t),"")}function T2(e){const t=[];for(const n of e){const r=D2[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);t.push(r)}return new Uint8Array(t)}const R2=ss({prefix:"\u{1F680}",name:"base256emoji",encode:A2,decode:T2});var N2=Object.freeze({__proto__:null,base256emoji:R2}),C2=vl,El=128,P2=127,$2=~P2,L2=Math.pow(2,31);function vl(e,t,n){t=t||[],n=n||0;for(var r=n;e>=L2;)t[n++]=e&255|El,e/=128;for(;e&$2;)t[n++]=e&255|El,e>>>=7;return t[n]=e|0,vl.bytes=n-r+1,t}var U2=Qo,F2=128,_l=127;function Qo(e,r){var n=0,r=r||0,i=0,s=r,o,a=e.length;do{if(s>=a)throw Qo.bytes=0,new RangeError("Could not decode varint");o=e[s++],n+=i<28?(o&_l)<<i:(o&_l)*Math.pow(2,i),i+=7}while(o>=F2);return Qo.bytes=s-r,n}var j2=Math.pow(2,7),M2=Math.pow(2,14),k2=Math.pow(2,21),z2=Math.pow(2,28),q2=Math.pow(2,35),H2=Math.pow(2,42),V2=Math.pow(2,49),K2=Math.pow(2,56),G2=Math.pow(2,63),Z2=function(e){return e<j2?1:e<M2?2:e<k2?3:e<z2?4:e<q2?5:e<H2?6:e<V2?7:e<K2?8:e<G2?9:10},Y2={encode:C2,decode:U2,encodingLength:Z2},xl=Y2;const Sl=(e,t,n=0)=>(xl.encode(e,t,n),t),Il=e=>xl.encodingLength(e),ea=(e,t)=>{const n=t.byteLength,r=Il(e),i=r+Il(n),s=new Uint8Array(i+n);return Sl(e,s,0),Sl(n,s,r),s.set(t,i),new W2(e,n,t,s)};class W2{constructor(t,n,r,i){this.code=t,this.size=n,this.digest=r,this.bytes=i}}const Ol=({name:e,code:t,encode:n})=>new X2(e,t,n);class X2{constructor(t,n,r){this.name=t,this.code=n,this.encode=r}digest(t){if(t instanceof Uint8Array){const n=this.encode(t);return n instanceof Uint8Array?ea(this.code,n):n.then(r=>ea(this.code,r))}else throw Error("Unknown type, must be binary type")}}const Bl=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),J2=Ol({name:"sha2-256",code:18,encode:Bl("SHA-256")}),Q2=Ol({name:"sha2-512",code:19,encode:Bl("SHA-512")});var eE=Object.freeze({__proto__:null,sha256:J2,sha512:Q2});const Dl=0,tE="identity",Al=yl;var nE=Object.freeze({__proto__:null,identity:{code:Dl,name:tE,encode:Al,digest:e=>ea(Dl,Al(e))}});new TextEncoder,new TextDecoder;const Tl={...Ww,...Jw,...e2,...n2,...s2,...p2,...m2,...v2,...O2,...N2};({...eE,...nE});function ta(e){return globalThis.Buffer!=null?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Rl(e=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ta(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Nl(e,t,n,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:n},decoder:{decode:r}}}const Cl=Nl("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),na=Nl("ascii","a",e=>{let t="a";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},e=>{e=e.substring(1);const t=Rl(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}),Pl={utf8:Cl,"utf-8":Cl,hex:Tl.base16,latin1:na,ascii:na,binary:na,...Tl};function ot(e,t="utf8"){const n=Pl[t];if(!n)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ta(globalThis.Buffer.from(e,"utf-8")):n.decoder.decode(`${n.prefix}${e}`)}var $l=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,s;r<i;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},rE=function(){function e(t,n,r){this.name=t,this.version=n,this.os=r,this.type="browser"}return e}(),iE=function(){function e(t){this.version=t,this.type="node",this.name="node",this.os=process.platform}return e}(),sE=function(){function e(t,n,r,i){this.name=t,this.version=n,this.os=r,this.bot=i,this.type="bot-device"}return e}(),oE=function(){function e(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return e}(),aE=function(){function e(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return e}(),cE=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,fE=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Ll=3,uE=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",cE]],Ul=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function lE(e){return e?Fl(e):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new aE:typeof navigator<"u"?Fl(navigator.userAgent):gE()}function hE(e){return e!==""&&uE.reduce(function(t,n){var r=n[0],i=n[1];if(t)return t;var s=i.exec(e);return!!s&&[r,s]},!1)}function Fl(e){var t=hE(e);if(!t)return null;var n=t[0],r=t[1];if(n==="searchbot")return new oE;var i=r[1]&&r[1].split(".").join("_").split("_").slice(0,3);i?i.length<Ll&&(i=$l($l([],i,!0),pE(Ll-i.length),!0)):i=[];var s=i.join("."),o=dE(e),a=fE.exec(e);return a&&a[1]?new sE(n,s,o,a[1]):new rE(n,s,o)}function dE(e){for(var t=0,n=Ul.length;t<n;t++){var r=Ul[t],i=r[0],s=r[1],o=s.exec(e);if(o)return i}return null}function gE(){var e=typeof process<"u"&&process.version;return e?new iE(process.version.slice(1)):null}function pE(e){for(var t=[],n=0;n<e;n++)t.push("0");return t}var ue={};Object.defineProperty(ue,"__esModule",{value:!0}),ue.getLocalStorage=ue.getLocalStorageOrThrow=ue.getCrypto=ue.getCryptoOrThrow=jl=ue.getLocation=ue.getLocationOrThrow=ra=ue.getNavigator=ue.getNavigatorOrThrow=br=ue.getDocument=ue.getDocumentOrThrow=ue.getFromWindowOrThrow=ue.getFromWindow=void 0;function Kn(e){let t;return typeof window<"u"&&typeof window[e]<"u"&&(t=window[e]),t}ue.getFromWindow=Kn;function pr(e){const t=Kn(e);if(!t)throw new Error(`${e} is not defined in Window`);return t}ue.getFromWindowOrThrow=pr;function bE(){return pr("document")}ue.getDocumentOrThrow=bE;function yE(){return Kn("document")}var br=ue.getDocument=yE;function mE(){return pr("navigator")}ue.getNavigatorOrThrow=mE;function wE(){return Kn("navigator")}var ra=ue.getNavigator=wE;function EE(){return pr("location")}ue.getLocationOrThrow=EE;function vE(){return Kn("location")}var jl=ue.getLocation=vE;function _E(){return pr("crypto")}ue.getCryptoOrThrow=_E;function xE(){return Kn("crypto")}ue.getCrypto=xE;function SE(){return pr("localStorage")}ue.getLocalStorageOrThrow=SE;function IE(){return Kn("localStorage")}ue.getLocalStorage=IE;var ia={};Object.defineProperty(ia,"__esModule",{value:!0});var Ml=ia.getWindowMetadata=void 0;const kl=ue;function OE(){let e,t;try{e=kl.getDocumentOrThrow(),t=kl.getLocationOrThrow()}catch{return null}function n(){const d=e.getElementsByTagName("link"),h=[];for(let l=0;l<d.length;l++){const b=d[l],m=b.getAttribute("rel");if(m&&m.toLowerCase().indexOf("icon")>-1){const v=b.getAttribute("href");if(v)if(v.toLowerCase().indexOf("https:")===-1&&v.toLowerCase().indexOf("http:")===-1&&v.indexOf("//")!==0){let D=t.protocol+"//"+t.host;if(v.indexOf("/")===0)D+=v;else{const C=t.pathname.split("/");C.pop();const x=C.join("/");D+=x+"/"+v}h.push(D)}else if(v.indexOf("//")===0){const D=t.protocol+v;h.push(D)}else h.push(v)}}return h}function r(...d){const h=e.getElementsByTagName("meta");for(let l=0;l<h.length;l++){const b=h[l],m=["itemprop","property","name"].map(v=>b.getAttribute(v)).filter(v=>v?d.includes(v):!1);if(m.length&&m){const v=b.getAttribute("content");if(v)return v}}return""}function i(){let d=r("name","og:site_name","og:title","twitter:title");return d||(d=e.title),d}function s(){return r("description","og:description","twitter:description","keywords")}const o=i(),a=s(),f=t.origin,c=n();return{description:a,url:f,icons:c,name:o}}Ml=ia.getWindowMetadata=OE;const BE="0.1.1";function DE(){return BE}class Fe extends Error{constructor(t,n={}){const r=(()=>{if(n.cause instanceof Fe){if(n.cause.details)return n.cause.details;if(n.cause.shortMessage)return n.cause.shortMessage}return n.cause&&"details"in n.cause&&typeof n.cause.details=="string"?n.cause.details:n.cause?.message?n.cause.message:n.details})(),i=n.cause instanceof Fe&&n.cause.docsPath||n.docsPath,o=`https://oxlib.sh${i??""}`,a=[t||"An error occurred.",...n.metaMessages?["",...n.metaMessages]:[],...r||i?["",r?`Details: ${r}`:void 0,i?`See: ${o}`:void 0]:[]].filter(f=>typeof f=="string").join(`
`);super(a,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${DE()}`}),this.cause=n.cause,this.details=r,this.docs=o,this.docsPath=i,this.shortMessage=t}walk(t){return zl(this,t)}}function zl(e,t){return t?.(e)?e:e&&typeof e=="object"&&"cause"in e&&e.cause?zl(e.cause,t):t?null:e}const yr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function os(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function mr(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function qt(e,...t){if(!os(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function ql(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");mr(e.outputLen),mr(e.blockLen)}function wr(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Hl(e,t){qt(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function AE(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function gn(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function sa(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Pt(e,t){return e<<32-t|e>>>t}const TE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function RE(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function NE(e){for(let t=0;t<e.length;t++)e[t]=RE(e[t]);return e}const Vl=TE?e=>e:NE,Kl=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",CE=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Er(e){if(qt(e),Kl)return e.toHex();let t="";for(let n=0;n<e.length;n++)t+=CE[e[n]];return t}const Ht={_0:48,_9:57,A:65,F:70,a:97,f:102};function Gl(e){if(e>=Ht._0&&e<=Ht._9)return e-Ht._0;if(e>=Ht.A&&e<=Ht.F)return e-(Ht.A-10);if(e>=Ht.a&&e<=Ht.f)return e-(Ht.a-10)}function as(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(Kl)return Uint8Array.fromHex(e);const t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=Gl(e.charCodeAt(s)),a=Gl(e.charCodeAt(s+1));if(o===void 0||a===void 0){const f=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+f+'" at index '+s)}r[i]=o*16+a}return r}function oa(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function cs(e){return typeof e=="string"&&(e=oa(e)),qt(e),e}function Vt(...e){let t=0;for(let r=0;r<e.length;r++){const i=e[r];qt(i),t+=i.length}const n=new Uint8Array(t);for(let r=0,i=0;r<e.length;r++){const s=e[r];n.set(s,i),i+=s.length}return n}class aa{}function fs(e){const t=r=>e().update(cs(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function us(e=32){if(yr&&typeof yr.getRandomValues=="function")return yr.getRandomValues(new Uint8Array(e));if(yr&&typeof yr.randomBytes=="function")return Uint8Array.from(yr.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}function PE(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),f=r?4:0,c=r?0:4;e.setUint32(t+f,o,r),e.setUint32(t+c,a,r)}function $E(e,t,n){return e&t^~e&n}function LE(e,t,n){return e&t^e&n^t&n}class Zl extends aa{constructor(t,n,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(t),this.view=sa(this.buffer)}update(t){wr(this),t=cs(t),qt(t);const{view:n,buffer:r,blockLen:i}=this,s=t.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const f=sa(t);for(;i<=s-o;o+=i)this.process(f,o);continue}r.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){wr(this),Hl(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,gn(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;PE(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=sa(t),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=f/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return t.destroyed=o,t.finished=s,t.length=i,t.pos=a,i%n&&t.buffer.set(r),t}clone(){return this._cloneInto()}}const Kt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Te=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Re=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),ls=BigInt(2**32-1),Yl=BigInt(32);function UE(e,t=!1){return t?{h:Number(e&ls),l:Number(e>>Yl&ls)}:{h:Number(e>>Yl&ls)|0,l:Number(e&ls)|0}}function Wl(e,t=!1){const n=e.length;let r=new Uint32Array(n),i=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=UE(e[s],t);[r[s],i[s]]=[o,a]}return[r,i]}const Xl=(e,t,n)=>e>>>n,Jl=(e,t,n)=>e<<32-n|t>>>n,vr=(e,t,n)=>e>>>n|t<<32-n,_r=(e,t,n)=>e<<32-n|t>>>n,hs=(e,t,n)=>e<<64-n|t>>>n-32,ds=(e,t,n)=>e>>>n-32|t<<64-n,FE=(e,t,n)=>e<<n|t>>>32-n,jE=(e,t,n)=>t<<n|e>>>32-n,ME=(e,t,n)=>t<<n-32|e>>>64-n,kE=(e,t,n)=>e<<n-32|t>>>64-n;function Gt(e,t,n,r){const i=(t>>>0)+(r>>>0);return{h:e+n+(i/2**32|0)|0,l:i|0}}const zE=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),qE=(e,t,n,r)=>t+n+r+(e/2**32|0)|0,HE=(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),VE=(e,t,n,r,i)=>t+n+r+i+(e/2**32|0)|0,KE=(e,t,n,r,i)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(i>>>0),GE=(e,t,n,r,i,s)=>t+n+r+i+s+(e/2**32|0)|0,ZE=BigInt(0),ni=BigInt(1),YE=BigInt(2),WE=BigInt(7),XE=BigInt(256),JE=BigInt(113),Ql=[],eh=[],th=[];for(let e=0,t=ni,n=1,r=0;e<24;e++){[n,r]=[r,(2*n+3*r)%5],Ql.push(2*(5*r+n)),eh.push((e+1)*(e+2)/2%64);let i=ZE;for(let s=0;s<7;s++)t=(t<<ni^(t>>WE)*JE)%XE,t&YE&&(i^=ni<<(ni<<BigInt(s))-ni);th.push(i)}const nh=Wl(th,!0),QE=nh[0],ev=nh[1],rh=(e,t,n)=>n>32?ME(e,t,n):FE(e,t,n),ih=(e,t,n)=>n>32?kE(e,t,n):jE(e,t,n);function tv(e,t=24){const n=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let o=0;o<10;o++)n[o]=e[o]^e[o+10]^e[o+20]^e[o+30]^e[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,f=(o+2)%10,c=n[f],u=n[f+1],d=rh(c,u,1)^n[a],h=ih(c,u,1)^n[a+1];for(let l=0;l<50;l+=10)e[o+l]^=d,e[o+l+1]^=h}let i=e[2],s=e[3];for(let o=0;o<24;o++){const a=eh[o],f=rh(i,s,a),c=ih(i,s,a),u=Ql[o];i=e[u],s=e[u+1],e[u]=f,e[u+1]=c}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=e[o+a];for(let a=0;a<10;a++)e[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}e[0]^=QE[r],e[1]^=ev[r]}gn(n)}class ca extends aa{constructor(t,n,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=t,this.suffix=n,this.outputLen=r,this.enableXOF=i,this.rounds=s,mr(r),!(0<t&&t<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=AE(this.state)}clone(){return this._cloneInto()}keccak(){Vl(this.state32),tv(this.state32,this.rounds),Vl(this.state32),this.posOut=0,this.pos=0}update(t){wr(this),t=cs(t),qt(t);const{blockLen:n,state:r}=this,i=t.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=t[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:n,pos:r,blockLen:i}=this;t[r]^=n,(n&128)!==0&&r===i-1&&this.keccak(),t[i-1]^=128,this.keccak()}writeInto(t){wr(this,!1),qt(t),this.finish();const n=this.state,{blockLen:r}=this;for(let i=0,s=t.length;i<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-i);t.set(n.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return mr(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(Hl(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,gn(this.state)}_cloneInto(t){const{blockLen:n,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return t||(t=new ca(n,r,i,o,s)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=s,t.suffix=r,t.outputLen=i,t.enableXOF=o,t.destroyed=this.destroyed,t}}const nv=(e,t,n)=>fs(()=>new ca(t,e,n)),rv=nv(1,136,256/8),iv=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),pn=new Uint32Array(64);class sv extends Zl{constructor(t=32){super(64,t,8,!1),this.A=Kt[0]|0,this.B=Kt[1]|0,this.C=Kt[2]|0,this.D=Kt[3]|0,this.E=Kt[4]|0,this.F=Kt[5]|0,this.G=Kt[6]|0,this.H=Kt[7]|0}get(){const{A:t,B:n,C:r,D:i,E:s,F:o,G:a,H:f}=this;return[t,n,r,i,s,o,a,f]}set(t,n,r,i,s,o,a,f){this.A=t|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=f|0}process(t,n){for(let d=0;d<16;d++,n+=4)pn[d]=t.getUint32(n,!1);for(let d=16;d<64;d++){const h=pn[d-15],l=pn[d-2],b=Pt(h,7)^Pt(h,18)^h>>>3,m=Pt(l,17)^Pt(l,19)^l>>>10;pn[d]=m+pn[d-7]+b+pn[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:f,G:c,H:u}=this;for(let d=0;d<64;d++){const h=Pt(a,6)^Pt(a,11)^Pt(a,25),l=u+h+$E(a,f,c)+iv[d]+pn[d]|0,m=(Pt(r,2)^Pt(r,13)^Pt(r,22))+LE(r,i,s)|0;u=c,c=f,f=a,a=o+l|0,o=s,s=i,i=r,r=l+m|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,f=f+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,f,c,u)}roundClean(){gn(pn)}destroy(){this.set(0,0,0,0,0,0,0,0),gn(this.buffer)}}const sh=Wl(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),ov=sh[0],av=sh[1],bn=new Uint32Array(80),yn=new Uint32Array(80);class oh extends Zl{constructor(t=64){super(128,t,16,!1),this.Ah=Re[0]|0,this.Al=Re[1]|0,this.Bh=Re[2]|0,this.Bl=Re[3]|0,this.Ch=Re[4]|0,this.Cl=Re[5]|0,this.Dh=Re[6]|0,this.Dl=Re[7]|0,this.Eh=Re[8]|0,this.El=Re[9]|0,this.Fh=Re[10]|0,this.Fl=Re[11]|0,this.Gh=Re[12]|0,this.Gl=Re[13]|0,this.Hh=Re[14]|0,this.Hl=Re[15]|0}get(){const{Ah:t,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:f,Eh:c,El:u,Fh:d,Fl:h,Gh:l,Gl:b,Hh:m,Hl:v}=this;return[t,n,r,i,s,o,a,f,c,u,d,h,l,b,m,v]}set(t,n,r,i,s,o,a,f,c,u,d,h,l,b,m,v){this.Ah=t|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=f|0,this.Eh=c|0,this.El=u|0,this.Fh=d|0,this.Fl=h|0,this.Gh=l|0,this.Gl=b|0,this.Hh=m|0,this.Hl=v|0}process(t,n){for(let x=0;x<16;x++,n+=4)bn[x]=t.getUint32(n),yn[x]=t.getUint32(n+=4);for(let x=16;x<80;x++){const _=bn[x-15]|0,R=yn[x-15]|0,$=vr(_,R,1)^vr(_,R,8)^Xl(_,R,7),F=_r(_,R,1)^_r(_,R,8)^Jl(_,R,7),U=bn[x-2]|0,A=yn[x-2]|0,q=vr(U,A,19)^hs(U,A,61)^Xl(U,A,6),k=_r(U,A,19)^ds(U,A,61)^Jl(U,A,6),E=HE(F,k,yn[x-7],yn[x-16]),p=VE(E,$,q,bn[x-7],bn[x-16]);bn[x]=p|0,yn[x]=E|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:f,Dh:c,Dl:u,Eh:d,El:h,Fh:l,Fl:b,Gh:m,Gl:v,Hh:D,Hl:C}=this;for(let x=0;x<80;x++){const _=vr(d,h,14)^vr(d,h,18)^hs(d,h,41),R=_r(d,h,14)^_r(d,h,18)^ds(d,h,41),$=d&l^~d&m,F=h&b^~h&v,U=KE(C,R,F,av[x],yn[x]),A=GE(U,D,_,$,ov[x],bn[x]),q=U|0,k=vr(r,i,28)^hs(r,i,34)^hs(r,i,39),E=_r(r,i,28)^ds(r,i,34)^ds(r,i,39),p=r&s^r&a^s&a,w=i&o^i&f^o&f;D=m|0,C=v|0,m=l|0,v=b|0,l=d|0,b=h|0,{h:d,l:h}=Gt(c|0,u|0,A|0,q|0),c=a|0,u=f|0,a=s|0,f=o|0,s=r|0,o=i|0;const g=zE(q,E,w);r=qE(g,A,k,p),i=g|0}({h:r,l:i}=Gt(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=Gt(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:f}=Gt(this.Ch|0,this.Cl|0,a|0,f|0),{h:c,l:u}=Gt(this.Dh|0,this.Dl|0,c|0,u|0),{h:d,l:h}=Gt(this.Eh|0,this.El|0,d|0,h|0),{h:l,l:b}=Gt(this.Fh|0,this.Fl|0,l|0,b|0),{h:m,l:v}=Gt(this.Gh|0,this.Gl|0,m|0,v|0),{h:D,l:C}=Gt(this.Hh|0,this.Hl|0,D|0,C|0),this.set(r,i,s,o,a,f,c,u,d,h,l,b,m,v,D,C)}roundClean(){gn(bn,yn)}destroy(){gn(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class cv extends oh{constructor(){super(48),this.Ah=Te[0]|0,this.Al=Te[1]|0,this.Bh=Te[2]|0,this.Bl=Te[3]|0,this.Ch=Te[4]|0,this.Cl=Te[5]|0,this.Dh=Te[6]|0,this.Dl=Te[7]|0,this.Eh=Te[8]|0,this.El=Te[9]|0,this.Fh=Te[10]|0,this.Fl=Te[11]|0,this.Gh=Te[12]|0,this.Gl=Te[13]|0,this.Hh=Te[14]|0,this.Hl=Te[15]|0}}const xr=fs(()=>new sv),fv=fs(()=>new oh),uv=fs(()=>new cv);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const fa=BigInt(0),gs=BigInt(1);function ri(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function mn(e){if(!ri(e))throw new Error("Uint8Array expected")}function ii(e,t){if(typeof t!="boolean")throw new Error(e+" boolean expected, got "+t)}function ps(e){const t=e.toString(16);return t.length&1?"0"+t:t}function ah(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?fa:BigInt("0x"+e)}const ch=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",lv=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Gn(e){if(mn(e),ch)return e.toHex();let t="";for(let n=0;n<e.length;n++)t+=lv[e[n]];return t}const Zt={_0:48,_9:57,A:65,F:70,a:97,f:102};function fh(e){if(e>=Zt._0&&e<=Zt._9)return e-Zt._0;if(e>=Zt.A&&e<=Zt.F)return e-(Zt.A-10);if(e>=Zt.a&&e<=Zt.f)return e-(Zt.a-10)}function bs(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(ch)return Uint8Array.fromHex(e);const t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=fh(e.charCodeAt(s)),a=fh(e.charCodeAt(s+1));if(o===void 0||a===void 0){const f=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+f+'" at index '+s)}r[i]=o*16+a}return r}function je(e){return ah(Gn(e))}function uh(e){return mn(e),ah(Gn(Uint8Array.from(e).reverse()))}function we(e,t){return bs(e.toString(16).padStart(t*2,"0"))}function lh(e,t){return we(e,t).reverse()}function Ne(e,t,n){let r;if(typeof t=="string")try{r=bs(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if(ri(t))r=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(e+" of length "+n+" expected, got "+i);return r}function pe(...e){let t=0;for(let r=0;r<e.length;r++){const i=e[r];mn(i),t+=i.length}const n=new Uint8Array(t);for(let r=0,i=0;r<e.length;r++){const s=e[r];n.set(s,i),i+=s.length}return n}function ua(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}const la=e=>typeof e=="bigint"&&fa<=e;function ha(e,t,n){return la(e)&&la(t)&&la(n)&&t<=e&&e<n}function Sr(e,t,n,r){if(!ha(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}function si(e){let t;for(t=0;e>fa;e>>=gs,t+=1);return t}function hv(e,t){return e>>BigInt(t)&gs}const Zn=e=>(gs<<BigInt(e))-gs,da=e=>new Uint8Array(e),hh=e=>Uint8Array.from(e);function dv(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=da(e),i=da(e),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...d)=>n(i,r,...d),f=(d=da(0))=>{i=a(hh([0]),d),r=a(),d.length!==0&&(i=a(hh([1]),d),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const h=[];for(;d<t;){r=a();const l=r.slice();h.push(l),d+=r.length}return pe(...h)};return(d,h)=>{o(),f(d);let l;for(;!(l=h(c()));)f();return o(),l}}const gv={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||ri(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function oi(e,t,n={}){const r=(i,s,o)=>{const a=gv[s];if(typeof a!="function")throw new Error("invalid validator function");const f=e[i];if(!(o&&f===void 0)&&!a(f,e))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+f)};for(const[i,s]of Object.entries(t))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return e}const dh=()=>{throw new Error("not implemented")};function ga(e){const t=new WeakMap;return(n,...r)=>{const i=t.get(n);if(i!==void 0)return i;const s=e(n,...r);return t.set(n,s),s}}function pv(e,t){if(mh(e)>t)throw new Rv({givenSize:mh(e),maxSize:t})}const Yt={zero:48,nine:57,A:65,F:70,a:97,f:102};function gh(e){if(e>=Yt.zero&&e<=Yt.nine)return e-Yt.zero;if(e>=Yt.A&&e<=Yt.F)return e-(Yt.A-10);if(e>=Yt.a&&e<=Yt.f)return e-(Yt.a-10)}function bv(e,t={}){const{dir:n,size:r=32}=t;if(r===0)return e;if(e.length>r)throw new Nv({size:e.length,targetSize:r,type:"Bytes"});const i=new Uint8Array(r);for(let s=0;s<r;s++){const o=n==="right";i[o?s:r-s-1]=e[o?s:e.length-s-1]}return i}function pa(e,t){if(ya(e)>t)throw new xv({givenSize:ya(e),maxSize:t})}function ph(e,t={}){const{dir:n,size:r=32}=t;if(r===0)return e;const i=e.replace("0x","");if(i.length>r*2)throw new Sv({size:Math.ceil(i.length/2),targetSize:r,type:"Hex"});return`0x${i[n==="right"?"padEnd":"padStart"](r*2,"0")}`}const yv=new TextEncoder,mv=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function bh(...e){return`0x${e.reduce((t,n)=>t+n.replace("0x",""),"")}`}function wv(e,t={}){const n=`0x${Number(e)}`;return typeof t.size=="number"?(pa(n,t.size),ys(n,t.size)):n}function yh(e,t={}){let n="";for(let i=0;i<e.length;i++)n+=mv[e[i]];const r=`0x${n}`;return typeof t.size=="number"?(pa(r,t.size),ba(r,t.size)):r}function Ev(e,t={}){const{signed:n,size:r}=t,i=BigInt(e);let s;r?n?s=(1n<<BigInt(r)*8n-1n)-1n:s=2n**(BigInt(r)*8n)-1n:typeof e=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&n?-s-1n:0;if(s&&i>s||i<o){const c=typeof e=="bigint"?"n":"";throw new _v({max:s?`${s}${c}`:void 0,min:`${o}${c}`,signed:n,size:r,value:`${e}${c}`})}const f=`0x${(n&&i<0?(1n<<BigInt(r*8))+BigInt(i):i).toString(16)}`;return r?ys(f,r):f}function vv(e,t={}){return yh(yv.encode(e),t)}function ys(e,t){return ph(e,{dir:"left",size:t})}function ba(e,t){return ph(e,{dir:"right",size:t})}function ya(e){return Math.ceil((e.length-2)/2)}class _v extends Fe{constructor({max:t,min:n,signed:r,size:i,value:s}){super(`Number \`${s}\` is not in safe${i?` ${i*8}-bit`:""}${r?" signed":" unsigned"} integer range ${t?`(\`${n}\` to \`${t}\`)`:`(above \`${n}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class xv extends Fe{constructor({givenSize:t,maxSize:n}){super(`Size cannot exceed \`${n}\` bytes. Given size: \`${t}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class Sv extends Fe{constructor({size:t,targetSize:n,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${t}\`) exceeds padding size (\`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}const Iv=new TextEncoder;function Ov(e){return e instanceof Uint8Array?e:typeof e=="string"?Dv(e):Bv(e)}function Bv(e){return e instanceof Uint8Array?e:new Uint8Array(e)}function Dv(e,t={}){const{size:n}=t;let r=e;n&&(pa(e,n),r=ba(e,n));let i=r.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,o=new Uint8Array(s);for(let a=0,f=0;a<s;a++){const c=gh(i.charCodeAt(f++)),u=gh(i.charCodeAt(f++));if(c===void 0||u===void 0)throw new Fe(`Invalid byte sequence ("${i[f-2]}${i[f-1]}" in "${i}").`);o[a]=c*16+u}return o}function Av(e,t={}){const{size:n}=t,r=Iv.encode(e);return typeof n=="number"?(pv(r,n),Tv(r,n)):r}function Tv(e,t){return bv(e,{dir:"right",size:t})}function mh(e){return e.length}class Rv extends Fe{constructor({givenSize:t,maxSize:n}){super(`Size cannot exceed \`${n}\` bytes. Given size: \`${t}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class Nv extends Fe{constructor({size:t,targetSize:n,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${t}\`) exceeds padding size (\`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function Cv(e,t={}){const{as:n=typeof e=="string"?"Hex":"Bytes"}=t,r=rv(Ov(e));return n==="Bytes"?r:yh(r)}class Pv extends Map{constructor(t){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=t}get(t){const n=super.get(t);return super.has(t)&&n!==void 0&&(this.delete(t),super.set(t,n)),n}set(t,n){if(super.set(t,n),this.maxSize&&this.size>this.maxSize){const r=this.keys().next().value;r&&this.delete(r)}return this}}const ma={checksum:new Pv(8192)}.checksum,$v=/^0x[a-fA-F0-9]{40}$/;function wh(e,t={}){const{strict:n=!0}=t;if(!$v.test(e))throw new Eh({address:e,cause:new Uv});if(n){if(e.toLowerCase()===e)return;if(Lv(e)!==e)throw new Eh({address:e,cause:new Fv})}}function Lv(e){if(ma.has(e))return ma.get(e);wh(e,{strict:!1});const t=e.substring(2).toLowerCase(),n=Cv(Av(t),{as:"Bytes"}),r=t.split("");for(let s=0;s<40;s+=2)n[s>>1]>>4>=8&&r[s]&&(r[s]=r[s].toUpperCase()),(n[s>>1]&15)>=8&&r[s+1]&&(r[s+1]=r[s+1].toUpperCase());const i=`0x${r.join("")}`;return ma.set(e,i),i}class Eh extends Fe{constructor({address:t,cause:n}){super(`Address "${t}" is invalid.`,{cause:n}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class Uv extends Fe{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class Fv extends Fe{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}const jv=/^(.*)\[([0-9]*)\]$/,Mv=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,kv=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function wa(e,t){if(e.length!==t.length)throw new qv({expectedLength:e.length,givenLength:t.length});const n=[];for(let r=0;r<e.length;r++){const i=e[r],s=t[r];n.push(wa.encode(i,s))}return bh(...n)}(function(e){function t(n,r,i=!1){if(n==="address"){const f=r;return wh(f),ys(f.toLowerCase(),i?32:0)}if(n==="string")return vv(r);if(n==="bytes")return r;if(n==="bool")return ys(wv(r),i?32:1);const s=n.match(kv);if(s){const[f,c,u="256"]=s,d=Number.parseInt(u,10)/8;return Ev(r,{size:i?32:d,signed:c==="int"})}const o=n.match(Mv);if(o){const[f,c]=o;if(Number.parseInt(c,10)!==(r.length-2)/2)throw new zv({expectedSize:Number.parseInt(c,10),value:r});return ba(r,i?32:0)}const a=n.match(jv);if(a&&Array.isArray(r)){const[f,c]=a,u=[];for(let d=0;d<r.length;d++)u.push(t(c,r[d],!0));return u.length===0?"0x":bh(...u)}throw new Hv(n)}e.encode=t})(wa||(wa={}));class zv extends Fe{constructor({expectedSize:t,value:n}){super(`Size of bytes "${n}" (bytes${ya(n)}) does not match expected size (bytes${t}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}}class qv extends Fe{constructor({expectedLength:t,givenLength:n}){super(["ABI encoding parameters/values length mismatch.",`Expected length (parameters): ${t}`,`Given length (values): ${n}`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}}class Hv extends Fe{constructor(t){super(`Type \`${t}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}}class vh extends aa{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,ql(t);const r=cs(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?t.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=t.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),gn(s)}update(t){return wr(this),this.iHash.update(t),this}digestInto(t){wr(this),qt(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return t=t,t.finished=i,t.destroyed=s,t.blockLen=o,t.outputLen=a,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Ea=(e,t,n)=>new vh(e,t).update(n).digest();Ea.create=(e,t)=>new vh(e,t);const Ye=BigInt(0),Me=BigInt(1),Yn=BigInt(2),Vv=BigInt(3),_h=BigInt(4),xh=BigInt(5),Sh=BigInt(8);function ke(e,t){const n=e%t;return n>=Ye?n:t+n}function gt(e,t,n){let r=e;for(;t-- >Ye;)r*=r,r%=n;return r}function va(e,t){if(e===Ye)throw new Error("invert: expected non-zero number");if(t<=Ye)throw new Error("invert: expected positive modulus, got "+t);let n=ke(e,t),r=t,i=Ye,s=Me;for(;n!==Ye;){const a=r/n,f=r%n,c=i-s*a;r=n,n=f,i=s,s=c}if(r!==Me)throw new Error("invert: does not exist");return ke(i,t)}function Ih(e,t){const n=(e.ORDER+Me)/_h,r=e.pow(t,n);if(!e.eql(e.sqr(r),t))throw new Error("Cannot find square root");return r}function Kv(e,t){const n=(e.ORDER-xh)/Sh,r=e.mul(t,Yn),i=e.pow(r,n),s=e.mul(t,i),o=e.mul(e.mul(s,Yn),i),a=e.mul(s,e.sub(o,e.ONE));if(!e.eql(e.sqr(a),t))throw new Error("Cannot find square root");return a}function Gv(e){if(e<BigInt(3))throw new Error("sqrt is not defined for small field");let t=e-Me,n=0;for(;t%Yn===Ye;)t/=Yn,n++;let r=Yn;const i=wn(e);for(;ws(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return Ih;let s=i.pow(r,t);const o=(t+Me)/Yn;return function(f,c){if(f.is0(c))return c;if(ws(f,c)!==1)throw new Error("Cannot find square root");let u=n,d=f.mul(f.ONE,s),h=f.pow(c,t),l=f.pow(c,o);for(;!f.eql(h,f.ONE);){if(f.is0(h))return f.ZERO;let b=1,m=f.sqr(h);for(;!f.eql(m,f.ONE);)if(b++,m=f.sqr(m),b===u)throw new Error("Cannot find square root");const v=Me<<BigInt(u-b-1),D=f.pow(d,v);u=b,d=f.sqr(D),h=f.mul(h,d),l=f.mul(l,D)}return l}}function Zv(e){return e%_h===Vv?Ih:e%Sh===xh?Kv:Gv(e)}const Yv=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Oh(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=Yv.reduce((r,i)=>(r[i]="function",r),t);return oi(e,n)}function ms(e,t,n){if(n<Ye)throw new Error("invalid exponent, negatives unsupported");if(n===Ye)return e.ONE;if(n===Me)return t;let r=e.ONE,i=t;for(;n>Ye;)n&Me&&(r=e.mul(r,i)),i=e.sqr(i),n>>=Me;return r}function Wn(e,t,n=!1){const r=new Array(t.length).fill(n?e.ZERO:void 0),i=t.reduce((o,a,f)=>e.is0(a)?o:(r[f]=o,e.mul(o,a)),e.ONE),s=e.inv(i);return t.reduceRight((o,a,f)=>e.is0(a)?o:(r[f]=e.mul(o,r[f]),e.mul(o,a)),s),r}function ws(e,t){const n=(e.ORDER-Me)/Yn,r=e.pow(t,n),i=e.eql(r,e.ONE),s=e.eql(r,e.ZERO),o=e.eql(r,e.neg(e.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function Bh(e,t){t!==void 0&&mr(t);const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function wn(e,t,n=!1,r={}){if(e<=Ye)throw new Error("invalid field: expected ORDER > 0, got "+e);const{nBitLength:i,nByteLength:s}=Bh(e,t);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:e,isLE:n,BITS:i,BYTES:s,MASK:Zn(i),ZERO:Ye,ONE:Me,create:f=>ke(f,e),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Ye<=f&&f<e},is0:f=>f===Ye,isOdd:f=>(f&Me)===Me,neg:f=>ke(-f,e),eql:(f,c)=>f===c,sqr:f=>ke(f*f,e),add:(f,c)=>ke(f+c,e),sub:(f,c)=>ke(f-c,e),mul:(f,c)=>ke(f*c,e),pow:(f,c)=>ms(a,f,c),div:(f,c)=>ke(f*va(c,e),e),sqrN:f=>f*f,addN:(f,c)=>f+c,subN:(f,c)=>f-c,mulN:(f,c)=>f*c,inv:f=>va(f,e),sqrt:r.sqrt||(f=>(o||(o=Zv(e)),o(a,f))),toBytes:f=>n?lh(f,s):we(f,s),fromBytes:f=>{if(f.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+f.length);return n?uh(f):je(f)},invertBatch:f=>Wn(a,f),cmov:(f,c,u)=>u?c:f});return Object.freeze(a)}function Dh(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function _a(e){const t=Dh(e);return t+Math.ceil(t/2)}function Ah(e,t,n=!1){const r=e.length,i=Dh(t),s=_a(t);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=n?uh(e):je(e),a=ke(o,t-Me)+Me;return n?lh(a,i):we(a,i)}const Th=BigInt(0),xa=BigInt(1);function Sa(e,t){const n=t.negate();return e?n:t}function Rh(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Ia(e,t){Rh(e,t);const n=Math.ceil(t/e)+1,r=2**(e-1),i=2**e,s=Zn(e),o=BigInt(e);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function Nh(e,t,n){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n;let a=Number(e&i),f=e>>o;a>r&&(a-=s,f+=xa);const c=t*r,u=c+Math.abs(a)-1,d=a===0,h=a<0,l=t%2!==0;return{nextN:f,offset:u,isZero:d,isNeg:h,isNegF:l,offsetF:c}}function Wv(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((n,r)=>{if(!(n instanceof t))throw new Error("invalid point at index "+r)})}function Xv(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((n,r)=>{if(!t.isValid(n))throw new Error("invalid scalar at index "+r)})}const Oa=new WeakMap,Ch=new WeakMap;function Ba(e){return Ch.get(e)||1}function Jv(e,t){return{constTimeNegate:Sa,hasPrecomputes(n){return Ba(n)!==1},unsafeLadder(n,r,i=e.ZERO){let s=n;for(;r>Th;)r&xa&&(i=i.add(s)),s=s.double(),r>>=xa;return i},precomputeWindow(n,r){const{windows:i,windowSize:s}=Ia(r,t),o=[];let a=n,f=a;for(let c=0;c<i;c++){f=a,o.push(f);for(let u=1;u<s;u++)f=f.add(a),o.push(f);a=f.double()}return o},wNAF(n,r,i){let s=e.ZERO,o=e.BASE;const a=Ia(n,t);for(let f=0;f<a.windows;f++){const{nextN:c,offset:u,isZero:d,isNeg:h,isNegF:l,offsetF:b}=Nh(i,f,a);i=c,d?o=o.add(Sa(l,r[b])):s=s.add(Sa(h,r[u]))}return{p:s,f:o}},wNAFUnsafe(n,r,i,s=e.ZERO){const o=Ia(n,t);for(let a=0;a<o.windows&&i!==Th;a++){const{nextN:f,offset:c,isZero:u,isNeg:d}=Nh(i,a,o);if(i=f,!u){const h=r[c];s=s.add(d?h.negate():h)}}return s},getPrecomputes(n,r,i){let s=Oa.get(r);return s||(s=this.precomputeWindow(r,n),n!==1&&Oa.set(r,i(s))),s},wNAFCached(n,r,i){const s=Ba(n);return this.wNAF(s,this.getPrecomputes(s,n,i),r)},wNAFCachedUnsafe(n,r,i,s){const o=Ba(n);return o===1?this.unsafeLadder(n,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,n,i),r,s)},setWindowSize(n,r){Rh(r,t),Ch.set(n,r),Oa.delete(n)}}}function Qv(e,t,n,r){Wv(n,e),Xv(r,t);const i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=e.ZERO,a=si(BigInt(i));let f=1;a>12?f=a-3:a>4?f=a-2:a>0&&(f=2);const c=Zn(f),u=new Array(Number(c)+1).fill(o),d=Math.floor((t.BITS-1)/f)*f;let h=o;for(let l=d;l>=0;l-=f){u.fill(o);for(let m=0;m<s;m++){const v=r[m],D=Number(v>>BigInt(l)&c);u[D]=u[D].add(n[m])}let b=o;for(let m=u.length-1,v=o;m>0;m--)v=v.add(u[m]),b=b.add(v);if(h=h.add(b),l!==0)for(let m=0;m<f;m++)h=h.double()}return h}function Ph(e){return Oh(e.Fp),oi(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Bh(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}function $h(e){e.lowS!==void 0&&ii("lowS",e.lowS),e.prehash!==void 0&&ii("prehash",e.prehash)}function e3(e){const t=Ph(e);oi(t,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:n,Fp:r,a:i}=t;if(n){if(!r.eql(i,r.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...t})}class t3 extends Error{constructor(t=""){super(t)}}const Wt={Err:t3,_tlv:{encode:(e,t)=>{const{Err:n}=Wt;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length&1)throw new n("tlv.encode: unpadded data");const r=t.length/2,i=ps(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?ps(i.length/2|128):"";return ps(e)+s+i+t},decode(e,t){const{Err:n}=Wt;let r=0;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length<2||t[r++]!==e)throw new n("tlv.decode: wrong tlv");const i=t[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const f=i&127;if(!f)throw new n("tlv.decode(long): indefinite length not supported");if(f>4)throw new n("tlv.decode(long): byte length is too big");const c=t.subarray(r,r+f);if(c.length!==f)throw new n("tlv.decode: length bytes not complete");if(c[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const u of c)o=o<<8|u;if(r+=f,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=t.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:t.subarray(r+o)}}},_int:{encode(e){const{Err:t}=Wt;if(e<_t)throw new t("integer: negative integers are not allowed");let n=ps(e);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return n},decode(e){const{Err:t}=Wt;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return je(e)}},toSig(e){const{Err:t,_int:n,_tlv:r}=Wt,i=Ne("signature",e),{v:s,l:o}=r.decode(48,i);if(o.length)throw new t("invalid signature: left bytes after parsing");const{v:a,l:f}=r.decode(2,s),{v:c,l:u}=r.decode(2,f);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(c)}},hexFromSig(e){const{_tlv:t,_int:n}=Wt,r=t.encode(2,n.encode(e.r)),i=t.encode(2,n.encode(e.s)),s=r+i;return t.encode(48,s)}};function Da(e,t){return Gn(we(e,t))}const _t=BigInt(0),ce=BigInt(1),En=BigInt(2),ai=BigInt(3),Aa=BigInt(4);function Ta(e){const t=e3(e),{Fp:n}=t,r=wn(t.n,t.nBitLength),i=t.toBytes||((x,_,R)=>{const $=_.toAffine();return pe(Uint8Array.from([4]),n.toBytes($.x),n.toBytes($.y))}),s=t.fromBytes||(x=>{const _=x.subarray(1),R=n.fromBytes(_.subarray(0,n.BYTES)),$=n.fromBytes(_.subarray(n.BYTES,2*n.BYTES));return{x:R,y:$}});function o(x){const{a:_,b:R}=t,$=n.sqr(x),F=n.mul($,x);return n.add(n.add(F,n.mul(x,_)),R)}function a(x,_){const R=n.sqr(_),$=o(x);return n.eql(R,$)}if(!a(t.Gx,t.Gy))throw new Error("bad curve params: generator point");const f=n.mul(n.pow(t.a,ai),Aa),c=n.mul(n.sqr(t.b),BigInt(27));if(n.is0(n.add(f,c)))throw new Error("bad curve params: a or b");function u(x){return ha(x,ce,t.n)}function d(x){const{allowedPrivateKeyLengths:_,nByteLength:R,wrapPrivateKey:$,n:F}=t;if(_&&typeof x!="bigint"){if(ri(x)&&(x=Gn(x)),typeof x!="string"||!_.includes(x.length))throw new Error("invalid private key");x=x.padStart(R*2,"0")}let U;try{U=typeof x=="bigint"?x:je(Ne("private key",x,R))}catch{throw new Error("invalid private key, expected hex or "+R+" bytes, got "+typeof x)}return $&&(U=ke(U,F)),Sr("private key",U,ce,F),U}function h(x){if(!(x instanceof m))throw new Error("ProjectivePoint expected")}const l=ga((x,_)=>{const{px:R,py:$,pz:F}=x;if(n.eql(F,n.ONE))return{x:R,y:$};const U=x.is0();_==null&&(_=U?n.ONE:n.inv(F));const A=n.mul(R,_),q=n.mul($,_),k=n.mul(F,_);if(U)return{x:n.ZERO,y:n.ZERO};if(!n.eql(k,n.ONE))throw new Error("invZ was invalid");return{x:A,y:q}}),b=ga(x=>{if(x.is0()){if(t.allowInfinityPoint&&!n.is0(x.py))return;throw new Error("bad point: ZERO")}const{x:_,y:R}=x.toAffine();if(!n.isValid(_)||!n.isValid(R))throw new Error("bad point: x or y not FE");if(!a(_,R))throw new Error("bad point: equation left != right");if(!x.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class m{constructor(_,R,$){if(_==null||!n.isValid(_))throw new Error("x required");if(R==null||!n.isValid(R)||n.is0(R))throw new Error("y required");if($==null||!n.isValid($))throw new Error("z required");this.px=_,this.py=R,this.pz=$,Object.freeze(this)}static fromAffine(_){const{x:R,y:$}=_||{};if(!_||!n.isValid(R)||!n.isValid($))throw new Error("invalid affine point");if(_ instanceof m)throw new Error("projective point not allowed");const F=U=>n.eql(U,n.ZERO);return F(R)&&F($)?m.ZERO:new m(R,$,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(_){const R=Wn(n,_.map($=>$.pz));return _.map(($,F)=>$.toAffine(R[F])).map(m.fromAffine)}static fromHex(_){const R=m.fromAffine(s(Ne("pointHex",_)));return R.assertValidity(),R}static fromPrivateKey(_){return m.BASE.multiply(d(_))}static msm(_,R){return Qv(m,r,_,R)}_setWindowSize(_){C.setWindowSize(this,_)}assertValidity(){b(this)}hasEvenY(){const{y:_}=this.toAffine();if(n.isOdd)return!n.isOdd(_);throw new Error("Field doesn't support isOdd")}equals(_){h(_);const{px:R,py:$,pz:F}=this,{px:U,py:A,pz:q}=_,k=n.eql(n.mul(R,q),n.mul(U,F)),E=n.eql(n.mul($,q),n.mul(A,F));return k&&E}negate(){return new m(this.px,n.neg(this.py),this.pz)}double(){const{a:_,b:R}=t,$=n.mul(R,ai),{px:F,py:U,pz:A}=this;let q=n.ZERO,k=n.ZERO,E=n.ZERO,p=n.mul(F,F),w=n.mul(U,U),g=n.mul(A,A),y=n.mul(F,U);return y=n.add(y,y),E=n.mul(F,A),E=n.add(E,E),q=n.mul(_,E),k=n.mul($,g),k=n.add(q,k),q=n.sub(w,k),k=n.add(w,k),k=n.mul(q,k),q=n.mul(y,q),E=n.mul($,E),g=n.mul(_,g),y=n.sub(p,g),y=n.mul(_,y),y=n.add(y,E),E=n.add(p,p),p=n.add(E,p),p=n.add(p,g),p=n.mul(p,y),k=n.add(k,p),g=n.mul(U,A),g=n.add(g,g),p=n.mul(g,y),q=n.sub(q,p),E=n.mul(g,w),E=n.add(E,E),E=n.add(E,E),new m(q,k,E)}add(_){h(_);const{px:R,py:$,pz:F}=this,{px:U,py:A,pz:q}=_;let k=n.ZERO,E=n.ZERO,p=n.ZERO;const w=t.a,g=n.mul(t.b,ai);let y=n.mul(R,U),S=n.mul($,A),I=n.mul(F,q),O=n.add(R,$),B=n.add(U,A);O=n.mul(O,B),B=n.add(y,S),O=n.sub(O,B),B=n.add(R,F);let T=n.add(U,q);return B=n.mul(B,T),T=n.add(y,I),B=n.sub(B,T),T=n.add($,F),k=n.add(A,q),T=n.mul(T,k),k=n.add(S,I),T=n.sub(T,k),p=n.mul(w,B),k=n.mul(g,I),p=n.add(k,p),k=n.sub(S,p),p=n.add(S,p),E=n.mul(k,p),S=n.add(y,y),S=n.add(S,y),I=n.mul(w,I),B=n.mul(g,B),S=n.add(S,I),I=n.sub(y,I),I=n.mul(w,I),B=n.add(B,I),y=n.mul(S,B),E=n.add(E,y),y=n.mul(T,B),k=n.mul(O,k),k=n.sub(k,y),y=n.mul(O,S),p=n.mul(T,p),p=n.add(p,y),new m(k,E,p)}subtract(_){return this.add(_.negate())}is0(){return this.equals(m.ZERO)}wNAF(_){return C.wNAFCached(this,_,m.normalizeZ)}multiplyUnsafe(_){const{endo:R,n:$}=t;Sr("scalar",_,_t,$);const F=m.ZERO;if(_===_t)return F;if(this.is0()||_===ce)return this;if(!R||C.hasPrecomputes(this))return C.wNAFCachedUnsafe(this,_,m.normalizeZ);let{k1neg:U,k1:A,k2neg:q,k2:k}=R.splitScalar(_),E=F,p=F,w=this;for(;A>_t||k>_t;)A&ce&&(E=E.add(w)),k&ce&&(p=p.add(w)),w=w.double(),A>>=ce,k>>=ce;return U&&(E=E.negate()),q&&(p=p.negate()),p=new m(n.mul(p.px,R.beta),p.py,p.pz),E.add(p)}multiply(_){const{endo:R,n:$}=t;Sr("scalar",_,ce,$);let F,U;if(R){const{k1neg:A,k1:q,k2neg:k,k2:E}=R.splitScalar(_);let{p,f:w}=this.wNAF(q),{p:g,f:y}=this.wNAF(E);p=C.constTimeNegate(A,p),g=C.constTimeNegate(k,g),g=new m(n.mul(g.px,R.beta),g.py,g.pz),F=p.add(g),U=w.add(y)}else{const{p:A,f:q}=this.wNAF(_);F=A,U=q}return m.normalizeZ([F,U])[0]}multiplyAndAddUnsafe(_,R,$){const F=m.BASE,U=(q,k)=>k===_t||k===ce||!q.equals(F)?q.multiplyUnsafe(k):q.multiply(k),A=U(this,R).add(U(_,$));return A.is0()?void 0:A}toAffine(_){return l(this,_)}isTorsionFree(){const{h:_,isTorsionFree:R}=t;if(_===ce)return!0;if(R)return R(m,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:_,clearCofactor:R}=t;return _===ce?this:R?R(m,this):this.multiplyUnsafe(t.h)}toRawBytes(_=!0){return ii("isCompressed",_),this.assertValidity(),i(m,this,_)}toHex(_=!0){return ii("isCompressed",_),Gn(this.toRawBytes(_))}}m.BASE=new m(t.Gx,t.Gy,n.ONE),m.ZERO=new m(n.ZERO,n.ONE,n.ZERO);const{endo:v,nBitLength:D}=t,C=Jv(m,v?Math.ceil(D/2):D);return{CURVE:t,ProjectivePoint:m,normPrivateKeyToScalar:d,weierstrassEquation:o,isWithinCurveOrder:u}}function n3(e){const t=Ph(e);return oi(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function r3(e){const t=n3(e),{Fp:n,n:r,nByteLength:i,nBitLength:s}=t,o=n.BYTES+1,a=2*n.BYTES+1;function f(g){return ke(g,r)}function c(g){return va(g,r)}const{ProjectivePoint:u,normPrivateKeyToScalar:d,weierstrassEquation:h,isWithinCurveOrder:l}=Ta({...t,toBytes(g,y,S){const I=y.toAffine(),O=n.toBytes(I.x),B=pe;return ii("isCompressed",S),S?B(Uint8Array.from([y.hasEvenY()?2:3]),O):B(Uint8Array.from([4]),O,n.toBytes(I.y))},fromBytes(g){const y=g.length,S=g[0],I=g.subarray(1);if(y===o&&(S===2||S===3)){const O=je(I);if(!ha(O,ce,n.ORDER))throw new Error("Point is not on curve");const B=h(O);let T;try{T=n.sqrt(B)}catch(j){const N=j instanceof Error?": "+j.message:"";throw new Error("Point is not on curve"+N)}const L=(T&ce)===ce;return(S&1)===1!==L&&(T=n.neg(T)),{x:O,y:T}}else if(y===a&&S===4){const O=n.fromBytes(I.subarray(0,n.BYTES)),B=n.fromBytes(I.subarray(n.BYTES,2*n.BYTES));return{x:O,y:B}}else{const O=o,B=a;throw new Error("invalid Point, expected length of "+O+", or uncompressed "+B+", got "+y)}}});function b(g){const y=r>>ce;return g>y}function m(g){return b(g)?f(-g):g}const v=(g,y,S)=>je(g.slice(y,S));class D{constructor(y,S,I){Sr("r",y,ce,r),Sr("s",S,ce,r),this.r=y,this.s=S,I!=null&&(this.recovery=I),Object.freeze(this)}static fromCompact(y){const S=i;return y=Ne("compactSignature",y,S*2),new D(v(y,0,S),v(y,S,2*S))}static fromDER(y){const{r:S,s:I}=Wt.toSig(Ne("DER",y));return new D(S,I)}assertValidity(){}addRecoveryBit(y){return new D(this.r,this.s,y)}recoverPublicKey(y){const{r:S,s:I,recovery:O}=this,B=F(Ne("msgHash",y));if(O==null||![0,1,2,3].includes(O))throw new Error("recovery id invalid");const T=O===2||O===3?S+t.n:S;if(T>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const L=(O&1)===0?"02":"03",P=u.fromHex(L+Da(T,n.BYTES)),j=c(T),N=f(-B*j),M=f(I*j),z=u.BASE.multiplyAndAddUnsafe(P,N,M);if(!z)throw new Error("point at infinify");return z.assertValidity(),z}hasHighS(){return b(this.s)}normalizeS(){return this.hasHighS()?new D(this.r,f(-this.s),this.recovery):this}toDERRawBytes(){return bs(this.toDERHex())}toDERHex(){return Wt.hexFromSig(this)}toCompactRawBytes(){return bs(this.toCompactHex())}toCompactHex(){const y=i;return Da(this.r,y)+Da(this.s,y)}}const C={isValidPrivateKey(g){try{return d(g),!0}catch{return!1}},normPrivateKeyToScalar:d,randomPrivateKey:()=>{const g=_a(t.n);return Ah(t.randomBytes(g),t.n)},precompute(g=8,y=u.BASE){return y._setWindowSize(g),y.multiply(BigInt(3)),y}};function x(g,y=!0){return u.fromPrivateKey(g).toRawBytes(y)}function _(g){if(typeof g=="bigint")return!1;if(g instanceof u)return!0;const S=Ne("key",g).length,I=n.BYTES,O=I+1,B=2*I+1;if(!(t.allowedPrivateKeyLengths||i===O))return S===O||S===B}function R(g,y,S=!0){if(_(g)===!0)throw new Error("first arg must be private key");if(_(y)===!1)throw new Error("second arg must be public key");return u.fromHex(y).multiply(d(g)).toRawBytes(S)}const $=t.bits2int||function(g){if(g.length>8192)throw new Error("input is too large");const y=je(g),S=g.length*8-s;return S>0?y>>BigInt(S):y},F=t.bits2int_modN||function(g){return f($(g))},U=Zn(s);function A(g){return Sr("num < 2^"+s,g,_t,U),we(g,i)}function q(g,y,S=k){if(["recovered","canonical"].some(H=>H in S))throw new Error("sign() legacy options not supported");const{hash:I,randomBytes:O}=t;let{lowS:B,prehash:T,extraEntropy:L}=S;B==null&&(B=!0),g=Ne("msgHash",g),$h(S),T&&(g=Ne("prehashed msgHash",I(g)));const P=F(g),j=d(y),N=[A(j),A(P)];if(L!=null&&L!==!1){const H=L===!0?O(n.BYTES):L;N.push(Ne("extraEntropy",H))}const M=pe(...N),z=P;function G(H){const K=$(H);if(!l(K))return;const J=c(K),ee=u.BASE.multiply(K).toAffine(),re=f(ee.x);if(re===_t)return;const he=f(J*f(z+re*j));if(he===_t)return;let de=(ee.x===re?0:2)|Number(ee.y&ce),fn=he;return B&&b(he)&&(fn=m(he),de^=1),new D(re,fn,de)}return{seed:M,k2sig:G}}const k={lowS:t.lowS,prehash:!1},E={lowS:t.lowS,prehash:!1};function p(g,y,S=k){const{seed:I,k2sig:O}=q(g,y,S),B=t;return dv(B.hash.outputLen,B.nByteLength,B.hmac)(I,O)}u.BASE._setWindowSize(8);function w(g,y,S,I=E){const O=g;y=Ne("msgHash",y),S=Ne("publicKey",S);const{lowS:B,prehash:T,format:L}=I;if($h(I),"strict"in I)throw new Error("options.strict was renamed to lowS");if(L!==void 0&&L!=="compact"&&L!=="der")throw new Error("format must be compact or der");const P=typeof O=="string"||ri(O),j=!P&&!L&&typeof O=="object"&&O!==null&&typeof O.r=="bigint"&&typeof O.s=="bigint";if(!P&&!j)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let N,M;try{if(j&&(N=new D(O.r,O.s)),P){try{L!=="compact"&&(N=D.fromDER(O))}catch(de){if(!(de instanceof Wt.Err))throw de}!N&&L!=="der"&&(N=D.fromCompact(O))}M=u.fromHex(S)}catch{return!1}if(!N||B&&N.hasHighS())return!1;T&&(y=t.hash(y));const{r:z,s:G}=N,H=F(y),K=c(G),J=f(H*K),ee=f(z*K),re=u.BASE.multiplyAndAddUnsafe(M,J,ee)?.toAffine();return re?f(re.x)===z:!1}return{CURVE:t,getPublicKey:x,getSharedSecret:R,sign:p,verify:w,ProjectivePoint:u,Signature:D,utils:C}}function i3(e,t){const n=e.ORDER;let r=_t;for(let b=n-ce;b%En===_t;b/=En)r+=ce;const i=r,s=En<<i-ce-ce,o=s*En,a=(n-ce)/o,f=(a-ce)/En,c=o-ce,u=s,d=e.pow(t,a),h=e.pow(t,(a+ce)/En);let l=(b,m)=>{let v=d,D=e.pow(m,c),C=e.sqr(D);C=e.mul(C,m);let x=e.mul(b,C);x=e.pow(x,f),x=e.mul(x,D),D=e.mul(x,m),C=e.mul(x,b);let _=e.mul(C,D);x=e.pow(_,u);let R=e.eql(x,e.ONE);D=e.mul(C,h),x=e.mul(_,v),C=e.cmov(D,C,R),_=e.cmov(x,_,R);for(let $=i;$>ce;$--){let F=$-En;F=En<<F-ce;let U=e.pow(_,F);const A=e.eql(U,e.ONE);D=e.mul(C,v),v=e.mul(v,v),U=e.mul(_,v),C=e.cmov(D,C,A),_=e.cmov(U,_,A)}return{isValid:R,value:C}};if(e.ORDER%Aa===ai){const b=(e.ORDER-ai)/Aa,m=e.sqrt(e.neg(t));l=(v,D)=>{let C=e.sqr(D);const x=e.mul(v,D);C=e.mul(C,x);let _=e.pow(C,b);_=e.mul(_,x);const R=e.mul(_,m),$=e.mul(e.sqr(_),D),F=e.eql($,v);let U=e.cmov(R,_,F);return{isValid:F,value:U}}}return l}function Lh(e,t){if(Oh(e),!e.isValid(t.A)||!e.isValid(t.B)||!e.isValid(t.Z))throw new Error("mapToCurveSimpleSWU: invalid opts");const n=i3(e,t.Z);if(!e.isOdd)throw new Error("Fp.isOdd is not implemented!");return r=>{let i,s,o,a,f,c,u,d;i=e.sqr(r),i=e.mul(i,t.Z),s=e.sqr(i),s=e.add(s,i),o=e.add(s,e.ONE),o=e.mul(o,t.B),a=e.cmov(t.Z,e.neg(s),!e.eql(s,e.ZERO)),a=e.mul(a,t.A),s=e.sqr(o),c=e.sqr(a),f=e.mul(c,t.A),s=e.add(s,f),s=e.mul(s,o),c=e.mul(c,a),f=e.mul(c,t.B),s=e.add(s,f),u=e.mul(i,o);const{isValid:h,value:l}=n(s,c);d=e.mul(i,r),d=e.mul(d,l),u=e.cmov(u,o,h),d=e.cmov(d,l,h);const b=e.isOdd(r)===e.isOdd(d);d=e.cmov(e.neg(d),d,b);const m=Wn(e,[a],!0)[0];return u=e.mul(u,m),{x:u,y:d}}}function s3(e){return{hash:e,hmac:(t,...n)=>Ea(e,t,Vt(...n)),randomBytes:us}}function Es(e,t){const n=r=>r3({...e,...s3(r)});return{...n(t),create:n}}const o3=je;function vn(e,t){if(ci(e),ci(t),e<0||e>=1<<8*t)throw new Error("invalid I2OSP input: "+e);const n=Array.from({length:t}).fill(0);for(let r=t-1;r>=0;r--)n[r]=e&255,e>>>=8;return new Uint8Array(n)}function a3(e,t){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e[r]^t[r];return n}function ci(e){if(!Number.isSafeInteger(e))throw new Error("number expected")}function c3(e,t,n,r){mn(e),mn(t),ci(n),t.length>255&&(t=r(pe(ua("H2C-OVERSIZE-DST-"),t)));const{outputLen:i,blockLen:s}=r,o=Math.ceil(n/i);if(n>65535||o>255)throw new Error("expand_message_xmd: invalid lenInBytes");const a=pe(t,vn(t.length,1)),f=vn(0,s),c=vn(n,2),u=new Array(o),d=r(pe(f,e,c,vn(0,1),a));u[0]=r(pe(d,vn(1,1),a));for(let l=1;l<=o;l++){const b=[a3(d,u[l-1]),vn(l+1,1),a];u[l]=r(pe(...b))}return pe(...u).slice(0,n)}function f3(e,t,n,r,i){if(mn(e),mn(t),ci(n),t.length>255){const s=Math.ceil(2*r/8);t=i.create({dkLen:s}).update(ua("H2C-OVERSIZE-DST-")).update(t).digest()}if(n>65535||t.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return i.create({dkLen:n}).update(e).update(vn(n,2)).update(t).update(vn(t.length,1)).digest()}function Uh(e,t,n){oi(n,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});const{p:r,k:i,m:s,hash:o,expand:a,DST:f}=n;mn(e),ci(t);const c=typeof f=="string"?ua(f):f,u=r.toString(2).length,d=Math.ceil((u+i)/8),h=t*s*d;let l;if(a==="xmd")l=c3(e,c,h,o);else if(a==="xof")l=f3(e,c,h,i,o);else if(a==="_internal_pass")l=e;else throw new Error('expand must be "xmd" or "xof"');const b=new Array(t);for(let m=0;m<t;m++){const v=new Array(s);for(let D=0;D<s;D++){const C=d*(D+m*s),x=l.subarray(C,C+d);v[D]=ke(o3(x),r)}b[m]=v}return b}function Fh(e,t){const n=t.map(r=>Array.from(r).reverse());return(r,i)=>{const[s,o,a,f]=n.map(d=>d.reduce((h,l)=>e.add(e.mul(h,r),l))),[c,u]=Wn(e,[o,f],!0);return r=e.mul(s,c),i=e.mul(i,e.mul(a,u)),{x:r,y:i}}}function jh(e,t,n){if(typeof t!="function")throw new Error("mapToCurve() must be defined");function r(s){return e.fromAffine(t(s))}function i(s){const o=s.clearCofactor();return o.equals(e.ZERO)?e.ZERO:(o.assertValidity(),o)}return{defaults:n,hashToCurve(s,o){const a=Uh(s,2,{...n,DST:n.DST,...o}),f=r(a[0]),c=r(a[1]);return i(f.add(c))},encodeToCurve(s,o){const a=Uh(s,1,{...n,DST:n.encodeDST,...o});return i(r(a[0]))},mapToCurve(s){if(!Array.isArray(s))throw new Error("expected array of bigints");for(const o of s)if(typeof o!="bigint")throw new Error("expected array of bigints");return i(r(s))}}}const Mh=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),kh=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),u3=BigInt(0),l3=BigInt(1),Ra=BigInt(2),zh=(e,t)=>(e+t/Ra)/t;function h3(e){const t=Mh,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),f=BigInt(88),c=e*e*e%t,u=c*c*e%t,d=gt(u,n,t)*u%t,h=gt(d,n,t)*u%t,l=gt(h,Ra,t)*c%t,b=gt(l,i,t)*l%t,m=gt(b,s,t)*b%t,v=gt(m,a,t)*m%t,D=gt(v,f,t)*v%t,C=gt(D,a,t)*m%t,x=gt(C,n,t)*u%t,_=gt(x,o,t)*b%t,R=gt(_,r,t)*c%t,$=gt(R,Ra,t);if(!Na.eql(Na.sqr($),e))throw new Error("Cannot find square root");return $}const Na=wn(Mh,void 0,void 0,{sqrt:h3});Es({a:u3,b:BigInt(7),Fp:Na,n:kh,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=kh,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-l3*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=zh(s*e,t),f=zh(-r*e,t);let c=ke(e-a*n-f*i,t),u=ke(-a*r-f*s,t);const d=c>o,h=u>o;if(d&&(c=t-c),h&&(u=t-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:d,k1:c,k2neg:h,k2:u}}}},xr),Object.freeze({1:0n,2:1n,3:2n,4:3n,5:4n,6:5n,7:6n,8:7n,9:8n,A:9n,B:10n,C:11n,D:12n,E:13n,F:14n,G:15n,H:16n,J:17n,K:18n,L:19n,M:20n,N:21n,P:22n,Q:23n,R:24n,S:25n,T:26n,U:27n,V:28n,W:29n,X:30n,Y:31n,Z:32n,a:33n,b:34n,c:35n,d:36n,e:37n,f:38n,g:39n,h:40n,i:41n,j:42n,k:43n,m:44n,n:45n,o:46n,p:47n,q:48n,r:49n,s:50n,t:51n,u:52n,v:53n,w:54n,x:55n,y:56n,z:57n}),Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").map((e,t)=>[t,e.charCodeAt(0)]),{...Object.fromEntries(Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").map((e,t)=>[e.charCodeAt(0),t]))},Kt.slice();const d3=BigInt(0),vs=BigInt(1),qh=BigInt(2),Ir=BigInt(3);function g3(e){const t=[];for(;e>vs;e>>=vs)(e&vs)===d3?t.unshift(0):(e&Ir)===Ir?(t.unshift(-1),e+=vs):t.unshift(1);return t}function p3(e){const{Fp:t,Fr:n,Fp2:r,Fp6:i,Fp12:s}=e.fields,o=e.params.xNegative,a=e.params.twistType,f=Ta({n:n.ORDER,...e.G1}),c=Object.assign(f,jh(f.ProjectivePoint,e.G1.mapToCurve,{...e.htfDefaults,...e.G1.htfDefaults})),u=Ta({n:n.ORDER,...e.G2}),d=Object.assign(u,jh(u.ProjectivePoint,e.G2.mapToCurve,{...e.htfDefaults,...e.G2.htfDefaults}));let h;if(a==="multiplicative")h=(P,j,N,M,z,G)=>s.mul014(M,P,r.mul(j,z),r.mul(N,G));else if(a==="divisive")h=(P,j,N,M,z,G)=>s.mul034(M,r.mul(N,G),r.mul(j,z),P);else throw new Error("bls: unknown twist type");const l=r.div(r.ONE,r.mul(r.ONE,qh));function b(P,j,N,M){const z=r.sqr(N),G=r.sqr(M),H=r.mulByB(r.mul(G,Ir)),K=r.mul(H,Ir),J=r.sub(r.sub(r.sqr(r.add(N,M)),G),z),ee=r.sub(H,z),re=r.mul(r.sqr(j),Ir),he=r.neg(J);return P.push([ee,re,he]),j=r.mul(r.mul(r.mul(r.sub(z,K),j),N),l),N=r.sub(r.sqr(r.mul(r.add(z,K),l)),r.mul(r.sqr(H),Ir)),M=r.mul(z,J),{Rx:j,Ry:N,Rz:M}}function m(P,j,N,M,z,G){const H=r.sub(N,r.mul(G,M)),K=r.sub(j,r.mul(z,M)),J=r.sub(r.mul(H,z),r.mul(K,G)),ee=r.neg(H),re=K;P.push([J,ee,re]);const he=r.sqr(K),de=r.mul(he,K),fn=r.mul(he,j),co=r.add(r.sub(de,r.mul(fn,qh)),r.mul(r.sqr(H),M));return j=r.mul(K,co),N=r.sub(r.mul(r.sub(fn,co),H),r.mul(de,N)),M=r.mul(M,de),{Rx:j,Ry:N,Rz:M}}const v=g3(e.params.ateLoopSize),D=ga(P=>{const j=P,{x:N,y:M}=j.toAffine(),z=N,G=M,H=r.neg(M);let K=z,J=G,ee=r.ONE;const re=[];for(const he of v){const de=[];({Rx:K,Ry:J,Rz:ee}=b(de,K,J,ee)),he&&({Rx:K,Ry:J,Rz:ee}=m(de,K,J,ee,z,he===-1?H:G)),re.push(de)}if(e.postPrecompute){const he=re[re.length-1];e.postPrecompute(K,J,ee,z,G,m.bind(null,he))}return re});function C(P,j=!1){let N=s.ONE;if(P.length){const M=P[0][0].length;for(let z=0;z<M;z++){N=s.sqr(N);for(const[G,H,K]of P)for(const[J,ee,re]of G[z])N=h(J,ee,re,N,H,K)}}return o&&(N=s.conjugate(N)),j?s.finalExponentiate(N):N}function x(P,j=!0){const N=[];c.ProjectivePoint.normalizeZ(P.map(({g1:M})=>M)),d.ProjectivePoint.normalizeZ(P.map(({g2:M})=>M));for(const{g1:M,g2:z}of P){if(M.equals(c.ProjectivePoint.ZERO)||z.equals(d.ProjectivePoint.ZERO))throw new Error("pairing is not available for ZERO point");M.assertValidity(),z.assertValidity();const G=M.toAffine();N.push([D(z),G.x,G.y])}return C(N,j)}function _(P,j,N=!0){return x([{g1:P,g2:j}],N)}const R={randomPrivateKey:()=>{const P=_a(n.ORDER);return Ah(e.randomBytes(P),n.ORDER)},calcPairingPrecomputes:D},{ShortSignature:$}=e.G1,{Signature:F}=e.G2;function U(P){return P instanceof c.ProjectivePoint?P:c.ProjectivePoint.fromHex(P)}function A(P,j){return P instanceof c.ProjectivePoint?P:c.hashToCurve(Ne("point",P),j)}function q(P){return P instanceof d.ProjectivePoint?P:F.fromHex(P)}function k(P,j){return P instanceof d.ProjectivePoint?P:d.hashToCurve(Ne("point",P),j)}function E(P){return c.ProjectivePoint.fromPrivateKey(P).toRawBytes(!0)}function p(P){return d.ProjectivePoint.fromPrivateKey(P).toRawBytes(!0)}function w(P,j,N){const M=k(P,N);M.assertValidity();const z=M.multiply(c.normPrivateKeyToScalar(j));return P instanceof d.ProjectivePoint?z:F.toRawBytes(z)}function g(P,j,N){const M=A(P,N);M.assertValidity();const z=M.multiply(c.normPrivateKeyToScalar(j));return P instanceof c.ProjectivePoint?z:$.toRawBytes(z)}function y(P,j,N,M){const z=U(N),G=k(j,M),H=c.ProjectivePoint.BASE,K=q(P),J=x([{g1:z.negate(),g2:G},{g1:H,g2:K}]);return s.eql(J,s.ONE)}function S(P,j,N,M){const z=q(N),G=A(j,M),H=d.ProjectivePoint.BASE,K=U(P),J=x([{g1:G,g2:z},{g1:K,g2:H.negate()}]);return s.eql(J,s.ONE)}function I(P){if(!Array.isArray(P)||P.length===0)throw new Error("expected non-empty array")}function O(P){I(P);const N=P.map(U).reduce((M,z)=>M.add(z),c.ProjectivePoint.ZERO);return P[0]instanceof c.ProjectivePoint?(N.assertValidity(),N):N.toRawBytes(!0)}function B(P){I(P);const N=P.map(q).reduce((M,z)=>M.add(z),d.ProjectivePoint.ZERO);return P[0]instanceof d.ProjectivePoint?(N.assertValidity(),N):F.toRawBytes(N)}function T(P){I(P);const N=P.map(U).reduce((M,z)=>M.add(z),c.ProjectivePoint.ZERO);return P[0]instanceof c.ProjectivePoint?(N.assertValidity(),N):$.toRawBytes(N)}function L(P,j,N,M){if(I(j),N.length!==j.length)throw new Error("amount of public keys and messages should be equal");const z=q(P),G=j.map(ee=>k(ee,M)),H=N.map(U),K=new Map;for(let ee=0;ee<H.length;ee++){const re=H[ee],he=G[ee];let de=K.get(he);de===void 0&&(de=[],K.set(he,de)),de.push(re)}const J=[];try{for(const[ee,re]of K){const he=re.reduce((de,fn)=>de.add(fn));J.push({g1:he,g2:ee})}return J.push({g1:c.ProjectivePoint.BASE.negate(),g2:z}),s.eql(x(J),s.ONE)}catch{return!1}}return c.ProjectivePoint.BASE._setWindowSize(4),{getPublicKey:E,getPublicKeyForShortSignatures:p,sign:w,signShortSignature:g,verify:y,verifyBatch:L,verifyShortSignature:S,aggregatePublicKeys:O,aggregateSignatures:B,aggregateShortSignatures:T,millerLoopBatch:C,pairing:_,pairingBatch:x,G1:c,G2:d,Signature:F,ShortSignature:$,fields:{Fr:n,Fp:t,Fp2:r,Fp6:i,Fp12:s},params:{ateLoopSize:e.params.ateLoopSize,r:e.params.r,G1b:e.G1.b,G2b:e.G2.b},utils:R}}const b3=BigInt(0),Or=BigInt(1),Xt=BigInt(2),Hh=BigInt(3);function Ca(e,t,n,r,i=1,s){const o=BigInt(s===void 0?r:s),a=n**BigInt(r),f=[];for(let c=0;c<i;c++){const u=BigInt(c+1),d=[];for(let h=0,l=Or;h<r;h++){const b=(u*l-u)/o%a;d.push(e.pow(t,b)),l*=n}f.push(d)}return f}function y3(e,t,n){const r=t.pow(n,(e.ORDER-Or)/Hh),i=t.pow(n,(e.ORDER-Or)/Xt);function s(h,l){const b=t.mul(t.frobeniusMap(h,1),r),m=t.mul(t.frobeniusMap(l,1),i);return[b,m]}const o=t.pow(n,(e.ORDER**Xt-Or)/Hh),a=t.pow(n,(e.ORDER**Xt-Or)/Xt);if(!t.eql(a,t.neg(t.ONE)))throw new Error("psiFrobenius: PSI2_Y!==-1");function f(h,l){return[t.mul(h,o),t.neg(l)]}const c=h=>(l,b)=>{const m=b.toAffine(),v=h(m.x,m.y);return l.fromAffine({x:v[0],y:v[1]})},u=c(s),d=c(f);return{psi:s,psi2:f,G2psi:u,G2psi2:d,PSI_X:r,PSI_Y:i,PSI2_X:o,PSI2_Y:a}}function m3(e){const{ORDER:t}=e,n=wn(t),r=n.create(e.NONRESIDUE||BigInt(-1)),i=n.div(n.ONE,Xt),s=Ca(n,r,n.ORDER,2)[0],o=({c0:E,c1:p},{c0:w,c1:g})=>({c0:n.add(E,w),c1:n.add(p,g)}),a=({c0:E,c1:p},{c0:w,c1:g})=>({c0:n.sub(E,w),c1:n.sub(p,g)}),f=({c0:E,c1:p},w)=>{if(typeof w=="bigint")return{c0:n.mul(E,w),c1:n.mul(p,w)};const{c0:g,c1:y}=w;let S=n.mul(E,g),I=n.mul(p,y);const O=n.sub(S,I),B=n.sub(n.mul(n.add(E,p),n.add(g,y)),n.add(S,I));return{c0:O,c1:B}},c=({c0:E,c1:p})=>{const w=n.add(E,p),g=n.sub(E,p),y=n.add(E,E);return{c0:n.mul(w,g),c1:n.mul(y,p)}},u=E=>{if(E.length!==2)throw new Error("invalid tuple");const p=E.map(w=>n.create(w));return{c0:p[0],c1:p[1]}},d=t*t,h=u(e.FP2_NONRESIDUE),l={ORDER:d,isLE:n.isLE,NONRESIDUE:h,BITS:si(d),BYTES:Math.ceil(si(d)/8),MASK:Zn(si(d)),ZERO:{c0:n.ZERO,c1:n.ZERO},ONE:{c0:n.ONE,c1:n.ZERO},create:E=>E,isValid:({c0:E,c1:p})=>typeof E=="bigint"&&typeof p=="bigint",is0:({c0:E,c1:p})=>n.is0(E)&&n.is0(p),eql:({c0:E,c1:p},{c0:w,c1:g})=>n.eql(E,w)&&n.eql(p,g),neg:({c0:E,c1:p})=>({c0:n.neg(E),c1:n.neg(p)}),pow:(E,p)=>ms(l,E,p),invertBatch:E=>Wn(l,E),add:o,sub:a,mul:f,sqr:c,addN:o,subN:a,mulN:f,sqrN:c,div:(E,p)=>l.mul(E,typeof p=="bigint"?n.inv(n.create(p)):l.inv(p)),inv:({c0:E,c1:p})=>{const w=n.inv(n.create(E*E+p*p));return{c0:n.mul(w,n.create(E)),c1:n.mul(w,n.create(-p))}},sqrt:E=>{if(e.Fp2sqrt)return e.Fp2sqrt(E);const{c0:p,c1:w}=E;if(n.is0(w))return ws(n,p)===1?l.create({c0:n.sqrt(p),c1:n.ZERO}):l.create({c0:n.ZERO,c1:n.sqrt(n.div(p,r))});const g=n.sqrt(n.sub(n.sqr(p),n.mul(n.sqr(w),r)));let y=n.mul(n.add(g,p),i);ws(n,y)===-1&&(y=n.sub(y,g));const I=n.sqrt(y),O=l.create({c0:I,c1:n.div(n.mul(w,i),I)});if(!l.eql(l.sqr(O),E))throw new Error("Cannot find square root");const B=O,T=l.neg(B),{re:L,im:P}=l.reim(B),{re:j,im:N}=l.reim(T);return P>N||P===N&&L>j?B:T},isOdd:E=>{const{re:p,im:w}=l.reim(E),g=p%Xt,y=p===b3,S=w%Xt;return BigInt(g||y&&S)==Or},fromBytes(E){if(E.length!==l.BYTES)throw new Error("fromBytes invalid length="+E.length);return{c0:n.fromBytes(E.subarray(0,n.BYTES)),c1:n.fromBytes(E.subarray(n.BYTES))}},toBytes:({c0:E,c1:p})=>pe(n.toBytes(E),n.toBytes(p)),cmov:({c0:E,c1:p},{c0:w,c1:g},y)=>({c0:n.cmov(E,w,y),c1:n.cmov(p,g,y)}),reim:({c0:E,c1:p})=>({re:E,im:p}),mulByNonresidue:({c0:E,c1:p})=>l.mul({c0:E,c1:p},h),mulByB:e.Fp2mulByB,fromBigTuple:u,frobeniusMap:({c0:E,c1:p},w)=>({c0:E,c1:n.mul(p,s[w%2])})},b=({c0:E,c1:p,c2:w},{c0:g,c1:y,c2:S})=>({c0:l.add(E,g),c1:l.add(p,y),c2:l.add(w,S)}),m=({c0:E,c1:p,c2:w},{c0:g,c1:y,c2:S})=>({c0:l.sub(E,g),c1:l.sub(p,y),c2:l.sub(w,S)}),v=({c0:E,c1:p,c2:w},g)=>{if(typeof g=="bigint")return{c0:l.mul(E,g),c1:l.mul(p,g),c2:l.mul(w,g)};const{c0:y,c1:S,c2:I}=g,O=l.mul(E,y),B=l.mul(p,S),T=l.mul(w,I);return{c0:l.add(O,l.mulByNonresidue(l.sub(l.mul(l.add(p,w),l.add(S,I)),l.add(B,T)))),c1:l.add(l.sub(l.mul(l.add(E,p),l.add(y,S)),l.add(O,B)),l.mulByNonresidue(T)),c2:l.sub(l.add(B,l.mul(l.add(E,w),l.add(y,I))),l.add(O,T))}},D=({c0:E,c1:p,c2:w})=>{let g=l.sqr(E),y=l.mul(l.mul(E,p),Xt),S=l.mul(l.mul(p,w),Xt),I=l.sqr(w);return{c0:l.add(l.mulByNonresidue(S),g),c1:l.add(l.mulByNonresidue(I),y),c2:l.sub(l.sub(l.add(l.add(y,l.sqr(l.add(l.sub(E,p),w))),S),g),I)}},[C,x]=Ca(l,h,n.ORDER,6,2,3),_={ORDER:l.ORDER,isLE:l.isLE,BITS:3*l.BITS,BYTES:3*l.BYTES,MASK:Zn(3*l.BITS),ZERO:{c0:l.ZERO,c1:l.ZERO,c2:l.ZERO},ONE:{c0:l.ONE,c1:l.ZERO,c2:l.ZERO},create:E=>E,isValid:({c0:E,c1:p,c2:w})=>l.isValid(E)&&l.isValid(p)&&l.isValid(w),is0:({c0:E,c1:p,c2:w})=>l.is0(E)&&l.is0(p)&&l.is0(w),neg:({c0:E,c1:p,c2:w})=>({c0:l.neg(E),c1:l.neg(p),c2:l.neg(w)}),eql:({c0:E,c1:p,c2:w},{c0:g,c1:y,c2:S})=>l.eql(E,g)&&l.eql(p,y)&&l.eql(w,S),sqrt:dh,div:(E,p)=>_.mul(E,typeof p=="bigint"?n.inv(n.create(p)):_.inv(p)),pow:(E,p)=>ms(_,E,p),invertBatch:E=>Wn(_,E),add:b,sub:m,mul:v,sqr:D,addN:b,subN:m,mulN:v,sqrN:D,inv:({c0:E,c1:p,c2:w})=>{let g=l.sub(l.sqr(E),l.mulByNonresidue(l.mul(w,p))),y=l.sub(l.mulByNonresidue(l.sqr(w)),l.mul(E,p)),S=l.sub(l.sqr(p),l.mul(E,w)),I=l.inv(l.add(l.mulByNonresidue(l.add(l.mul(w,y),l.mul(p,S))),l.mul(E,g)));return{c0:l.mul(I,g),c1:l.mul(I,y),c2:l.mul(I,S)}},fromBytes:E=>{if(E.length!==_.BYTES)throw new Error("fromBytes invalid length="+E.length);return{c0:l.fromBytes(E.subarray(0,l.BYTES)),c1:l.fromBytes(E.subarray(l.BYTES,2*l.BYTES)),c2:l.fromBytes(E.subarray(2*l.BYTES))}},toBytes:({c0:E,c1:p,c2:w})=>pe(l.toBytes(E),l.toBytes(p),l.toBytes(w)),cmov:({c0:E,c1:p,c2:w},{c0:g,c1:y,c2:S},I)=>({c0:l.cmov(E,g,I),c1:l.cmov(p,y,I),c2:l.cmov(w,S,I)}),fromBigSix:E=>{if(!Array.isArray(E)||E.length!==6)throw new Error("invalid Fp6 usage");return{c0:l.fromBigTuple(E.slice(0,2)),c1:l.fromBigTuple(E.slice(2,4)),c2:l.fromBigTuple(E.slice(4,6))}},frobeniusMap:({c0:E,c1:p,c2:w},g)=>({c0:l.frobeniusMap(E,g),c1:l.mul(l.frobeniusMap(p,g),C[g%6]),c2:l.mul(l.frobeniusMap(w,g),x[g%6])}),mulByFp2:({c0:E,c1:p,c2:w},g)=>({c0:l.mul(E,g),c1:l.mul(p,g),c2:l.mul(w,g)}),mulByNonresidue:({c0:E,c1:p,c2:w})=>({c0:l.mulByNonresidue(w),c1:E,c2:p}),mul1:({c0:E,c1:p,c2:w},g)=>({c0:l.mulByNonresidue(l.mul(w,g)),c1:l.mul(E,g),c2:l.mul(p,g)}),mul01({c0:E,c1:p,c2:w},g,y){let S=l.mul(E,g),I=l.mul(p,y);return{c0:l.add(l.mulByNonresidue(l.sub(l.mul(l.add(p,w),y),I)),S),c1:l.sub(l.sub(l.mul(l.add(g,y),l.add(E,p)),S),I),c2:l.add(l.sub(l.mul(l.add(E,w),g),S),I)}}},R=Ca(l,h,n.ORDER,12,1,6)[0],$=({c0:E,c1:p},{c0:w,c1:g})=>({c0:_.add(E,w),c1:_.add(p,g)}),F=({c0:E,c1:p},{c0:w,c1:g})=>({c0:_.sub(E,w),c1:_.sub(p,g)}),U=({c0:E,c1:p},w)=>{if(typeof w=="bigint")return{c0:_.mul(E,w),c1:_.mul(p,w)};let{c0:g,c1:y}=w,S=_.mul(E,g),I=_.mul(p,y);return{c0:_.add(S,_.mulByNonresidue(I)),c1:_.sub(_.mul(_.add(E,p),_.add(g,y)),_.add(S,I))}},A=({c0:E,c1:p})=>{let w=_.mul(E,p);return{c0:_.sub(_.sub(_.mul(_.add(_.mulByNonresidue(p),E),_.add(E,p)),w),_.mulByNonresidue(w)),c1:_.add(w,w)}};function q(E,p){const w=l.sqr(E),g=l.sqr(p);return{first:l.add(l.mulByNonresidue(g),w),second:l.sub(l.sub(l.sqr(l.add(E,p)),w),g)}}const k={ORDER:l.ORDER,isLE:_.isLE,BITS:2*_.BITS,BYTES:2*_.BYTES,MASK:Zn(2*_.BITS),ZERO:{c0:_.ZERO,c1:_.ZERO},ONE:{c0:_.ONE,c1:_.ZERO},create:E=>E,isValid:({c0:E,c1:p})=>_.isValid(E)&&_.isValid(p),is0:({c0:E,c1:p})=>_.is0(E)&&_.is0(p),neg:({c0:E,c1:p})=>({c0:_.neg(E),c1:_.neg(p)}),eql:({c0:E,c1:p},{c0:w,c1:g})=>_.eql(E,w)&&_.eql(p,g),sqrt:dh,inv:({c0:E,c1:p})=>{let w=_.inv(_.sub(_.sqr(E),_.mulByNonresidue(_.sqr(p))));return{c0:_.mul(E,w),c1:_.neg(_.mul(p,w))}},div:(E,p)=>k.mul(E,typeof p=="bigint"?n.inv(n.create(p)):k.inv(p)),pow:(E,p)=>ms(k,E,p),invertBatch:E=>Wn(k,E),add:$,sub:F,mul:U,sqr:A,addN:$,subN:F,mulN:U,sqrN:A,fromBytes:E=>{if(E.length!==k.BYTES)throw new Error("fromBytes invalid length="+E.length);return{c0:_.fromBytes(E.subarray(0,_.BYTES)),c1:_.fromBytes(E.subarray(_.BYTES))}},toBytes:({c0:E,c1:p})=>pe(_.toBytes(E),_.toBytes(p)),cmov:({c0:E,c1:p},{c0:w,c1:g},y)=>({c0:_.cmov(E,w,y),c1:_.cmov(p,g,y)}),fromBigTwelve:E=>({c0:_.fromBigSix(E.slice(0,6)),c1:_.fromBigSix(E.slice(6,12))}),frobeniusMap(E,p){const{c0:w,c1:g,c2:y}=_.frobeniusMap(E.c1,p),S=R[p%12];return{c0:_.frobeniusMap(E.c0,p),c1:_.create({c0:l.mul(w,S),c1:l.mul(g,S),c2:l.mul(y,S)})}},mulByFp2:({c0:E,c1:p},w)=>({c0:_.mulByFp2(E,w),c1:_.mulByFp2(p,w)}),conjugate:({c0:E,c1:p})=>({c0:E,c1:_.neg(p)}),mul014:({c0:E,c1:p},w,g,y)=>{let S=_.mul01(E,w,g),I=_.mul1(p,y);return{c0:_.add(_.mulByNonresidue(I),S),c1:_.sub(_.sub(_.mul01(_.add(p,E),w,l.add(g,y)),S),I)}},mul034:({c0:E,c1:p},w,g,y)=>{const S=_.create({c0:l.mul(E.c0,w),c1:l.mul(E.c1,w),c2:l.mul(E.c2,w)}),I=_.mul01(p,g,y),O=_.mul01(_.add(E,p),l.add(w,g),y);return{c0:_.add(_.mulByNonresidue(I),S),c1:_.sub(O,_.add(S,I))}},_cyclotomicSquare:e.Fp12cyclotomicSquare,_cyclotomicExp:e.Fp12cyclotomicExp,finalExponentiate:e.Fp12finalExponentiate};return{Fp:n,Fp2:l,Fp6:_,Fp4Square:q,Fp12:k}}const ze=BigInt(0),_s=BigInt(1),xe=BigInt(2),xs=BigInt(3),fi=BigInt(4),_n=BigInt("0xd201000000010000"),w3=si(_n),{Fp:Y,Fp2:X,Fp6:Pa,Fp4Square:$a,Fp12:te}=m3({ORDER:BigInt("0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab"),FP2_NONRESIDUE:[_s,_s],Fp2mulByB:({c0:e,c1:t})=>{const n=Y.mul(e,fi),r=Y.mul(t,fi);return{c0:Y.sub(n,r),c1:Y.add(n,r)}},Fp12cyclotomicSquare:({c0:e,c1:t})=>{const{c0:n,c1:r,c2:i}=e,{c0:s,c1:o,c2:a}=t,{first:f,second:c}=$a(n,o),{first:u,second:d}=$a(s,i),{first:h,second:l}=$a(r,a),b=X.mulByNonresidue(l);return{c0:Pa.create({c0:X.add(X.mul(X.sub(f,n),xe),f),c1:X.add(X.mul(X.sub(u,r),xe),u),c2:X.add(X.mul(X.sub(h,i),xe),h)}),c1:Pa.create({c0:X.add(X.mul(X.add(b,s),xe),b),c1:X.add(X.mul(X.add(c,o),xe),c),c2:X.add(X.mul(X.add(d,a),xe),d)})}},Fp12cyclotomicExp(e,t){let n=te.ONE;for(let r=w3-1;r>=0;r--)n=te._cyclotomicSquare(n),hv(t,r)&&(n=te.mul(n,e));return n},Fp12finalExponentiate:e=>{const t=_n,n=te.div(te.frobeniusMap(e,6),e),r=te.mul(te.frobeniusMap(n,2),n),i=te.conjugate(te._cyclotomicExp(r,t)),s=te.mul(te.conjugate(te._cyclotomicSquare(r)),i),o=te.conjugate(te._cyclotomicExp(s,t)),a=te.conjugate(te._cyclotomicExp(o,t)),f=te.mul(te.conjugate(te._cyclotomicExp(a,t)),te._cyclotomicSquare(i)),c=te.conjugate(te._cyclotomicExp(f,t)),u=te.frobeniusMap(te.mul(i,a),2),d=te.frobeniusMap(te.mul(o,r),3),h=te.frobeniusMap(te.mul(f,te.conjugate(r)),1),l=te.mul(te.mul(c,te.conjugate(s)),r);return te.mul(te.mul(te.mul(u,d),h),l)}}),Vh=wn(BigInt("0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001")),E3=Fh(X,[[["0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6"],["0x0","0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71a"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71e","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38d"],["0x171d6541fa38ccfaed6dea691f5fb614cb14b4e7f4e810aa22d6108f142b85757098e38d0f671c7188e2aaaaaaaa5ed1","0x0"]],[["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa63"],["0xc","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa9f"],["0x1","0x0"]],[["0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706","0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706"],["0x0","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97be"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71c","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38f"],["0x124c9ad43b6cf79bfbf7043de3811ad0761b0f37a1e26286b0e977c69aa274524e79097a56dc4bd9e1b371c71c718b10","0x0"]],[["0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb"],["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa9d3"],["0x12","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa99"],["0x1","0x0"]]].map(e=>e.map(t=>X.fromBigTuple(t.map(BigInt))))),v3=Fh(Y,[["0x11a05f2b1e833340b809101dd99815856b303e88a2d7005ff2627b56cdb4e2c85610c2d5f2e62d6eaeac1662734649b7","0x17294ed3e943ab2f0588bab22147a81c7c17e75b2f6a8417f565e33c70d1e86b4838f2a6f318c356e834eef1b3cb83bb","0xd54005db97678ec1d1048c5d10a9a1bce032473295983e56878e501ec68e25c958c3e3d2a09729fe0179f9dac9edcb0","0x1778e7166fcc6db74e0609d307e55412d7f5e4656a8dbf25f1b33289f1b330835336e25ce3107193c5b388641d9b6861","0xe99726a3199f4436642b4b3e4118e5499db995a1257fb3f086eeb65982fac18985a286f301e77c451154ce9ac8895d9","0x1630c3250d7313ff01d1201bf7a74ab5db3cb17dd952799b9ed3ab9097e68f90a0870d2dcae73d19cd13c1c66f652983","0xd6ed6553fe44d296a3726c38ae652bfb11586264f0f8ce19008e218f9c86b2a8da25128c1052ecaddd7f225a139ed84","0x17b81e7701abdbe2e8743884d1117e53356de5ab275b4db1a682c62ef0f2753339b7c8f8c8f475af9ccb5618e3f0c88e","0x80d3cf1f9a78fc47b90b33563be990dc43b756ce79f5574a2c596c928c5d1de4fa295f296b74e956d71986a8497e317","0x169b1f8e1bcfa7c42e0c37515d138f22dd2ecb803a0c5c99676314baf4bb1b7fa3190b2edc0327797f241067be390c9e","0x10321da079ce07e272d8ec09d2565b0dfa7dccdde6787f96d50af36003b14866f69b771f8c285decca67df3f1605fb7b","0x6e08c248e260e70bd1e962381edee3d31d79d7e22c837bc23c0bf1bc24c6b68c24b1b80b64d391fa9c8ba2e8ba2d229"],["0x8ca8d548cff19ae18b2e62f4bd3fa6f01d5ef4ba35b48ba9c9588617fc8ac62b558d681be343df8993cf9fa40d21b1c","0x12561a5deb559c4348b4711298e536367041e8ca0cf0800c0126c2588c48bf5713daa8846cb026e9e5c8276ec82b3bff","0xb2962fe57a3225e8137e629bff2991f6f89416f5a718cd1fca64e00b11aceacd6a3d0967c94fedcfcc239ba5cb83e19","0x3425581a58ae2fec83aafef7c40eb545b08243f16b1655154cca8abc28d6fd04976d5243eecf5c4130de8938dc62cd8","0x13a8e162022914a80a6f1d5f43e7a07dffdfc759a12062bb8d6b44e833b306da9bd29ba81f35781d539d395b3532a21e","0xe7355f8e4e667b955390f7f0506c6e9395735e9ce9cad4d0a43bcef24b8982f7400d24bc4228f11c02df9a29f6304a5","0x772caacf16936190f3e0c63e0596721570f5799af53a1894e2e073062aede9cea73b3538f0de06cec2574496ee84a3a","0x14a7ac2a9d64a8b230b3f5b074cf01996e7f63c21bca68a81996e1cdf9822c580fa5b9489d11e2d311f7d99bbdcc5a5e","0xa10ecf6ada54f825e920b3dafc7a3cce07f8d1d7161366b74100da67f39883503826692abba43704776ec3a79a1d641","0x95fc13ab9e92ad4476d6e3eb3a56680f682b4ee96f7d03776df533978f31c1593174e4b4b7865002d6384d168ecdd0a","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"],["0x90d97c81ba24ee0259d1f094980dcfa11ad138e48a869522b52af6c956543d3cd0c7aee9b3ba3c2be9845719707bb33","0x134996a104ee5811d51036d776fb46831223e96c254f383d0f906343eb67ad34d6c56711962fa8bfe097e75a2e41c696","0xcc786baa966e66f4a384c86a3b49942552e2d658a31ce2c344be4b91400da7d26d521628b00523b8dfe240c72de1f6","0x1f86376e8981c217898751ad8746757d42aa7b90eeb791c09e4a3ec03251cf9de405aba9ec61deca6355c77b0e5f4cb","0x8cc03fdefe0ff135caf4fe2a21529c4195536fbe3ce50b879833fd221351adc2ee7f8dc099040a841b6daecf2e8fedb","0x16603fca40634b6a2211e11db8f0a6a074a7d0d4afadb7bd76505c3d3ad5544e203f6326c95a807299b23ab13633a5f0","0x4ab0b9bcfac1bbcb2c977d027796b3ce75bb8ca2be184cb5231413c4d634f3747a87ac2460f415ec961f8855fe9d6f2","0x987c8d5333ab86fde9926bd2ca6c674170a05bfe3bdd81ffd038da6c26c842642f64550fedfe935a15e4ca31870fb29","0x9fc4018bd96684be88c9e221e4da1bb8f3abd16679dc26c1e8b6e6a1f20cabe69d65201c78607a360370e577bdba587","0xe1bba7a1186bdb5223abde7ada14a23c42a0ca7915af6fe06985e7ed1e4d43b9b3f7055dd4eba6f2bafaaebca731c30","0x19713e47937cd1be0dfd0b8f1d43fb93cd2fcbcb6caf493fd1183e416389e61031bf3a5cce3fbafce813711ad011c132","0x18b46a908f36f6deb918c143fed2edcc523559b8aaf0c2462e6bfe7f911f643249d9cdf41b44d606ce07c8a4d0074d8e","0xb182cac101b9399d155096004f53f447aa7b12a3426b08ec02710e807b4633f06c851c1919211f20d4c04f00b971ef8","0x245a394ad1eca9b72fc00ae7be315dc757b3b080d4c158013e6632d3c40659cc6cf90ad1c232a6442d9d3f5db980133","0x5c129645e44cf1102a159f748c4a3fc5e673d81d7e86568d9ab0f5d396a7ce46ba1049b6579afb7866b1e715475224b","0x15e6be4e990f03ce4ea50b3b42df2eb5cb181d8f84965a3957add4fa95af01b2b665027efec01c7704b456be69c8b604"],["0x16112c4c3a9c98b252181140fad0eae9601a6de578980be6eec3232b5be72e7a07f3688ef60c206d01479253b03663c1","0x1962d75c2381201e1a0cbd6c43c348b885c84ff731c4d59ca4a10356f453e01f78a4260763529e3532f6102c2e49a03d","0x58df3306640da276faaae7d6e8eb15778c4855551ae7f310c35a5dd279cd2eca6757cd636f96f891e2538b53dbf67f2","0x16b7d288798e5395f20d23bf89edb4d1d115c5dbddbcd30e123da489e726af41727364f2c28297ada8d26d98445f5416","0xbe0e079545f43e4b00cc912f8228ddcc6d19c9f0f69bbb0542eda0fc9dec916a20b15dc0fd2ededda39142311a5001d","0x8d9e5297186db2d9fb266eaac783182b70152c65550d881c5ecd87b6f0f5a6449f38db9dfa9cce202c6477faaf9b7ac","0x166007c08a99db2fc3ba8734ace9824b5eecfdfa8d0cf8ef5dd365bc400a0051d5fa9c01a58b1fb93d1a1399126a775c","0x16a3ef08be3ea7ea03bcddfabba6ff6ee5a4375efa1f4fd7feb34fd206357132b920f5b00801dee460ee415a15812ed9","0x1866c8ed336c61231a1be54fd1d74cc4f9fb0ce4c6af5920abc5750c4bf39b4852cfe2f7bb9248836b233d9d55535d4a","0x167a55cda70a6e1cea820597d94a84903216f763e13d87bb5308592e7ea7d4fbc7385ea3d529b35e346ef48bb8913f55","0x4d2f259eea405bd48f010a01ad2911d9c6dd039bb61a6290e591b36e636a5c871a5c29f4f83060400f8b49cba8f6aa8","0xaccbb67481d033ff5852c1e48c50c477f94ff8aefce42d28c0f9a88cea7913516f968986f7ebbea9684b529e2561092","0xad6b9514c767fe3c3613144b45f1496543346d98adf02267d5ceef9a00d9b8693000763e3b90ac11e99b138573345cc","0x2660400eb2e4f3b628bdd0d53cd76f2bf565b94e72927c1cb748df27942480e420517bd8714cc80d1fadc1326ed06f7","0xe0fa1d816ddc03e6b24255e0d7819c171c40f65e273b853324efcd6356caa205ca2f570f13497804415473a1d634b8f","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"]].map(e=>e.map(t=>BigInt(t)))),_3=Lh(X,{A:X.create({c0:Y.create(ze),c1:Y.create(BigInt(240))}),B:X.create({c0:Y.create(BigInt(1012)),c1:Y.create(BigInt(1012))}),Z:X.create({c0:Y.create(BigInt(-2)),c1:Y.create(BigInt(-1))})}),x3=Lh(Y,{A:Y.create(BigInt("0x144698a3b8e9433d693a02c96d4982b0ea985383ee66a8d8e8981aefd881ac98936f8da0e0f97f5cf428082d584c1d")),B:Y.create(BigInt("0x12e2908d11688030018b12e8753eee3b2016c1f0f24f4070a0b9c14fcef35ef55a23215a316ceaa5d1cc48e98e172be0")),Z:Y.create(BigInt(11))}),{G2psi:Kh,G2psi2:S3}=y3(Y,X,X.div(X.ONE,X.NONRESIDUE)),La=Object.freeze({DST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",encodeDST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",p:Y.ORDER,m:2,k:128,expand:"xmd",hash:xr}),Ss=ui(Y.toBytes(ze),{infinity:!0,compressed:!0});function Is(e){e=e.slice();const t=e[0]&224,n=!!(t>>7&1),r=!!(t>>6&1),i=!!(t>>5&1);return e[0]&=31,{compressed:n,infinity:r,sort:i,value:e}}function ui(e,t){if(e[0]&224)throw new Error("setMask: non-empty mask");return t.compressed&&(e[0]|=128),t.infinity&&(e[0]|=64),t.sort&&(e[0]|=32),e}function Gh(e){e.assertValidity();const t=e.equals(xt.G1.ProjectivePoint.ZERO),{x:n,y:r}=e.toAffine();if(t)return Ss.slice();const i=Y.ORDER,s=!!(r*xe/i);return ui(we(n,Y.BYTES),{compressed:!0,sort:s})}function Zh(e){e.assertValidity();const t=Y.BYTES;if(e.equals(xt.G2.ProjectivePoint.ZERO))return pe(Ss,we(ze,t));const{x:n,y:r}=e.toAffine(),{re:i,im:s}=X.reim(n),{re:o,im:a}=X.reim(r),c=!!((a>ze?a*xe:o*xe)/Y.ORDER&_s),u=i;return pe(ui(we(s,t),{sort:c,compressed:!0}),we(u,t))}const xt=p3({fields:{Fp:Y,Fp2:X,Fp6:Pa,Fp12:te,Fr:Vh},G1:{Fp:Y,h:BigInt("0x396c8c005555e1568c00aaab0000aaab"),Gx:BigInt("0x17f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb"),Gy:BigInt("0x08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1"),a:Y.ZERO,b:fi,htfDefaults:{...La,m:1,DST:"BLS_SIG_BLS12381G1_XMD:SHA-256_SSWU_RO_NUL_"},wrapPrivateKey:!0,allowInfinityPoint:!0,isTorsionFree:(e,t)=>{const n=BigInt("0x5f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe"),r=new e(Y.mul(t.px,n),t.py,t.pz);return t.multiplyUnsafe(_n).negate().multiplyUnsafe(_n).equals(r)},clearCofactor:(e,t)=>t.multiplyUnsafe(_n).add(t),mapToCurve:e=>{const{x:t,y:n}=x3(Y.create(e[0]));return v3(t,n)},fromBytes:e=>{const{compressed:t,infinity:n,sort:r,value:i}=Is(e);if(i.length===48&&t){const s=Y.ORDER,o=je(i),a=Y.create(o&Y.MASK);if(n){if(a!==ze)throw new Error("G1: non-empty compressed point at infinity");return{x:ze,y:ze}}const f=Y.add(Y.pow(a,xs),Y.create(xt.params.G1b));let c=Y.sqrt(f);if(!c)throw new Error("invalid compressed G1 point");return c*xe/s!==BigInt(r)&&(c=Y.neg(c)),{x:Y.create(a),y:Y.create(c)}}else if(i.length===96&&!t){const s=je(i.subarray(0,Y.BYTES)),o=je(i.subarray(Y.BYTES));if(n){if(s!==ze||o!==ze)throw new Error("G1: non-empty point at infinity");return xt.G1.ProjectivePoint.ZERO.toAffine()}return{x:Y.create(s),y:Y.create(o)}}else throw new Error("invalid point G1, expected 48/96 bytes")},toBytes:(e,t,n)=>{const r=t.equals(e.ZERO),{x:i,y:s}=t.toAffine();if(n){if(r)return Ss.slice();const o=Y.ORDER,a=!!(s*xe/o);return ui(we(i,Y.BYTES),{compressed:!0,sort:a})}else return r?pe(new Uint8Array([64]),new Uint8Array(2*Y.BYTES-1)):pe(we(i,Y.BYTES),we(s,Y.BYTES))},ShortSignature:{fromHex(e){const{infinity:t,sort:n,value:r}=Is(Ne("signatureHex",e,48)),i=Y.ORDER,s=je(r);if(t)return xt.G1.ProjectivePoint.ZERO;const o=Y.create(s&Y.MASK),a=Y.add(Y.pow(o,xs),Y.create(xt.params.G1b));let f=Y.sqrt(a);if(!f)throw new Error("invalid compressed G1 point");const c=BigInt(n);f*xe/i!==c&&(f=Y.neg(f));const u=xt.G1.ProjectivePoint.fromAffine({x:o,y:f});return u.assertValidity(),u},toRawBytes(e){return Gh(e)},toHex(e){return Gn(Gh(e))}}},G2:{Fp:X,h:BigInt("0x5d543a95414e7f1091d50792876a202cd91de4547085abaa68a205b2e5a7ddfa628f1cb4d9e82ef21537e293a6691ae1616ec6e786f0c70cf1c38e31c7238e5"),Gx:X.fromBigTuple([BigInt("0x024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8"),BigInt("0x13e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e")]),Gy:X.fromBigTuple([BigInt("0x0ce5d527727d6e118cc9cdc6da2e351aadfd9baa8cbdd3a76d429a695160d12c923ac9cc3baca289e193548608b82801"),BigInt("0x0606c4a02ea734cc32acd2b02bc28b99cb3e287e85a763af267492ab572e99ab3f370d275cec1da1aaa9075ff05f79be")]),a:X.ZERO,b:X.fromBigTuple([fi,fi]),hEff:BigInt("0xbc69f08f2ee75b3584c6a0ea91b352888e2a8e9145ad7689986ff031508ffe1329c2f178731db956d82bf015d1212b02ec0ec69d7477c1ae954cbc06689f6a359894c0adebbf6b4e8020005aaa95551"),htfDefaults:{...La},wrapPrivateKey:!0,allowInfinityPoint:!0,mapToCurve:e=>{const{x:t,y:n}=_3(X.fromBigTuple(e));return E3(t,n)},isTorsionFree:(e,t)=>t.multiplyUnsafe(_n).negate().equals(Kh(e,t)),clearCofactor:(e,t)=>{const n=_n;let r=t.multiplyUnsafe(n).negate(),i=Kh(e,t),s=t.double();return s=S3(e,s),s=s.subtract(i),i=r.add(i),i=i.multiplyUnsafe(n).negate(),s=s.add(i),s=s.subtract(r),s.subtract(t)},fromBytes:e=>{const{compressed:t,infinity:n,sort:r,value:i}=Is(e);if(!t&&!n&&r||!t&&n&&r||r&&n&&t)throw new Error("invalid encoding flag: "+(e[0]&224));const s=Y.BYTES,o=(a,f,c)=>je(a.slice(f,c));if(i.length===96&&t){const a=xt.params.G2b,f=Y.ORDER;if(n){if(i.reduce((m,v)=>m!==0?v+1:v,0)>0)throw new Error("invalid compressed G2 point");return{x:X.ZERO,y:X.ZERO}}const c=o(i,0,s),u=o(i,s,2*s),d=X.create({c0:Y.create(u),c1:Y.create(c)}),h=X.add(X.pow(d,xs),a);let l=X.sqrt(h);const b=l.c1===ze?l.c0*xe/f:l.c1*xe/f?_s:ze;return l=r&&b>0?l:X.neg(l),{x:d,y:l}}else if(i.length===192&&!t){if(n){if(i.reduce((d,h)=>d!==0?h+1:h,0)>0)throw new Error("invalid uncompressed G2 point");return{x:X.ZERO,y:X.ZERO}}const a=o(i,0,s),f=o(i,s,2*s),c=o(i,2*s,3*s),u=o(i,3*s,4*s);return{x:X.fromBigTuple([f,a]),y:X.fromBigTuple([u,c])}}else throw new Error("invalid point G2, expected 96/192 bytes")},toBytes:(e,t,n)=>{const{BYTES:r,ORDER:i}=Y,s=t.equals(e.ZERO),{x:o,y:a}=t.toAffine();if(n){if(s)return pe(Ss,we(ze,r));const f=!!(a.c1===ze?a.c0*xe/i:a.c1*xe/i);return pe(ui(we(o.c1,r),{compressed:!0,sort:f}),we(o.c0,r))}else{if(s)return pe(new Uint8Array([64]),new Uint8Array(4*r-1));const{re:f,im:c}=X.reim(o),{re:u,im:d}=X.reim(a);return pe(we(c,r),we(f,r),we(d,r),we(u,r))}},Signature:{fromHex(e){const{infinity:t,sort:n,value:r}=Is(Ne("signatureHex",e)),i=Y.ORDER,s=r.length/2;if(s!==48&&s!==96)throw new Error("invalid compressed signature length, must be 96 or 192");const o=je(r.slice(0,s)),a=je(r.slice(s));if(t)return xt.G2.ProjectivePoint.ZERO;const f=Y.create(o&Y.MASK),c=Y.create(a),u=X.create({c0:c,c1:f}),d=X.add(X.pow(u,xs),xt.params.G2b);let h=X.sqrt(d);if(!h)throw new Error("Failed to find a square root");const{re:l,im:b}=X.reim(h),m=BigInt(n),v=b>ze&&b*xe/i!==m,D=b===ze&&l*xe/i!==m;(v||D)&&(h=X.neg(h));const C=xt.G2.ProjectivePoint.fromAffine({x:u,y:h});return C.assertValidity(),C},toRawBytes(e){return Zh(e)},toHex(e){return Gn(Zh(e))}}},params:{ateLoopSize:_n,r:Vh.ORDER,xNegative:!0,twistType:"multiplicative"},htfDefaults:La,hash:xr,randomBytes:us});BigInt(0),BigInt(1),BigInt(2),BigInt(8),BigInt(0),BigInt(1),BigInt(2),BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),BigInt(0),BigInt(1),BigInt(2),BigInt(3),BigInt(5),BigInt(8);const Ua=BigInt(0),Fa=BigInt(1);function Os(e,t=""){if(typeof e!="boolean"){const n=t&&`"${t}"`;throw new Error(n+"expected boolean, got type="+typeof e)}return e}function Xn(e,t,n=""){const r=os(e),i=e?.length,s=t!==void 0;if(!r||s&&i!==t){const o=n&&`"${n}" `,a=s?` of length ${t}`:"",f=r?`length=${i}`:`type=${typeof e}`;throw new Error(o+"expected Uint8Array"+a+", got "+f)}return e}function Bs(e){const t=e.toString(16);return t.length&1?"0"+t:t}function Yh(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?Ua:BigInt("0x"+e)}function Ds(e){return Yh(Er(e))}function Wh(e){return qt(e),Yh(Er(Uint8Array.from(e).reverse()))}function ja(e,t){return as(e.toString(16).padStart(t*2,"0"))}function Xh(e,t){return ja(e,t).reverse()}function We(e,t,n){let r;if(typeof t=="string")try{r=as(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if(os(t))r=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(e+" of length "+n+" expected, got "+i);return r}const Ma=e=>typeof e=="bigint"&&Ua<=e;function I3(e,t,n){return Ma(e)&&Ma(t)&&Ma(n)&&t<=e&&e<n}function O3(e,t,n,r){if(!I3(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}function Jh(e){let t;for(t=0;e>Ua;e>>=Fa,t+=1);return t}const li=e=>(Fa<<BigInt(e))-Fa;function B3(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");const r=l=>new Uint8Array(l),i=l=>Uint8Array.of(l);let s=r(e),o=r(e),a=0;const f=()=>{s.fill(1),o.fill(0),a=0},c=(...l)=>n(o,s,...l),u=(l=r(0))=>{o=c(i(0),l),s=c(),l.length!==0&&(o=c(i(1),l),s=c())},d=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let l=0;const b=[];for(;l<t;){s=c();const m=s.slice();b.push(m),l+=s.length}return Vt(...b)};return(l,b)=>{f(),u(l);let m;for(;!(m=b(d()));)u();return f(),m}}function ka(e,t,n={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function r(i,s,o){const a=e[i];if(o&&a===void 0)return;const f=typeof a;if(f!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${f}`)}Object.entries(t).forEach(([i,s])=>r(i,s,!1)),Object.entries(n).forEach(([i,s])=>r(i,s,!0))}function Qh(e){const t=new WeakMap;return(n,...r)=>{const i=t.get(n);if(i!==void 0)return i;const s=e(n,...r);return t.set(n,s),s}}const Xe=BigInt(0),qe=BigInt(1),Jn=BigInt(2),ed=BigInt(3),td=BigInt(4),nd=BigInt(5),D3=BigInt(7),rd=BigInt(8),A3=BigInt(9),id=BigInt(16);function St(e,t){const n=e%t;return n>=Xe?n:t+n}function pt(e,t,n){let r=e;for(;t-- >Xe;)r*=r,r%=n;return r}function sd(e,t){if(e===Xe)throw new Error("invert: expected non-zero number");if(t<=Xe)throw new Error("invert: expected positive modulus, got "+t);let n=St(e,t),r=t,i=Xe,s=qe;for(;n!==Xe;){const a=r/n,f=r%n,c=i-s*a;r=n,n=f,i=s,s=c}if(r!==qe)throw new Error("invert: does not exist");return St(i,t)}function za(e,t,n){if(!e.eql(e.sqr(t),n))throw new Error("Cannot find square root")}function od(e,t){const n=(e.ORDER+qe)/td,r=e.pow(t,n);return za(e,r,t),r}function T3(e,t){const n=(e.ORDER-nd)/rd,r=e.mul(t,Jn),i=e.pow(r,n),s=e.mul(t,i),o=e.mul(e.mul(s,Jn),i),a=e.mul(s,e.sub(o,e.ONE));return za(e,a,t),a}function R3(e){const t=hi(e),n=ad(e),r=n(t,t.neg(t.ONE)),i=n(t,r),s=n(t,t.neg(r)),o=(e+D3)/id;return(a,f)=>{let c=a.pow(f,o),u=a.mul(c,r);const d=a.mul(c,i),h=a.mul(c,s),l=a.eql(a.sqr(u),f),b=a.eql(a.sqr(d),f);c=a.cmov(c,u,l),u=a.cmov(h,d,b);const m=a.eql(a.sqr(u),f),v=a.cmov(c,u,m);return za(a,v,f),v}}function ad(e){if(e<ed)throw new Error("sqrt is not defined for small field");let t=e-qe,n=0;for(;t%Jn===Xe;)t/=Jn,n++;let r=Jn;const i=hi(e);for(;fd(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return od;let s=i.pow(r,t);const o=(t+qe)/Jn;return function(f,c){if(f.is0(c))return c;if(fd(f,c)!==1)throw new Error("Cannot find square root");let u=n,d=f.mul(f.ONE,s),h=f.pow(c,t),l=f.pow(c,o);for(;!f.eql(h,f.ONE);){if(f.is0(h))return f.ZERO;let b=1,m=f.sqr(h);for(;!f.eql(m,f.ONE);)if(b++,m=f.sqr(m),b===u)throw new Error("Cannot find square root");const v=qe<<BigInt(u-b-1),D=f.pow(d,v);u=b,d=f.sqr(D),h=f.mul(h,d),l=f.mul(l,D)}return l}}function N3(e){return e%td===ed?od:e%rd===nd?T3:e%id===A3?R3(e):ad(e)}const C3=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function P3(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=C3.reduce((r,i)=>(r[i]="function",r),t);return ka(e,n),e}function $3(e,t,n){if(n<Xe)throw new Error("invalid exponent, negatives unsupported");if(n===Xe)return e.ONE;if(n===qe)return t;let r=e.ONE,i=t;for(;n>Xe;)n&qe&&(r=e.mul(r,i)),i=e.sqr(i),n>>=qe;return r}function cd(e,t,n=!1){const r=new Array(t.length).fill(n?e.ZERO:void 0),i=t.reduce((o,a,f)=>e.is0(a)?o:(r[f]=o,e.mul(o,a)),e.ONE),s=e.inv(i);return t.reduceRight((o,a,f)=>e.is0(a)?o:(r[f]=e.mul(o,r[f]),e.mul(o,a)),s),r}function fd(e,t){const n=(e.ORDER-qe)/Jn,r=e.pow(t,n),i=e.eql(r,e.ONE),s=e.eql(r,e.ZERO),o=e.eql(r,e.neg(e.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function ud(e,t){t!==void 0&&mr(t);const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function hi(e,t,n=!1,r={}){if(e<=Xe)throw new Error("invalid field: expected ORDER > 0, got "+e);let i,s,o=!1,a;if(typeof t=="object"&&t!=null){if(r.sqrt||n)throw new Error("cannot specify opts in two arguments");const h=t;h.BITS&&(i=h.BITS),h.sqrt&&(s=h.sqrt),typeof h.isLE=="boolean"&&(n=h.isLE),typeof h.modFromBytes=="boolean"&&(o=h.modFromBytes),a=h.allowedLengths}else typeof t=="number"&&(i=t),r.sqrt&&(s=r.sqrt);const{nBitLength:f,nByteLength:c}=ud(e,i);if(c>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const d=Object.freeze({ORDER:e,isLE:n,BITS:f,BYTES:c,MASK:li(f),ZERO:Xe,ONE:qe,allowedLengths:a,create:h=>St(h,e),isValid:h=>{if(typeof h!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof h);return Xe<=h&&h<e},is0:h=>h===Xe,isValidNot0:h=>!d.is0(h)&&d.isValid(h),isOdd:h=>(h&qe)===qe,neg:h=>St(-h,e),eql:(h,l)=>h===l,sqr:h=>St(h*h,e),add:(h,l)=>St(h+l,e),sub:(h,l)=>St(h-l,e),mul:(h,l)=>St(h*l,e),pow:(h,l)=>$3(d,h,l),div:(h,l)=>St(h*sd(l,e),e),sqrN:h=>h*h,addN:(h,l)=>h+l,subN:(h,l)=>h-l,mulN:(h,l)=>h*l,inv:h=>sd(h,e),sqrt:s||(h=>(u||(u=N3(e)),u(d,h))),toBytes:h=>n?Xh(h,c):ja(h,c),fromBytes:(h,l=!0)=>{if(a){if(!a.includes(h.length)||h.length>c)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+h.length);const m=new Uint8Array(c);m.set(h,n?0:m.length-h.length),h=m}if(h.length!==c)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+h.length);let b=n?Wh(h):Ds(h);if(o&&(b=St(b,e)),!l&&!d.isValid(b))throw new Error("invalid field element: outside of range 0..ORDER");return b},invertBatch:h=>cd(d,h),cmov:(h,l,b)=>b?l:h});return Object.freeze(d)}function ld(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function hd(e){const t=ld(e);return t+Math.ceil(t/2)}function L3(e,t,n=!1){const r=e.length,i=ld(t),s=hd(t);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=n?Wh(e):Ds(e),a=St(o,t-qe)+qe;return n?Xh(a,i):ja(a,i)}const Br=BigInt(0),Qn=BigInt(1);function As(e,t){const n=t.negate();return e?n:t}function qa(e,t){const n=cd(e.Fp,t.map(r=>r.Z));return t.map((r,i)=>e.fromAffine(r.toAffine(n[i])))}function dd(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Ha(e,t){dd(e,t);const n=Math.ceil(t/e)+1,r=2**(e-1),i=2**e,s=li(e),o=BigInt(e);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function gd(e,t,n){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n;let a=Number(e&i),f=e>>o;a>r&&(a-=s,f+=Qn);const c=t*r,u=c+Math.abs(a)-1,d=a===0,h=a<0,l=t%2!==0;return{nextN:f,offset:u,isZero:d,isNeg:h,isNegF:l,offsetF:c}}function U3(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((n,r)=>{if(!(n instanceof t))throw new Error("invalid point at index "+r)})}function F3(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((n,r)=>{if(!t.isValid(n))throw new Error("invalid scalar at index "+r)})}const Va=new WeakMap,pd=new WeakMap;function Ka(e){return pd.get(e)||1}function bd(e){if(e!==Br)throw new Error("invalid wNAF")}class j3{constructor(t,n){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=n}_unsafeLadder(t,n,r=this.ZERO){let i=t;for(;n>Br;)n&Qn&&(r=r.add(i)),i=i.double(),n>>=Qn;return r}precomputeWindow(t,n){const{windows:r,windowSize:i}=Ha(n,this.bits),s=[];let o=t,a=o;for(let f=0;f<r;f++){a=o,s.push(a);for(let c=1;c<i;c++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(t,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=Ha(t,this.bits);for(let a=0;a<o.windows;a++){const{nextN:f,offset:c,isZero:u,isNeg:d,isNegF:h,offsetF:l}=gd(r,a,o);r=f,u?s=s.add(As(h,n[l])):i=i.add(As(d,n[c]))}return bd(r),{p:i,f:s}}wNAFUnsafe(t,n,r,i=this.ZERO){const s=Ha(t,this.bits);for(let o=0;o<s.windows&&r!==Br;o++){const{nextN:a,offset:f,isZero:c,isNeg:u}=gd(r,o,s);if(r=a,!c){const d=n[f];i=i.add(u?d.negate():d)}}return bd(r),i}getPrecomputes(t,n,r){let i=Va.get(n);return i||(i=this.precomputeWindow(n,t),t!==1&&(typeof r=="function"&&(i=r(i)),Va.set(n,i))),i}cached(t,n,r){const i=Ka(t);return this.wNAF(i,this.getPrecomputes(i,t,r),n)}unsafe(t,n,r,i){const s=Ka(t);return s===1?this._unsafeLadder(t,n,i):this.wNAFUnsafe(s,this.getPrecomputes(s,t,r),n,i)}createCache(t,n){dd(n,this.bits),pd.set(t,n),Va.delete(t)}hasCache(t){return Ka(t)!==1}}function M3(e,t,n,r){let i=t,s=e.ZERO,o=e.ZERO;for(;n>Br||r>Br;)n&Qn&&(s=s.add(i)),r&Qn&&(o=o.add(i)),i=i.double(),n>>=Qn,r>>=Qn;return{p1:s,p2:o}}function k3(e,t,n,r){U3(n,e),F3(r,t);const i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=e.ZERO,a=Jh(BigInt(i));let f=1;a>12?f=a-3:a>4?f=a-2:a>0&&(f=2);const c=li(f),u=new Array(Number(c)+1).fill(o),d=Math.floor((t.BITS-1)/f)*f;let h=o;for(let l=d;l>=0;l-=f){u.fill(o);for(let m=0;m<s;m++){const v=r[m],D=Number(v>>BigInt(l)&c);u[D]=u[D].add(n[m])}let b=o;for(let m=u.length-1,v=o;m>0;m--)v=v.add(u[m]),b=b.add(v);if(h=h.add(b),l!==0)for(let m=0;m<f;m++)h=h.double()}return h}function yd(e,t,n){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return P3(t),t}else return hi(e,{isLE:n})}function z3(e,t,n={},r){if(r===void 0&&(r=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(const f of["p","n","h"]){const c=t[f];if(!(typeof c=="bigint"&&c>Br))throw new Error(`CURVE.${f} must be positive bigint`)}const i=yd(t.p,n.Fp,r),s=yd(t.n,n.Fn,r),a=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(const f of a)if(!i.isValid(t[f]))throw new Error(`CURVE.${f} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:i,Fn:s}}const md=(e,t)=>(e+(e>=0?t:-t)/wd)/t;function q3(e,t,n){const[[r,i],[s,o]]=t,a=md(o*e,n),f=md(-i*e,n);let c=e-a*r-f*s,u=-a*i-f*o;const d=c<Qt,h=u<Qt;d&&(c=-c),h&&(u=-u);const l=li(Math.ceil(Jh(n)/2))+Dr;if(c<Qt||c>=l||u<Qt||u>=l)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:d,k1:c,k2neg:h,k2:u}}function Ga(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function Za(e,t){const n={};for(let r of Object.keys(t))n[r]=e[r]===void 0?t[r]:e[r];return Os(n.lowS,"lowS"),Os(n.prehash,"prehash"),n.format!==void 0&&Ga(n.format),n}class H3 extends Error{constructor(t=""){super(t)}}const Jt={Err:H3,_tlv:{encode:(e,t)=>{const{Err:n}=Jt;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length&1)throw new n("tlv.encode: unpadded data");const r=t.length/2,i=Bs(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?Bs(i.length/2|128):"";return Bs(e)+s+i+t},decode(e,t){const{Err:n}=Jt;let r=0;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length<2||t[r++]!==e)throw new n("tlv.decode: wrong tlv");const i=t[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const f=i&127;if(!f)throw new n("tlv.decode(long): indefinite length not supported");if(f>4)throw new n("tlv.decode(long): byte length is too big");const c=t.subarray(r,r+f);if(c.length!==f)throw new n("tlv.decode: length bytes not complete");if(c[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const u of c)o=o<<8|u;if(r+=f,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=t.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:t.subarray(r+o)}}},_int:{encode(e){const{Err:t}=Jt;if(e<Qt)throw new t("integer: negative integers are not allowed");let n=Bs(e);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return n},decode(e){const{Err:t}=Jt;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return Ds(e)}},toSig(e){const{Err:t,_int:n,_tlv:r}=Jt,i=We("signature",e),{v:s,l:o}=r.decode(48,i);if(o.length)throw new t("invalid signature: left bytes after parsing");const{v:a,l:f}=r.decode(2,s),{v:c,l:u}=r.decode(2,f);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(c)}},hexFromSig(e){const{_tlv:t,_int:n}=Jt,r=t.encode(2,n.encode(e.r)),i=t.encode(2,n.encode(e.s)),s=r+i;return t.encode(48,s)}},Qt=BigInt(0),Dr=BigInt(1),wd=BigInt(2),Ts=BigInt(3),V3=BigInt(4);function Ar(e,t){const{BYTES:n}=e;let r;if(typeof t=="bigint")r=t;else{let i=We("private key",t);try{r=e.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof t}`)}}if(!e.isValidNot0(r))throw new Error("invalid private key: out of range [1..N-1]");return r}function K3(e,t={}){const n=z3("weierstrass",e,t),{Fp:r,Fn:i}=n;let s=n.CURVE;const{h:o,n:a}=s;ka(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:f}=t;if(f&&(!r.is0(s.a)||typeof f.beta!="bigint"||!Array.isArray(f.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const c=vd(r,i);function u(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function d(E,p,w){const{x:g,y}=p.toAffine(),S=r.toBytes(g);if(Os(w,"isCompressed"),w){u();const I=!r.isOdd(y);return Vt(Ed(I),S)}else return Vt(Uint8Array.of(4),S,r.toBytes(y))}function h(E){Xn(E,void 0,"Point");const{publicKey:p,publicKeyUncompressed:w}=c,g=E.length,y=E[0],S=E.subarray(1);if(g===p&&(y===2||y===3)){const I=r.fromBytes(S);if(!r.isValid(I))throw new Error("bad point: is not on curve, wrong x");const O=m(I);let B;try{B=r.sqrt(O)}catch(P){const j=P instanceof Error?": "+P.message:"";throw new Error("bad point: is not on curve, sqrt error"+j)}u();const T=r.isOdd(B);return(y&1)===1!==T&&(B=r.neg(B)),{x:I,y:B}}else if(g===w&&y===4){const I=r.BYTES,O=r.fromBytes(S.subarray(0,I)),B=r.fromBytes(S.subarray(I,I*2));if(!v(O,B))throw new Error("bad point: is not on curve");return{x:O,y:B}}else throw new Error(`bad point: got length ${g}, expected compressed=${p} or uncompressed=${w}`)}const l=t.toBytes||d,b=t.fromBytes||h;function m(E){const p=r.sqr(E),w=r.mul(p,E);return r.add(r.add(w,r.mul(E,s.a)),s.b)}function v(E,p){const w=r.sqr(p),g=m(E);return r.eql(w,g)}if(!v(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const D=r.mul(r.pow(s.a,Ts),V3),C=r.mul(r.sqr(s.b),BigInt(27));if(r.is0(r.add(D,C)))throw new Error("bad curve params: a or b");function x(E,p,w=!1){if(!r.isValid(p)||w&&r.is0(p))throw new Error(`bad point coordinate ${E}`);return p}function _(E){if(!(E instanceof A))throw new Error("ProjectivePoint expected")}function R(E){if(!f||!f.basises)throw new Error("no endo");return q3(E,f.basises,i.ORDER)}const $=Qh((E,p)=>{const{X:w,Y:g,Z:y}=E;if(r.eql(y,r.ONE))return{x:w,y:g};const S=E.is0();p==null&&(p=S?r.ONE:r.inv(y));const I=r.mul(w,p),O=r.mul(g,p),B=r.mul(y,p);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(B,r.ONE))throw new Error("invZ was invalid");return{x:I,y:O}}),F=Qh(E=>{if(E.is0()){if(t.allowInfinityPoint&&!r.is0(E.Y))return;throw new Error("bad point: ZERO")}const{x:p,y:w}=E.toAffine();if(!r.isValid(p)||!r.isValid(w))throw new Error("bad point: x or y not field elements");if(!v(p,w))throw new Error("bad point: equation left != right");if(!E.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function U(E,p,w,g,y){return w=new A(r.mul(w.X,E),w.Y,w.Z),p=As(g,p),w=As(y,w),p.add(w)}class A{constructor(p,w,g){this.X=x("x",p),this.Y=x("y",w,!0),this.Z=x("z",g),Object.freeze(this)}static CURVE(){return s}static fromAffine(p){const{x:w,y:g}=p||{};if(!p||!r.isValid(w)||!r.isValid(g))throw new Error("invalid affine point");if(p instanceof A)throw new Error("projective point not allowed");return r.is0(w)&&r.is0(g)?A.ZERO:new A(w,g,r.ONE)}static fromBytes(p){const w=A.fromAffine(b(Xn(p,void 0,"point")));return w.assertValidity(),w}static fromHex(p){return A.fromBytes(We("pointHex",p))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(p=8,w=!0){return k.createCache(this,p),w||this.multiply(Ts),this}assertValidity(){F(this)}hasEvenY(){const{y:p}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(p)}equals(p){_(p);const{X:w,Y:g,Z:y}=this,{X:S,Y:I,Z:O}=p,B=r.eql(r.mul(w,O),r.mul(S,y)),T=r.eql(r.mul(g,O),r.mul(I,y));return B&&T}negate(){return new A(this.X,r.neg(this.Y),this.Z)}double(){const{a:p,b:w}=s,g=r.mul(w,Ts),{X:y,Y:S,Z:I}=this;let O=r.ZERO,B=r.ZERO,T=r.ZERO,L=r.mul(y,y),P=r.mul(S,S),j=r.mul(I,I),N=r.mul(y,S);return N=r.add(N,N),T=r.mul(y,I),T=r.add(T,T),O=r.mul(p,T),B=r.mul(g,j),B=r.add(O,B),O=r.sub(P,B),B=r.add(P,B),B=r.mul(O,B),O=r.mul(N,O),T=r.mul(g,T),j=r.mul(p,j),N=r.sub(L,j),N=r.mul(p,N),N=r.add(N,T),T=r.add(L,L),L=r.add(T,L),L=r.add(L,j),L=r.mul(L,N),B=r.add(B,L),j=r.mul(S,I),j=r.add(j,j),L=r.mul(j,N),O=r.sub(O,L),T=r.mul(j,P),T=r.add(T,T),T=r.add(T,T),new A(O,B,T)}add(p){_(p);const{X:w,Y:g,Z:y}=this,{X:S,Y:I,Z:O}=p;let B=r.ZERO,T=r.ZERO,L=r.ZERO;const P=s.a,j=r.mul(s.b,Ts);let N=r.mul(w,S),M=r.mul(g,I),z=r.mul(y,O),G=r.add(w,g),H=r.add(S,I);G=r.mul(G,H),H=r.add(N,M),G=r.sub(G,H),H=r.add(w,y);let K=r.add(S,O);return H=r.mul(H,K),K=r.add(N,z),H=r.sub(H,K),K=r.add(g,y),B=r.add(I,O),K=r.mul(K,B),B=r.add(M,z),K=r.sub(K,B),L=r.mul(P,H),B=r.mul(j,z),L=r.add(B,L),B=r.sub(M,L),L=r.add(M,L),T=r.mul(B,L),M=r.add(N,N),M=r.add(M,N),z=r.mul(P,z),H=r.mul(j,H),M=r.add(M,z),z=r.sub(N,z),z=r.mul(P,z),H=r.add(H,z),N=r.mul(M,H),T=r.add(T,N),N=r.mul(K,H),B=r.mul(G,B),B=r.sub(B,N),N=r.mul(G,M),L=r.mul(K,L),L=r.add(L,N),new A(B,T,L)}subtract(p){return this.add(p.negate())}is0(){return this.equals(A.ZERO)}multiply(p){const{endo:w}=t;if(!i.isValidNot0(p))throw new Error("invalid scalar: out of range");let g,y;const S=I=>k.cached(this,I,O=>qa(A,O));if(w){const{k1neg:I,k1:O,k2neg:B,k2:T}=R(p),{p:L,f:P}=S(O),{p:j,f:N}=S(T);y=P.add(N),g=U(w.beta,L,j,I,B)}else{const{p:I,f:O}=S(p);g=I,y=O}return qa(A,[g,y])[0]}multiplyUnsafe(p){const{endo:w}=t,g=this;if(!i.isValid(p))throw new Error("invalid scalar: out of range");if(p===Qt||g.is0())return A.ZERO;if(p===Dr)return g;if(k.hasCache(this))return this.multiply(p);if(w){const{k1neg:y,k1:S,k2neg:I,k2:O}=R(p),{p1:B,p2:T}=M3(A,g,S,O);return U(w.beta,B,T,y,I)}else return k.unsafe(g,p)}multiplyAndAddUnsafe(p,w,g){const y=this.multiplyUnsafe(w).add(p.multiplyUnsafe(g));return y.is0()?void 0:y}toAffine(p){return $(this,p)}isTorsionFree(){const{isTorsionFree:p}=t;return o===Dr?!0:p?p(A,this):k.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:p}=t;return o===Dr?this:p?p(A,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(p=!0){return Os(p,"isCompressed"),this.assertValidity(),l(A,this,p)}toHex(p=!0){return Er(this.toBytes(p))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(p=!0){return this.toBytes(p)}_setWindowSize(p){this.precompute(p)}static normalizeZ(p){return qa(A,p)}static msm(p,w){return k3(A,i,p,w)}static fromPrivateKey(p){return A.BASE.multiply(Ar(i,p))}}A.BASE=new A(s.Gx,s.Gy,r.ONE),A.ZERO=new A(r.ZERO,r.ONE,r.ZERO),A.Fp=r,A.Fn=i;const q=i.BITS,k=new j3(A,t.endo?Math.ceil(q/2):q);return A.BASE.precompute(8),A}function Ed(e){return Uint8Array.of(e?2:3)}function vd(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function G3(e,t={}){const{Fn:n}=e,r=t.randomBytes||us,i=Object.assign(vd(e.Fp,n),{seed:hd(n.ORDER)});function s(l){try{return!!Ar(n,l)}catch{return!1}}function o(l,b){const{publicKey:m,publicKeyUncompressed:v}=i;try{const D=l.length;return b===!0&&D!==m||b===!1&&D!==v?!1:!!e.fromBytes(l)}catch{return!1}}function a(l=r(i.seed)){return L3(Xn(l,i.seed,"seed"),n.ORDER)}function f(l,b=!0){return e.BASE.multiply(Ar(n,l)).toBytes(b)}function c(l){const b=a(l);return{secretKey:b,publicKey:f(b)}}function u(l){if(typeof l=="bigint")return!1;if(l instanceof e)return!0;const{secretKey:b,publicKey:m,publicKeyUncompressed:v}=i;if(n.allowedLengths||b===m)return;const D=We("key",l).length;return D===m||D===v}function d(l,b,m=!0){if(u(l)===!0)throw new Error("first arg must be private key");if(u(b)===!1)throw new Error("second arg must be public key");const v=Ar(n,l);return e.fromHex(b).multiply(v).toBytes(m)}return Object.freeze({getPublicKey:f,getSharedSecret:d,keygen:c,Point:e,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:l=>Ar(n,l),precompute(l=8,b=e.BASE){return b.precompute(l,!1)}},lengths:i})}function Z3(e,t,n={}){ql(t),ka(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const r=n.randomBytes||us,i=n.hmac||((w,...g)=>Ea(t,w,Vt(...g))),{Fp:s,Fn:o}=e,{ORDER:a,BITS:f}=o,{keygen:c,getPublicKey:u,getSharedSecret:d,utils:h,lengths:l}=G3(e,n),b={prehash:!1,lowS:typeof n.lowS=="boolean"?n.lowS:!1,format:void 0,extraEntropy:!1},m="compact";function v(w){const g=a>>Dr;return w>g}function D(w,g){if(!o.isValidNot0(g))throw new Error(`invalid signature ${w}: out of range 1..Point.Fn.ORDER`);return g}function C(w,g){Ga(g);const y=l.signature,S=g==="compact"?y:g==="recovered"?y+1:void 0;return Xn(w,S,`${g} signature`)}class x{constructor(g,y,S){this.r=D("r",g),this.s=D("s",y),S!=null&&(this.recovery=S),Object.freeze(this)}static fromBytes(g,y=m){C(g,y);let S;if(y==="der"){const{r:T,s:L}=Jt.toSig(Xn(g));return new x(T,L)}y==="recovered"&&(S=g[0],y="compact",g=g.subarray(1));const I=o.BYTES,O=g.subarray(0,I),B=g.subarray(I,I*2);return new x(o.fromBytes(O),o.fromBytes(B),S)}static fromHex(g,y){return this.fromBytes(as(g),y)}addRecoveryBit(g){return new x(this.r,this.s,g)}recoverPublicKey(g){const y=s.ORDER,{r:S,s:I,recovery:O}=this;if(O==null||![0,1,2,3].includes(O))throw new Error("recovery id invalid");if(a*wd<y&&O>1)throw new Error("recovery id is ambiguous for h>1 curve");const T=O===2||O===3?S+a:S;if(!s.isValid(T))throw new Error("recovery id 2 or 3 invalid");const L=s.toBytes(T),P=e.fromBytes(Vt(Ed((O&1)===0),L)),j=o.inv(T),N=R(We("msgHash",g)),M=o.create(-N*j),z=o.create(I*j),G=e.BASE.multiplyUnsafe(M).add(P.multiplyUnsafe(z));if(G.is0())throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return v(this.s)}toBytes(g=m){if(Ga(g),g==="der")return as(Jt.hexFromSig(this));const y=o.toBytes(this.r),S=o.toBytes(this.s);if(g==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Vt(Uint8Array.of(this.recovery),y,S)}return Vt(y,S)}toHex(g){return Er(this.toBytes(g))}assertValidity(){}static fromCompact(g){return x.fromBytes(We("sig",g),"compact")}static fromDER(g){return x.fromBytes(We("sig",g),"der")}normalizeS(){return this.hasHighS()?new x(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Er(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Er(this.toBytes("compact"))}}const _=n.bits2int||function(g){if(g.length>8192)throw new Error("input is too large");const y=Ds(g),S=g.length*8-f;return S>0?y>>BigInt(S):y},R=n.bits2int_modN||function(g){return o.create(_(g))},$=li(f);function F(w){return O3("num < 2^"+f,w,Qt,$),o.toBytes(w)}function U(w,g){return Xn(w,void 0,"message"),g?Xn(t(w),void 0,"prehashed message"):w}function A(w,g,y){if(["recovered","canonical"].some(M=>M in y))throw new Error("sign() legacy options not supported");const{lowS:S,prehash:I,extraEntropy:O}=Za(y,b);w=U(w,I);const B=R(w),T=Ar(o,g),L=[F(T),F(B)];if(O!=null&&O!==!1){const M=O===!0?r(l.secretKey):O;L.push(We("extraEntropy",M))}const P=Vt(...L),j=B;function N(M){const z=_(M);if(!o.isValidNot0(z))return;const G=o.inv(z),H=e.BASE.multiply(z).toAffine(),K=o.create(H.x);if(K===Qt)return;const J=o.create(G*o.create(j+K*T));if(J===Qt)return;let ee=(H.x===K?0:2)|Number(H.y&Dr),re=J;return S&&v(J)&&(re=o.neg(J),ee^=1),new x(K,re,ee)}return{seed:P,k2sig:N}}function q(w,g,y={}){w=We("message",w);const{seed:S,k2sig:I}=A(w,g,y);return B3(t.outputLen,o.BYTES,i)(S,I)}function k(w){let g;const y=typeof w=="string"||os(w),S=!y&&w!==null&&typeof w=="object"&&typeof w.r=="bigint"&&typeof w.s=="bigint";if(!y&&!S)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(S)g=new x(w.r,w.s);else if(y){try{g=x.fromBytes(We("sig",w),"der")}catch(I){if(!(I instanceof Jt.Err))throw I}if(!g)try{g=x.fromBytes(We("sig",w),"compact")}catch{return!1}}return g||!1}function E(w,g,y,S={}){const{lowS:I,prehash:O,format:B}=Za(S,b);if(y=We("publicKey",y),g=U(We("message",g),O),"strict"in S)throw new Error("options.strict was renamed to lowS");const T=B===void 0?k(w):x.fromBytes(We("sig",w),B);if(T===!1)return!1;try{const L=e.fromBytes(y);if(I&&T.hasHighS())return!1;const{r:P,s:j}=T,N=R(g),M=o.inv(j),z=o.create(N*M),G=o.create(P*M),H=e.BASE.multiplyUnsafe(z).add(L.multiplyUnsafe(G));return H.is0()?!1:o.create(H.x)===P}catch{return!1}}function p(w,g,y={}){const{prehash:S}=Za(y,b);return g=U(g,S),x.fromBytes(w,"recovered").recoverPublicKey(g).toBytes()}return Object.freeze({keygen:c,getPublicKey:u,getSharedSecret:d,utils:h,lengths:l,Point:e,sign:q,verify:E,recoverPublicKey:p,Signature:x,hash:t})}function Y3(e){const t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},n=e.Fp;let r=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=hi(t.n,{BITS:e.nBitLength,allowedLengths:r,modFromBytes:e.wrapPrivateKey}),s={Fp:n,Fn:i,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes};return{CURVE:t,curveOpts:s}}function W3(e){const{CURVE:t,curveOpts:n}=Y3(e),r={hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN};return{CURVE:t,curveOpts:n,hash:e.hash,ecdsaOpts:r}}function X3(e,t){const n=t.Point;return Object.assign({},t,{ProjectivePoint:n,CURVE:Object.assign({},e,ud(n.Fn.ORDER,n.Fn.BITS))})}function J3(e){const{CURVE:t,curveOpts:n,hash:r,ecdsaOpts:i}=W3(e),s=K3(t,n),o=Z3(s,r,i);return X3(e,o)}function Q3(e,t){const n=r=>J3({...e,hash:r});return{...n(t),create:n}}oa("HashToScalar-");const Ya={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},e8={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},_d=BigInt(2);function t8(e){const t=Ya.p,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),f=BigInt(88),c=e*e*e%t,u=c*c*e%t,d=pt(u,n,t)*u%t,h=pt(d,n,t)*u%t,l=pt(h,_d,t)*c%t,b=pt(l,i,t)*l%t,m=pt(b,s,t)*b%t,v=pt(m,a,t)*m%t,D=pt(v,f,t)*v%t,C=pt(D,a,t)*m%t,x=pt(C,n,t)*u%t,_=pt(x,o,t)*b%t,R=pt(_,r,t)*c%t,$=pt(R,_d,t);if(!Wa.eql(Wa.sqr($),e))throw new Error("Cannot find square root");return $}const Wa=hi(Ya.p,{sqrt:t8});Q3({...Ya,Fp:Wa,lowS:!0,endo:e8},xr);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Tr(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Xa(e,...t){if(!Tr(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function xd(e,t){return Array.isArray(t)?t.length===0?!0:e?t.every(n=>typeof n=="string"):t.every(n=>Number.isSafeInteger(n)):!1}function Ja(e){if(typeof e!="function")throw new Error("function expected");return!0}function xn(e,t){if(typeof t!="string")throw new Error(`${e}: string expected`);return!0}function Rr(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function Rs(e){if(!Array.isArray(e))throw new Error("array expected")}function Ns(e,t){if(!xd(!0,t))throw new Error(`${e}: array of strings expected`)}function Qa(e,t){if(!xd(!1,t))throw new Error(`${e}: array of numbers expected`)}function Je(...e){const t=s=>s,n=(s,o)=>a=>s(o(a)),r=e.map(s=>s.encode).reduceRight(n,t),i=e.map(s=>s.decode).reduce(n,t);return{encode:r,decode:i}}function at(e){const t=typeof e=="string"?e.split(""):e,n=t.length;Ns("alphabet",t);const r=new Map(t.map((i,s)=>[i,s]));return{encode:i=>(Rs(i),i.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${e}`);return t[s]})),decode:i=>(Rs(i),i.map(s=>{xn("alphabet.decode",s);const o=r.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${e}`);return o}))}}function ct(e=""){return xn("join",e),{encode:t=>(Ns("join.decode",t),t.join(e)),decode:t=>(xn("join.decode",t),t.split(e))}}function Cs(e,t="="){return Rr(e),xn("padding",t),{encode(n){for(Ns("padding.encode",n);n.length*e%8;)n.push(t);return n},decode(n){Ns("padding.decode",n);let r=n.length;if(r*e%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if((r-1)*e%8===0)throw new Error("padding: invalid, string has too much padding");return n.slice(0,r)}}}function Sd(e){return Ja(e),{encode:t=>t,decode:t=>e(t)}}function Id(e,t,n){if(t<2)throw new Error(`convertRadix: invalid from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: invalid to=${n}, base cannot be less than 2`);if(Rs(e),!e.length)return[];let r=0;const i=[],s=Array.from(e,a=>{if(Rr(a),a<0||a>=t)throw new Error(`invalid integer: ${a}`);return a}),o=s.length;for(;;){let a=0,f=!0;for(let c=r;c<o;c++){const u=s[c],d=t*a,h=d+u;if(!Number.isSafeInteger(h)||d/t!==a||h-u!==d)throw new Error("convertRadix: carry overflow");const l=h/n;a=h%n;const b=Math.floor(l);if(s[c]=b,!Number.isSafeInteger(b)||b*n+a!==h)throw new Error("convertRadix: carry overflow");if(f)b?f=!1:r=c;else continue}if(i.push(a),f)break}for(let a=0;a<e.length-1&&e[a]===0;a++)i.push(0);return i.reverse()}const Od=(e,t)=>t===0?e:Od(t,e%t),Ps=(e,t)=>e+(t-Od(e,t)),$s=(()=>{let e=[];for(let t=0;t<40;t++)e.push(2**t);return e})();function ec(e,t,n,r){if(Rs(e),t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Ps(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${Ps(t,n)}`);let i=0,s=0;const o=$s[t],a=$s[n]-1,f=[];for(const c of e){if(Rr(c),c>=o)throw new Error(`convertRadix2: invalid data word=${c} from=${t}`);if(i=i<<t|c,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)f.push((i>>s-n&a)>>>0);const u=$s[s];if(u===void 0)throw new Error("invalid carry");i&=u-1}if(i=i<<n-s&a,!r&&s>=t)throw new Error("Excess padding");if(!r&&i>0)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&f.push(i>>>0),f}function n8(e){Rr(e);const t=2**8;return{encode:n=>{if(!Tr(n))throw new Error("radix.encode input should be Uint8Array");return Id(Array.from(n),t,e)},decode:n=>(Qa("radix.decode",n),Uint8Array.from(Id(n,e,t)))}}function bt(e,t=!1){if(Rr(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Ps(8,e)>32||Ps(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!Tr(n))throw new Error("radix2.encode input should be Uint8Array");return ec(Array.from(n),8,e,!t)},decode:n=>(Qa("radix2.decode",n),Uint8Array.from(ec(n,e,8,t)))}}function Bd(e){return Ja(e),function(...t){try{return e.apply(null,t)}catch{}}}function r8(e,t){return Rr(e),Ja(t),{encode(n){if(!Tr(n))throw new Error("checksum.encode: input should be Uint8Array");const r=t(n).slice(0,e),i=new Uint8Array(n.length+e);return i.set(n),i.set(r,n.length),i},decode(n){if(!Tr(n))throw new Error("checksum.decode: input should be Uint8Array");const r=n.slice(0,-e),i=n.slice(-e),s=t(r).slice(0,e);for(let o=0;o<e;o++)if(s[o]!==i[o])throw new Error("Invalid checksum");return r}}}const Dd=typeof Uint8Array.from([]).toBase64=="function"&&typeof Uint8Array.fromBase64=="function",Ad=(e,t)=>{xn("base64",e);const n=t?/^[A-Za-z0-9=_-]+$/:/^[A-Za-z0-9=+/]+$/,r=t?"base64url":"base64";if(e.length>0&&!n.test(e))throw new Error("invalid base64");return Uint8Array.fromBase64(e,{alphabet:r,lastChunkHandling:"strict"})},tc=e=>Je(n8(58),at(e),ct("")),i8=tc("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),s8=e=>Je(r8(4,t=>e(e(t))),i8),nc=Je(at("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),ct("")),Td=[996825010,642813549,513874426,1027748829,705979059];function di(e){const t=e>>25;let n=(e&33554431)<<5;for(let r=0;r<Td.length;r++)(t>>r&1)===1&&(n^=Td[r]);return n}function Rd(e,t,n=1){const r=e.length;let i=1;for(let s=0;s<r;s++){const o=e.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${e})`);i=di(i)^o>>5}i=di(i);for(let s=0;s<r;s++)i=di(i)^e.charCodeAt(s)&31;for(let s of t)i=di(i)^s;for(let s=0;s<6;s++)i=di(i);return i^=n,nc.encode(ec([i%$s[30]],30,5,!1))}function Nd(e){const t=e==="bech32"?1:734539939,n=bt(5),r=n.decode,i=n.encode,s=Bd(r);function o(d,h,l=90){xn("bech32.encode prefix",d),Tr(h)&&(h=Array.from(h)),Qa("bech32.encode",h);const b=d.length;if(b===0)throw new TypeError(`Invalid prefix length ${b}`);const m=b+7+h.length;if(l!==!1&&m>l)throw new TypeError(`Length ${m} exceeds limit ${l}`);const v=d.toLowerCase(),D=Rd(v,h,t);return`${v}1${nc.encode(h)}${D}`}function a(d,h=90){xn("bech32.decode input",d);const l=d.length;if(l<8||h!==!1&&l>h)throw new TypeError(`invalid string length: ${l} (${d}). Expected (8..${h})`);const b=d.toLowerCase();if(d!==b&&d!==d.toUpperCase())throw new Error("String must be lowercase or uppercase");const m=b.lastIndexOf("1");if(m===0||m===-1)throw new Error('Letter "1" must be present between prefix and data only');const v=b.slice(0,m),D=b.slice(m+1);if(D.length<6)throw new Error("Data must be at least 6 characters long");const C=nc.decode(D).slice(0,-6),x=Rd(v,C,t);if(!D.endsWith(x))throw new Error(`Invalid checksum in ${d}: expected "${x}"`);return{prefix:v,words:C}}const f=Bd(a);function c(d){const{prefix:h,words:l}=a(d,!1);return{prefix:h,words:l,bytes:r(l)}}function u(d,h){return o(d,i(h))}return{encode:o,decode:a,encodeFromBytes:u,decodeToBytes:c,decodeUnsafe:f,fromWords:r,fromWordsUnsafe:s,toWords:i}}const o8=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",a8={encode(e){return Xa(e),e.toHex()},decode(e){return xn("hex",e),Uint8Array.fromHex(e)}};s8(xr),oa("Bitcoin seed");/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function Cd(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Ls(e,...t){if(!Cd(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Us(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Pd(e,t){Ls(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function gi(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function rc(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function c8(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function f8(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function pi(e){if(typeof e=="string")e=f8(e);else if(Cd(e))e=$d(e);else throw new Error("Uint8Array expected, got "+typeof e);return e}function $d(e){return Uint8Array.from(e)}const en=16,ic=new Uint8Array(16),$t=gi(ic),u8=225,l8=(e,t,n,r)=>{const i=r&1;return{s3:n<<31|r>>>1,s2:t<<31|n>>>1,s1:e<<31|t>>>1,s0:e>>>1^u8<<24&-(i&1)}},yt=e=>(e>>>0&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255|0;function h8(e){e.reverse();const t=e[15]&1;let n=0;for(let r=0;r<e.length;r++){const i=e[r];e[r]=i>>>1|n,n=(i&1)<<7}return e[0]^=-t&225,e}const d8=e=>e>64*1024?8:e>1024?4:2;class Ld{constructor(t,n){this.blockLen=en,this.outputLen=en,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,t=pi(t),Ls(t,16);const r=c8(t);let i=r.getUint32(0,!1),s=r.getUint32(4,!1),o=r.getUint32(8,!1),a=r.getUint32(12,!1);const f=[];for(let b=0;b<128;b++)f.push({s0:yt(i),s1:yt(s),s2:yt(o),s3:yt(a)}),{s0:i,s1:s,s2:o,s3:a}=l8(i,s,o,a);const c=d8(n||1024);if(![1,2,4,8].includes(c))throw new Error("ghash: invalid window size, expected 2, 4 or 8");this.W=c;const d=128/c,h=this.windowSize=2**c,l=[];for(let b=0;b<d;b++)for(let m=0;m<h;m++){let v=0,D=0,C=0,x=0;for(let _=0;_<c;_++){if(!(m>>>c-_-1&1))continue;const{s0:$,s1:F,s2:U,s3:A}=f[c*b+_];v^=$,D^=F,C^=U,x^=A}l.push({s0:v,s1:D,s2:C,s3:x})}this.t=l}_updateBlock(t,n,r,i){t^=this.s0,n^=this.s1,r^=this.s2,i^=this.s3;const{W:s,t:o,windowSize:a}=this;let f=0,c=0,u=0,d=0;const h=(1<<s)-1;let l=0;for(const b of[t,n,r,i])for(let m=0;m<4;m++){const v=b>>>8*m&255;for(let D=8/s-1;D>=0;D--){const C=v>>>s*D&h,{s0:x,s1:_,s2:R,s3:$}=o[l*a+C];f^=x,c^=_,u^=R,d^=$,l+=1}}this.s0=f,this.s1=c,this.s2=u,this.s3=d}update(t){Us(this),t=pi(t),Ls(t);const n=gi(t),r=Math.floor(t.length/en),i=t.length%en;for(let s=0;s<r;s++)this._updateBlock(n[s*4+0],n[s*4+1],n[s*4+2],n[s*4+3]);return i&&(ic.set(t.subarray(r*en)),this._updateBlock($t[0],$t[1],$t[2],$t[3]),rc($t)),this}destroy(){const{t}=this;for(const n of t)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(t){Us(this),Pd(t,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=gi(t);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,t}digest(){const t=new Uint8Array(en);return this.digestInto(t),this.destroy(),t}}class g8 extends Ld{constructor(t,n){t=pi(t),Ls(t);const r=h8($d(t));super(r,n),rc(r)}update(t){t=pi(t),Us(this);const n=gi(t),r=t.length%en,i=Math.floor(t.length/en);for(let s=0;s<i;s++)this._updateBlock(yt(n[s*4+3]),yt(n[s*4+2]),yt(n[s*4+1]),yt(n[s*4+0]));return r&&(ic.set(t.subarray(i*en)),this._updateBlock(yt($t[3]),yt($t[2]),yt($t[1]),yt($t[0])),rc($t)),this}digestInto(t){Us(this),Pd(t,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=gi(t);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,t.reverse()}}function Ud(e){const t=(r,i)=>e(i,r.length).update(pi(r)).digest(),n=e(new Uint8Array(16),0);return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=(r,i)=>e(r,i),t}Ud((e,t)=>new Ld(e,t)),Ud((e,t)=>new g8(e,t));const Fd=wn(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),p8=Fd.create(BigInt("-3")),b8=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b");Es({a:p8,b:b8,Fp:Fd,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},xr);const jd=wn(BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff")),y8=jd.create(BigInt("-3")),m8=BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef");Es({a:y8,b:m8,Fp:jd,n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f"),h:BigInt(1),lowS:!1},uv);const Md=wn(BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff")),w8=Md.create(BigInt("-3")),E8=BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00");Es({a:w8,b:E8,Fp:Md,n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650"),h:BigInt(1),lowS:!1,allowedPrivateKeyLengths:[130,131,132]},fv);var v8={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function i(f,c,u){this.fn=f,this.context=c,this.once=u||!1}function s(f,c,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var l=new i(u,d||f,h),b=n?n+c:c;return f._events[b]?f._events[b].fn?f._events[b]=[f._events[b],l]:f._events[b].push(l):(f._events[b]=l,f._eventsCount++),f}function o(f,c){--f._eventsCount===0?f._events=new r:delete f._events[c]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)t.call(u,d)&&c.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var u=n?n+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,l=d.length,b=new Array(l);h<l;h++)b[h]=d[h].fn;return b},a.prototype.listenerCount=function(c){var u=n?n+c:c,d=this._events[u];return d?d.fn?1:d.length:0},a.prototype.emit=function(c,u,d,h,l,b){var m=n?n+c:c;if(!this._events[m])return!1;var v=this._events[m],D=arguments.length,C,x;if(v.fn){switch(v.once&&this.removeListener(c,v.fn,void 0,!0),D){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,u),!0;case 3:return v.fn.call(v.context,u,d),!0;case 4:return v.fn.call(v.context,u,d,h),!0;case 5:return v.fn.call(v.context,u,d,h,l),!0;case 6:return v.fn.call(v.context,u,d,h,l,b),!0}for(x=1,C=new Array(D-1);x<D;x++)C[x-1]=arguments[x];v.fn.apply(v.context,C)}else{var _=v.length,R;for(x=0;x<_;x++)switch(v[x].once&&this.removeListener(c,v[x].fn,void 0,!0),D){case 1:v[x].fn.call(v[x].context);break;case 2:v[x].fn.call(v[x].context,u);break;case 3:v[x].fn.call(v[x].context,u,d);break;case 4:v[x].fn.call(v[x].context,u,d,h);break;default:if(!C)for(R=1,C=new Array(D-1);R<D;R++)C[R-1]=arguments[R];v[x].fn.apply(v[x].context,C)}}return!0},a.prototype.on=function(c,u,d){return s(this,c,u,d,!1)},a.prototype.once=function(c,u,d){return s(this,c,u,d,!0)},a.prototype.removeListener=function(c,u,d,h){var l=n?n+c:c;if(!this._events[l])return this;if(!u)return o(this,l),this;var b=this._events[l];if(b.fn)b.fn===u&&(!h||b.once)&&(!d||b.context===d)&&o(this,l);else{for(var m=0,v=[],D=b.length;m<D;m++)(b[m].fn!==u||h&&!b[m].once||d&&b[m].context!==d)&&v.push(b[m]);v.length?this._events[l]=v.length===1?v[0]:v:o(this,l)}return this},a.prototype.removeAllListeners=function(c){var u;return c?(u=n?n+c:c,this._events[u]&&o(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a})(v8);function _8(e){if(e.length>=255)throw new TypeError("Alphabet too long");const t=new Uint8Array(256);for(let c=0;c<t.length;c++)t[c]=255;for(let c=0;c<e.length;c++){const u=e.charAt(c),d=u.charCodeAt(0);if(t[d]!==255)throw new TypeError(u+" is ambiguous");t[d]=c}const n=e.length,r=e.charAt(0),i=Math.log(n)/Math.log(256),s=Math.log(256)/Math.log(n);function o(c){if(c instanceof Uint8Array||(ArrayBuffer.isView(c)?c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength):Array.isArray(c)&&(c=Uint8Array.from(c))),!(c instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(c.length===0)return"";let u=0,d=0,h=0;const l=c.length;for(;h!==l&&c[h]===0;)h++,u++;const b=(l-h)*s+1>>>0,m=new Uint8Array(b);for(;h!==l;){let C=c[h],x=0;for(let _=b-1;(C!==0||x<d)&&_!==-1;_--,x++)C+=256*m[_]>>>0,m[_]=C%n>>>0,C=C/n>>>0;if(C!==0)throw new Error("Non-zero carry");d=x,h++}let v=b-d;for(;v!==b&&m[v]===0;)v++;let D=r.repeat(u);for(;v<b;++v)D+=e.charAt(m[v]);return D}function a(c){if(typeof c!="string")throw new TypeError("Expected String");if(c.length===0)return new Uint8Array;let u=0,d=0,h=0;for(;c[u]===r;)d++,u++;const l=(c.length-u)*i+1>>>0,b=new Uint8Array(l);for(;u<c.length;){const C=c.charCodeAt(u);if(C>255)return;let x=t[C];if(x===255)return;let _=0;for(let R=l-1;(x!==0||_<h)&&R!==-1;R--,_++)x+=n*b[R]>>>0,b[R]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");h=_,u++}let m=l-h;for(;m!==l&&b[m]===0;)m++;const v=new Uint8Array(d+(l-m));let D=d;for(;m!==l;)v[D++]=b[m++];return v}function f(c){const u=a(c);if(u)return u;throw new Error("Non-base"+n+" character")}return{encode:o,decodeUnsafe:a,decode:f}}var x8="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";_8(x8);function bi(e,t){t||(t=e.reduce((i,s)=>i+s.length,0));const n=Rl(t);let r=0;for(const i of e)n.set(i,r),r+=i.length;return ta(n)}function Qe(e,t="utf8"){const n=Pl[t];if(!n)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8"):n.encoder.encode(e).substring(1)}const S8={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var I8=Object.defineProperty,O8=Object.defineProperties,B8=Object.getOwnPropertyDescriptors,kd=Object.getOwnPropertySymbols,D8=Object.prototype.hasOwnProperty,A8=Object.prototype.propertyIsEnumerable,zd=(e,t,n)=>t in e?I8(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Nr=(e,t)=>{for(var n in t||(t={}))D8.call(t,n)&&zd(e,n,t[n]);if(kd)for(var n of kd(t))A8.call(t,n)&&zd(e,n,t[n]);return e},yi=(e,t)=>O8(e,B8(t));const T8="ReactNative",It={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},R8="js";function Fs(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function er(){return!br()&&!!ra()&&navigator.product===T8}function N8(){return er()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function C8(){return er()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function mi(){return!Fs()&&!!ra()&&!!br()}function js(){return er()?It.reactNative:Fs()?It.node:mi()?It.browser:It.unknown}function qd(){var e;try{return er()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(e=global.Application)==null?void 0:e.applicationId:void 0}catch{return}}function P8(e,t){const n=new URLSearchParams(e);return Object.entries(t).sort(([r],[i])=>r.localeCompare(i)).forEach(([r,i])=>{i!=null&&n.set(r,String(i))}),n.toString()}function $8(){return Ml()||{name:"",description:"",url:"",icons:[""]}}function L8(){if(js()===It.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:n,Version:r}=global.Platform;return[n,r].join("-")}const e=lE();if(e===null)return"unknown";const t=e.os?e.os.replace(" ","").toLowerCase():"unknown";return e.type==="browser"?[t,e.name,e.version].join("-"):[t,e.version].join("-")}function U8(){var e;const t=js();return t===It.browser?[t,((e=jl())==null?void 0:e.host)||"unknown"].join(":"):t}function Hd(e,t,n){const r=L8(),i=U8();return[[e,t].join("-"),[R8,n].join("-"),r,i].join("/")}function F8({protocol:e,version:t,relayUrl:n,sdkVersion:r,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:f}){const c=n.split("?"),u=Hd(e,t,r),d={auth:i,ua:u,projectId:s,useOnCloseEvent:o||void 0,packageName:f||void 0,bundleId:a||void 0},h=P8(c[1]||"",d);return c[0]+"?"+h}function sc(e){return Object.fromEntries(e.entries())}function oc(e){return new Map(Object.entries(e))}function j8(e=W.FIVE_MINUTES,t){const n=W.toMiliseconds(e||W.FIVE_MINUTES);let r,i,s,o;return{resolve:a=>{s&&r&&(clearTimeout(s),r(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,f)=>{if(o)return a(o);s=setTimeout(()=>{const c=new Error(t);o=Promise.reject(c),f(c)},n),r=a,i=f})}}function Lt(e,t,n){return new Promise(async(r,i)=>{const s=setTimeout(()=>i(new Error(n)),t);try{const o=await e;r(o)}catch(o){i(o)}clearTimeout(s)})}function Vd(e,t){if(typeof t=="string"&&t.startsWith(`${e}:`))return t;if(e.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(e.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${e}`)}function M8(e){return Vd("topic",e)}function k8(e){return Vd("id",e)}function z8(e){const[t,n]=e.split(":"),r={id:void 0,topic:void 0};if(t==="topic"&&typeof n=="string")r.topic=n;else if(t==="id"&&Number.isInteger(Number(n)))r.id=Number(n);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${n}`);return r}function wi(e,t){return W.fromMiliseconds((t||Date.now())+W.toMiliseconds(e))}function Kd(e){return Date.now()>=W.toMiliseconds(e)}function ac(e,t){return`${e}${t?`:${t}`:""}`}function Gd(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function Zd(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function Yd(e){return Buffer.from(e,"base64").toString("utf-8")}function q8(e){return new Promise(t=>setTimeout(t,e))}const Ms=BigInt(2**32-1),Wd=BigInt(32);function Xd(e,t=!1){return t?{h:Number(e&Ms),l:Number(e>>Wd&Ms)}:{h:Number(e>>Wd&Ms)|0,l:Number(e&Ms)|0}}function Jd(e,t=!1){const n=e.length;let r=new Uint32Array(n),i=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=Xd(e[s],t);[r[s],i[s]]=[o,a]}return[r,i]}const Qd=(e,t,n)=>e>>>n,e0=(e,t,n)=>e<<32-n|t>>>n,Sn=(e,t,n)=>e>>>n|t<<32-n,In=(e,t,n)=>e<<32-n|t>>>n,Ei=(e,t,n)=>e<<64-n|t>>>n-32,vi=(e,t,n)=>e>>>n-32|t<<64-n,H8=(e,t)=>t,V8=(e,t)=>e,K8=(e,t,n)=>e<<n|t>>>32-n,G8=(e,t,n)=>t<<n|e>>>32-n,Z8=(e,t,n)=>t<<n-32|e>>>64-n,Y8=(e,t,n)=>e<<n-32|t>>>64-n;function Ot(e,t,n,r){const i=(t>>>0)+(r>>>0);return{h:e+n+(i/2**32|0)|0,l:i|0}}const cc=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),fc=(e,t,n,r)=>t+n+r+(e/2**32|0)|0,W8=(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),X8=(e,t,n,r,i)=>t+n+r+i+(e/2**32|0)|0,J8=(e,t,n,r,i)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(i>>>0),Q8=(e,t,n,r,i,s)=>t+n+r+i+s+(e/2**32|0)|0,Cr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function ks(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function tn(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function Bt(e,...t){if(!ks(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function zs(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");tn(e.outputLen),tn(e.blockLen)}function On(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function uc(e,t){Bt(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function _i(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function mt(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function lc(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Ut(e,t){return e<<32-t|e>>>t}const t0=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function n0(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}const nn=t0?e=>e:e=>n0(e);function e6(e){for(let t=0;t<e.length;t++)e[t]=n0(e[t]);return e}const Bn=t0?e=>e:e6,r0=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",t6=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Pr(e){if(Bt(e),r0)return e.toHex();let t="";for(let n=0;n<e.length;n++)t+=t6[e[n]];return t}const rn={_0:48,_9:57,A:65,F:70,a:97,f:102};function i0(e){if(e>=rn._0&&e<=rn._9)return e-rn._0;if(e>=rn.A&&e<=rn.F)return e-(rn.A-10);if(e>=rn.a&&e<=rn.f)return e-(rn.a-10)}function qs(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(r0)return Uint8Array.fromHex(e);const t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=i0(e.charCodeAt(s)),a=i0(e.charCodeAt(s+1));if(o===void 0||a===void 0){const f=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+f+'" at index '+s)}r[i]=o*16+a}return r}function s0(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function Dt(e){return typeof e=="string"&&(e=s0(e)),Bt(e),e}function Dn(...e){let t=0;for(let r=0;r<e.length;r++){const i=e[r];Bt(i),t+=i.length}const n=new Uint8Array(t);for(let r=0,i=0;r<e.length;r++){const s=e[r];n.set(s,i),i+=s.length}return n}class Hs{}function xi(e){const t=r=>e().update(Dt(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function n6(e){const t=(r,i)=>e(i).update(Dt(r)).digest(),n=e({});return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=r=>e(r),t}function tr(e=32){if(Cr&&typeof Cr.getRandomValues=="function")return Cr.getRandomValues(new Uint8Array(e));if(Cr&&typeof Cr.randomBytes=="function")return Uint8Array.from(Cr.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}const r6=BigInt(0),Si=BigInt(1),i6=BigInt(2),s6=BigInt(7),o6=BigInt(256),a6=BigInt(113),o0=[],a0=[],c0=[];for(let e=0,t=Si,n=1,r=0;e<24;e++){[n,r]=[r,(2*n+3*r)%5],o0.push(2*(5*r+n)),a0.push((e+1)*(e+2)/2%64);let i=r6;for(let s=0;s<7;s++)t=(t<<Si^(t>>s6)*a6)%o6,t&i6&&(i^=Si<<(Si<<BigInt(s))-Si);c0.push(i)}const f0=Jd(c0,!0),c6=f0[0],f6=f0[1],u0=(e,t,n)=>n>32?Z8(e,t,n):K8(e,t,n),l0=(e,t,n)=>n>32?Y8(e,t,n):G8(e,t,n);function u6(e,t=24){const n=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let o=0;o<10;o++)n[o]=e[o]^e[o+10]^e[o+20]^e[o+30]^e[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,f=(o+2)%10,c=n[f],u=n[f+1],d=u0(c,u,1)^n[a],h=l0(c,u,1)^n[a+1];for(let l=0;l<50;l+=10)e[o+l]^=d,e[o+l+1]^=h}let i=e[2],s=e[3];for(let o=0;o<24;o++){const a=a0[o],f=u0(i,s,a),c=l0(i,s,a),u=o0[o];i=e[u],s=e[u+1],e[u]=f,e[u+1]=c}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=e[o+a];for(let a=0;a<10;a++)e[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}e[0]^=c6[r],e[1]^=f6[r]}mt(n)}class hc extends Hs{constructor(t,n,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=t,this.suffix=n,this.outputLen=r,this.enableXOF=i,this.rounds=s,tn(r),!(0<t&&t<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=_i(this.state)}clone(){return this._cloneInto()}keccak(){Bn(this.state32),u6(this.state32,this.rounds),Bn(this.state32),this.posOut=0,this.pos=0}update(t){On(this),t=Dt(t),Bt(t);const{blockLen:n,state:r}=this,i=t.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=t[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:n,pos:r,blockLen:i}=this;t[r]^=n,(n&128)!==0&&r===i-1&&this.keccak(),t[i-1]^=128,this.keccak()}writeInto(t){On(this,!1),Bt(t),this.finish();const n=this.state,{blockLen:r}=this;for(let i=0,s=t.length;i<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-i);t.set(n.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return tn(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(uc(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,mt(this.state)}_cloneInto(t){const{blockLen:n,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return t||(t=new hc(n,r,i,o,s)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=s,t.suffix=r,t.outputLen=i,t.enableXOF=o,t.destroyed=this.destroyed,t}}((e,t,n)=>xi(()=>new hc(t,e,n)))(1,136,256/8);function l6(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),f=r?4:0,c=r?0:4;e.setUint32(t+f,o,r),e.setUint32(t+c,a,r)}function h6(e,t,n){return e&t^~e&n}function d6(e,t,n){return e&t^e&n^t&n}class h0 extends Hs{constructor(t,n,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(t),this.view=lc(this.buffer)}update(t){On(this),t=Dt(t),Bt(t);const{view:n,buffer:r,blockLen:i}=this,s=t.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const f=lc(t);for(;i<=s-o;o+=i)this.process(f,o);continue}r.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){On(this),uc(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,mt(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;l6(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=lc(t),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=f/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return t.destroyed=o,t.finished=s,t.length=i,t.pos=a,i%n&&t.buffer.set(r),t}clone(){return this._cloneInto()}}const An=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ce=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Pe=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),g6=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Tn=new Uint32Array(64);class p6 extends h0{constructor(t=32){super(64,t,8,!1),this.A=An[0]|0,this.B=An[1]|0,this.C=An[2]|0,this.D=An[3]|0,this.E=An[4]|0,this.F=An[5]|0,this.G=An[6]|0,this.H=An[7]|0}get(){const{A:t,B:n,C:r,D:i,E:s,F:o,G:a,H:f}=this;return[t,n,r,i,s,o,a,f]}set(t,n,r,i,s,o,a,f){this.A=t|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=f|0}process(t,n){for(let d=0;d<16;d++,n+=4)Tn[d]=t.getUint32(n,!1);for(let d=16;d<64;d++){const h=Tn[d-15],l=Tn[d-2],b=Ut(h,7)^Ut(h,18)^h>>>3,m=Ut(l,17)^Ut(l,19)^l>>>10;Tn[d]=m+Tn[d-7]+b+Tn[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:f,G:c,H:u}=this;for(let d=0;d<64;d++){const h=Ut(a,6)^Ut(a,11)^Ut(a,25),l=u+h+h6(a,f,c)+g6[d]+Tn[d]|0,b=(Ut(r,2)^Ut(r,13)^Ut(r,22))+d6(r,i,s)|0;u=c,c=f,f=a,a=o+l|0,o=s,s=i,i=r,r=l+b|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,f=f+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,f,c,u)}roundClean(){mt(Tn)}destroy(){this.set(0,0,0,0,0,0,0,0),mt(this.buffer)}}const d0=Jd(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),b6=d0[0],y6=d0[1],Rn=new Uint32Array(80),Nn=new Uint32Array(80);class dc extends h0{constructor(t=64){super(128,t,16,!1),this.Ah=Pe[0]|0,this.Al=Pe[1]|0,this.Bh=Pe[2]|0,this.Bl=Pe[3]|0,this.Ch=Pe[4]|0,this.Cl=Pe[5]|0,this.Dh=Pe[6]|0,this.Dl=Pe[7]|0,this.Eh=Pe[8]|0,this.El=Pe[9]|0,this.Fh=Pe[10]|0,this.Fl=Pe[11]|0,this.Gh=Pe[12]|0,this.Gl=Pe[13]|0,this.Hh=Pe[14]|0,this.Hl=Pe[15]|0}get(){const{Ah:t,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:f,Eh:c,El:u,Fh:d,Fl:h,Gh:l,Gl:b,Hh:m,Hl:v}=this;return[t,n,r,i,s,o,a,f,c,u,d,h,l,b,m,v]}set(t,n,r,i,s,o,a,f,c,u,d,h,l,b,m,v){this.Ah=t|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=f|0,this.Eh=c|0,this.El=u|0,this.Fh=d|0,this.Fl=h|0,this.Gh=l|0,this.Gl=b|0,this.Hh=m|0,this.Hl=v|0}process(t,n){for(let x=0;x<16;x++,n+=4)Rn[x]=t.getUint32(n),Nn[x]=t.getUint32(n+=4);for(let x=16;x<80;x++){const _=Rn[x-15]|0,R=Nn[x-15]|0,$=Sn(_,R,1)^Sn(_,R,8)^Qd(_,R,7),F=In(_,R,1)^In(_,R,8)^e0(_,R,7),U=Rn[x-2]|0,A=Nn[x-2]|0,q=Sn(U,A,19)^Ei(U,A,61)^Qd(U,A,6),k=In(U,A,19)^vi(U,A,61)^e0(U,A,6),E=W8(F,k,Nn[x-7],Nn[x-16]),p=X8(E,$,q,Rn[x-7],Rn[x-16]);Rn[x]=p|0,Nn[x]=E|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:f,Dh:c,Dl:u,Eh:d,El:h,Fh:l,Fl:b,Gh:m,Gl:v,Hh:D,Hl:C}=this;for(let x=0;x<80;x++){const _=Sn(d,h,14)^Sn(d,h,18)^Ei(d,h,41),R=In(d,h,14)^In(d,h,18)^vi(d,h,41),$=d&l^~d&m,F=h&b^~h&v,U=J8(C,R,F,y6[x],Nn[x]),A=Q8(U,D,_,$,b6[x],Rn[x]),q=U|0,k=Sn(r,i,28)^Ei(r,i,34)^Ei(r,i,39),E=In(r,i,28)^vi(r,i,34)^vi(r,i,39),p=r&s^r&a^s&a,w=i&o^i&f^o&f;D=m|0,C=v|0,m=l|0,v=b|0,l=d|0,b=h|0,{h:d,l:h}=Ot(c|0,u|0,A|0,q|0),c=a|0,u=f|0,a=s|0,f=o|0,s=r|0,o=i|0;const g=cc(q,E,w);r=fc(g,A,k,p),i=g|0}({h:r,l:i}=Ot(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=Ot(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:f}=Ot(this.Ch|0,this.Cl|0,a|0,f|0),{h:c,l:u}=Ot(this.Dh|0,this.Dl|0,c|0,u|0),{h:d,l:h}=Ot(this.Eh|0,this.El|0,d|0,h|0),{h:l,l:b}=Ot(this.Fh|0,this.Fl|0,l|0,b|0),{h:m,l:v}=Ot(this.Gh|0,this.Gl|0,m|0,v|0),{h:D,l:C}=Ot(this.Hh|0,this.Hl|0,D|0,C|0),this.set(r,i,s,o,a,f,c,u,d,h,l,b,m,v,D,C)}roundClean(){mt(Rn,Nn)}destroy(){mt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class m6 extends dc{constructor(){super(48),this.Ah=Ce[0]|0,this.Al=Ce[1]|0,this.Bh=Ce[2]|0,this.Bl=Ce[3]|0,this.Ch=Ce[4]|0,this.Cl=Ce[5]|0,this.Dh=Ce[6]|0,this.Dl=Ce[7]|0,this.Eh=Ce[8]|0,this.El=Ce[9]|0,this.Fh=Ce[10]|0,this.Fl=Ce[11]|0,this.Gh=Ce[12]|0,this.Gl=Ce[13]|0,this.Hh=Ce[14]|0,this.Hl=Ce[15]|0}}const $e=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class w6 extends dc{constructor(){super(32),this.Ah=$e[0]|0,this.Al=$e[1]|0,this.Bh=$e[2]|0,this.Bl=$e[3]|0,this.Ch=$e[4]|0,this.Cl=$e[5]|0,this.Dh=$e[6]|0,this.Dl=$e[7]|0,this.Eh=$e[8]|0,this.El=$e[9]|0,this.Fh=$e[10]|0,this.Fl=$e[11]|0,this.Gh=$e[12]|0,this.Gl=$e[13]|0,this.Hh=$e[14]|0,this.Hl=$e[15]|0}}const g0=xi(()=>new p6),E6=xi(()=>new dc),v6=xi(()=>new m6);xi(()=>new w6);const _6=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Ee=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),Z=new Uint32Array(32);function Cn(e,t,n,r,i,s){const o=i[s],a=i[s+1];let f=Z[2*e],c=Z[2*e+1],u=Z[2*t],d=Z[2*t+1],h=Z[2*n],l=Z[2*n+1],b=Z[2*r],m=Z[2*r+1],v=cc(f,u,o);c=fc(v,c,d,a),f=v|0,{Dh:m,Dl:b}={Dh:m^c,Dl:b^f},{Dh:m,Dl:b}={Dh:H8(m,b),Dl:V8(m)},{h:l,l:h}=Ot(l,h,m,b),{Bh:d,Bl:u}={Bh:d^l,Bl:u^h},{Bh:d,Bl:u}={Bh:Sn(d,u,24),Bl:In(d,u,24)},Z[2*e]=f,Z[2*e+1]=c,Z[2*t]=u,Z[2*t+1]=d,Z[2*n]=h,Z[2*n+1]=l,Z[2*r]=b,Z[2*r+1]=m}function Pn(e,t,n,r,i,s){const o=i[s],a=i[s+1];let f=Z[2*e],c=Z[2*e+1],u=Z[2*t],d=Z[2*t+1],h=Z[2*n],l=Z[2*n+1],b=Z[2*r],m=Z[2*r+1],v=cc(f,u,o);c=fc(v,c,d,a),f=v|0,{Dh:m,Dl:b}={Dh:m^c,Dl:b^f},{Dh:m,Dl:b}={Dh:Sn(m,b,16),Dl:In(m,b,16)},{h:l,l:h}=Ot(l,h,m,b),{Bh:d,Bl:u}={Bh:d^l,Bl:u^h},{Bh:d,Bl:u}={Bh:Ei(d,u,63),Bl:vi(d,u,63)},Z[2*e]=f,Z[2*e+1]=c,Z[2*t]=u,Z[2*t+1]=d,Z[2*n]=h,Z[2*n+1]=l,Z[2*r]=b,Z[2*r+1]=m}function x6(e,t={},n,r,i){if(tn(n),e<0||e>n)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=t;if(s!==void 0&&(s.length<1||s.length>n))throw new Error("key length must be undefined or 1.."+n);if(o!==void 0&&o.length!==r)throw new Error("salt must be undefined or "+r);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}class S6 extends Hs{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,tn(t),tn(n),this.blockLen=t,this.outputLen=n,this.buffer=new Uint8Array(t),this.buffer32=_i(this.buffer)}update(t){On(this),t=Dt(t),Bt(t);const{blockLen:n,buffer:r,buffer32:i}=this,s=t.length,o=t.byteOffset,a=t.buffer;for(let f=0;f<s;){this.pos===n&&(Bn(i),this.compress(i,0,!1),Bn(i),this.pos=0);const c=Math.min(n-this.pos,s-f),u=o+f;if(c===n&&!(u%4)&&f+c<s){const d=new Uint32Array(a,u,Math.floor((s-f)/4));Bn(d);for(let h=0;f+n<s;h+=i.length,f+=n)this.length+=n,this.compress(d,h,!1);Bn(d);continue}r.set(t.subarray(f,f+c),this.pos),this.pos+=c,this.length+=c,f+=c}return this}digestInto(t){On(this),uc(t,this);const{pos:n,buffer32:r}=this;this.finished=!0,mt(this.buffer.subarray(n)),Bn(r),this.compress(r,0,!0),Bn(r);const i=_i(t);this.get().forEach((s,o)=>i[o]=nn(s))}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){const{buffer:n,length:r,finished:i,destroyed:s,outputLen:o,pos:a}=this;return t||(t=new this.constructor({dkLen:o})),t.set(...this.get()),t.buffer.set(n),t.destroyed=s,t.finished=i,t.length=r,t.pos=a,t.outputLen=o,t}clone(){return this._cloneInto()}}class I6 extends S6{constructor(t={}){const n=t.dkLen===void 0?64:t.dkLen;super(128,n),this.v0l=Ee[0]|0,this.v0h=Ee[1]|0,this.v1l=Ee[2]|0,this.v1h=Ee[3]|0,this.v2l=Ee[4]|0,this.v2h=Ee[5]|0,this.v3l=Ee[6]|0,this.v3h=Ee[7]|0,this.v4l=Ee[8]|0,this.v4h=Ee[9]|0,this.v5l=Ee[10]|0,this.v5h=Ee[11]|0,this.v6l=Ee[12]|0,this.v6h=Ee[13]|0,this.v7l=Ee[14]|0,this.v7h=Ee[15]|0,x6(n,t,64,16,16);let{key:r,personalization:i,salt:s}=t,o=0;if(r!==void 0&&(r=Dt(r),o=r.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=Dt(s);const a=_i(s);this.v4l^=nn(a[0]),this.v4h^=nn(a[1]),this.v5l^=nn(a[2]),this.v5h^=nn(a[3])}if(i!==void 0){i=Dt(i);const a=_i(i);this.v6l^=nn(a[0]),this.v6h^=nn(a[1]),this.v7l^=nn(a[2]),this.v7h^=nn(a[3])}if(r!==void 0){const a=new Uint8Array(this.blockLen);a.set(r),this.update(a)}}get(){let{v0l:t,v0h:n,v1l:r,v1h:i,v2l:s,v2h:o,v3l:a,v3h:f,v4l:c,v4h:u,v5l:d,v5h:h,v6l:l,v6h:b,v7l:m,v7h:v}=this;return[t,n,r,i,s,o,a,f,c,u,d,h,l,b,m,v]}set(t,n,r,i,s,o,a,f,c,u,d,h,l,b,m,v){this.v0l=t|0,this.v0h=n|0,this.v1l=r|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=f|0,this.v4l=c|0,this.v4h=u|0,this.v5l=d|0,this.v5h=h|0,this.v6l=l|0,this.v6h=b|0,this.v7l=m|0,this.v7h=v|0}compress(t,n,r){this.get().forEach((f,c)=>Z[c]=f),Z.set(Ee,16);let{h:i,l:s}=Xd(BigInt(this.length));Z[24]=Ee[8]^s,Z[25]=Ee[9]^i,r&&(Z[28]=~Z[28],Z[29]=~Z[29]);let o=0;const a=_6;for(let f=0;f<12;f++)Cn(0,4,8,12,t,n+2*a[o++]),Pn(0,4,8,12,t,n+2*a[o++]),Cn(1,5,9,13,t,n+2*a[o++]),Pn(1,5,9,13,t,n+2*a[o++]),Cn(2,6,10,14,t,n+2*a[o++]),Pn(2,6,10,14,t,n+2*a[o++]),Cn(3,7,11,15,t,n+2*a[o++]),Pn(3,7,11,15,t,n+2*a[o++]),Cn(0,5,10,15,t,n+2*a[o++]),Pn(0,5,10,15,t,n+2*a[o++]),Cn(1,6,11,12,t,n+2*a[o++]),Pn(1,6,11,12,t,n+2*a[o++]),Cn(2,7,8,13,t,n+2*a[o++]),Pn(2,7,8,13,t,n+2*a[o++]),Cn(3,4,9,14,t,n+2*a[o++]),Pn(3,4,9,14,t,n+2*a[o++]);this.v0l^=Z[0]^Z[16],this.v0h^=Z[1]^Z[17],this.v1l^=Z[2]^Z[18],this.v1h^=Z[3]^Z[19],this.v2l^=Z[4]^Z[20],this.v2h^=Z[5]^Z[21],this.v3l^=Z[6]^Z[22],this.v3h^=Z[7]^Z[23],this.v4l^=Z[8]^Z[24],this.v4h^=Z[9]^Z[25],this.v5l^=Z[10]^Z[26],this.v5h^=Z[11]^Z[27],this.v6l^=Z[12]^Z[28],this.v6h^=Z[13]^Z[29],this.v7l^=Z[14]^Z[30],this.v7h^=Z[15]^Z[31],mt(Z)}destroy(){this.destroyed=!0,mt(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}n6(e=>new I6(e));/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function p0(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function gc(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function pc(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function et(e,...t){if(!p0(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function b0(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function O6(e,t){et(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function $n(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function $r(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function B6(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}const D6=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function A6(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function bc(e){if(typeof e=="string")e=A6(e);else if(p0(e))e=yc(e);else throw new Error("Uint8Array expected, got "+typeof e);return e}function T6(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function R6(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}const N6=(e,t)=>{function n(r,...i){if(et(r),!D6)throw new Error("Non little-endian hardware is not yet supported");if(e.nonceLength!==void 0){const c=i[0];if(!c)throw new Error("nonce / iv required");e.varSizeNonce?et(c):et(c,e.nonceLength)}const s=e.tagLength;s&&i[1]!==void 0&&et(i[1]);const o=t(r,...i),a=(c,u)=>{if(u!==void 0){if(c!==2)throw new Error("cipher output not supported");et(u)}};let f=!1;return{encrypt(c,u){if(f)throw new Error("cannot encrypt() twice with same key + nonce");return f=!0,et(c),a(o.encrypt.length,u),o.encrypt(c,u)},decrypt(c,u){if(et(c),s&&c.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,u),o.decrypt(c,u)}}}return Object.assign(n,e),n};function y0(e,t,n=!0){if(t===void 0)return new Uint8Array(e);if(t.length!==e)throw new Error("invalid output length, expected "+e+", got: "+t.length);if(n&&!P6(t))throw new Error("invalid output, must be aligned");return t}function m0(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),f=r?4:0,c=r?0:4;e.setUint32(t+f,o,r),e.setUint32(t+c,a,r)}function C6(e,t,n){gc(n);const r=new Uint8Array(16),i=B6(r);return m0(i,0,BigInt(t),n),m0(i,8,BigInt(e),n),r}function P6(e){return e.byteOffset%4===0}function yc(e){return Uint8Array.from(e)}const w0=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),$6=w0("expand 16-byte k"),L6=w0("expand 32-byte k"),U6=$n($6),F6=$n(L6);function ie(e,t){return e<<t|e>>>32-t}function mc(e){return e.byteOffset%4===0}const Vs=64,j6=16,E0=2**32-1,v0=new Uint32Array;function M6(e,t,n,r,i,s,o,a){const f=i.length,c=new Uint8Array(Vs),u=$n(c),d=mc(i)&&mc(s),h=d?$n(i):v0,l=d?$n(s):v0;for(let b=0;b<f;o++){if(e(t,n,r,u,o,a),o>=E0)throw new Error("arx: counter overflow");const m=Math.min(Vs,f-b);if(d&&m===Vs){const v=b/4;if(b%4!==0)throw new Error("arx: invalid block position");for(let D=0,C;D<j6;D++)C=v+D,l[C]=h[C]^u[D];b+=Vs;continue}for(let v=0,D;v<m;v++)D=b+v,s[D]=i[D]^c[v];b+=m}}function k6(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=T6({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return pc(i),pc(o),gc(s),gc(n),(a,f,c,u,d=0)=>{et(a),et(f),et(c);const h=c.length;if(u===void 0&&(u=new Uint8Array(h)),et(u),pc(d),d<0||d>=E0)throw new Error("arx: counter overflow");if(u.length<h)throw new Error(`arx: output (${u.length}) is shorter than data (${h})`);const l=[];let b=a.length,m,v;if(b===32)l.push(m=yc(a)),v=F6;else if(b===16&&n)m=new Uint8Array(32),m.set(a),m.set(a,16),v=U6,l.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${b}`);mc(f)||l.push(f=yc(f));const D=$n(m);if(r){if(f.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(v,D,$n(f.subarray(0,16)),D),f=f.subarray(16)}const C=16-i;if(C!==f.length)throw new Error(`arx: nonce must be ${C} or 16 bytes`);if(C!==12){const _=new Uint8Array(12);_.set(f,s?0:12-f.length),f=_,l.push(f)}const x=$n(f);return M6(e,v,D,x,c,u,d,o),$r(...l),u}}const De=(e,t)=>e[t++]&255|(e[t++]&255)<<8;class z6{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=bc(t),et(t,32);const n=De(t,0),r=De(t,2),i=De(t,4),s=De(t,6),o=De(t,8),a=De(t,10),f=De(t,12),c=De(t,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|f<<5)&8065,this.r[8]=(f>>>8|c<<8)&8191,this.r[9]=c>>>5&127;for(let u=0;u<8;u++)this.pad[u]=De(t,16+2*u)}process(t,n,r=!1){const i=r?0:2048,{h:s,r:o}=this,a=o[0],f=o[1],c=o[2],u=o[3],d=o[4],h=o[5],l=o[6],b=o[7],m=o[8],v=o[9],D=De(t,n+0),C=De(t,n+2),x=De(t,n+4),_=De(t,n+6),R=De(t,n+8),$=De(t,n+10),F=De(t,n+12),U=De(t,n+14);let A=s[0]+(D&8191),q=s[1]+((D>>>13|C<<3)&8191),k=s[2]+((C>>>10|x<<6)&8191),E=s[3]+((x>>>7|_<<9)&8191),p=s[4]+((_>>>4|R<<12)&8191),w=s[5]+(R>>>1&8191),g=s[6]+((R>>>14|$<<2)&8191),y=s[7]+(($>>>11|F<<5)&8191),S=s[8]+((F>>>8|U<<8)&8191),I=s[9]+(U>>>5|i),O=0,B=O+A*a+q*(5*v)+k*(5*m)+E*(5*b)+p*(5*l);O=B>>>13,B&=8191,B+=w*(5*h)+g*(5*d)+y*(5*u)+S*(5*c)+I*(5*f),O+=B>>>13,B&=8191;let T=O+A*f+q*a+k*(5*v)+E*(5*m)+p*(5*b);O=T>>>13,T&=8191,T+=w*(5*l)+g*(5*h)+y*(5*d)+S*(5*u)+I*(5*c),O+=T>>>13,T&=8191;let L=O+A*c+q*f+k*a+E*(5*v)+p*(5*m);O=L>>>13,L&=8191,L+=w*(5*b)+g*(5*l)+y*(5*h)+S*(5*d)+I*(5*u),O+=L>>>13,L&=8191;let P=O+A*u+q*c+k*f+E*a+p*(5*v);O=P>>>13,P&=8191,P+=w*(5*m)+g*(5*b)+y*(5*l)+S*(5*h)+I*(5*d),O+=P>>>13,P&=8191;let j=O+A*d+q*u+k*c+E*f+p*a;O=j>>>13,j&=8191,j+=w*(5*v)+g*(5*m)+y*(5*b)+S*(5*l)+I*(5*h),O+=j>>>13,j&=8191;let N=O+A*h+q*d+k*u+E*c+p*f;O=N>>>13,N&=8191,N+=w*a+g*(5*v)+y*(5*m)+S*(5*b)+I*(5*l),O+=N>>>13,N&=8191;let M=O+A*l+q*h+k*d+E*u+p*c;O=M>>>13,M&=8191,M+=w*f+g*a+y*(5*v)+S*(5*m)+I*(5*b),O+=M>>>13,M&=8191;let z=O+A*b+q*l+k*h+E*d+p*u;O=z>>>13,z&=8191,z+=w*c+g*f+y*a+S*(5*v)+I*(5*m),O+=z>>>13,z&=8191;let G=O+A*m+q*b+k*l+E*h+p*d;O=G>>>13,G&=8191,G+=w*u+g*c+y*f+S*a+I*(5*v),O+=G>>>13,G&=8191;let H=O+A*v+q*m+k*b+E*l+p*h;O=H>>>13,H&=8191,H+=w*d+g*u+y*c+S*f+I*a,O+=H>>>13,H&=8191,O=(O<<2)+O|0,O=O+B|0,B=O&8191,O=O>>>13,T+=O,s[0]=B,s[1]=T,s[2]=L,s[3]=P,s[4]=j,s[5]=N,s[6]=M,s[7]=z,s[8]=G,s[9]=H}finalize(){const{h:t,pad:n}=this,r=new Uint16Array(10);let i=t[1]>>>13;t[1]&=8191;for(let a=2;a<10;a++)t[a]+=i,i=t[a]>>>13,t[a]&=8191;t[0]+=i*5,i=t[0]>>>13,t[0]&=8191,t[1]+=i,i=t[1]>>>13,t[1]&=8191,t[2]+=i,r[0]=t[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=t[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)t[a]=t[a]&s|r[a];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let o=t[0]+n[0];t[0]=o&65535;for(let a=1;a<8;a++)o=(t[a]+n[a]|0)+(o>>>16)|0,t[a]=o&65535;$r(r)}update(t){b0(this),t=bc(t),et(t);const{buffer:n,blockLen:r}=this,i=t.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o===r){for(;r<=i-s;s+=r)this.process(t,s);continue}n.set(t.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){$r(this.h,this.r,this.buffer,this.pad)}digestInto(t){b0(this),O6(t,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:i}=this;if(i){for(n[i++]=1;i<16;i++)n[i]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)t[s++]=r[o]>>>0,t[s++]=r[o]>>>8;return t}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}}function q6(e){const t=(r,i)=>e(i).update(bc(r)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=r=>e(r),t}const H6=q6(e=>new z6(e));function V6(e,t,n,r,i,s=20){let o=e[0],a=e[1],f=e[2],c=e[3],u=t[0],d=t[1],h=t[2],l=t[3],b=t[4],m=t[5],v=t[6],D=t[7],C=i,x=n[0],_=n[1],R=n[2],$=o,F=a,U=f,A=c,q=u,k=d,E=h,p=l,w=b,g=m,y=v,S=D,I=C,O=x,B=_,T=R;for(let P=0;P<s;P+=2)$=$+q|0,I=ie(I^$,16),w=w+I|0,q=ie(q^w,12),$=$+q|0,I=ie(I^$,8),w=w+I|0,q=ie(q^w,7),F=F+k|0,O=ie(O^F,16),g=g+O|0,k=ie(k^g,12),F=F+k|0,O=ie(O^F,8),g=g+O|0,k=ie(k^g,7),U=U+E|0,B=ie(B^U,16),y=y+B|0,E=ie(E^y,12),U=U+E|0,B=ie(B^U,8),y=y+B|0,E=ie(E^y,7),A=A+p|0,T=ie(T^A,16),S=S+T|0,p=ie(p^S,12),A=A+p|0,T=ie(T^A,8),S=S+T|0,p=ie(p^S,7),$=$+k|0,T=ie(T^$,16),y=y+T|0,k=ie(k^y,12),$=$+k|0,T=ie(T^$,8),y=y+T|0,k=ie(k^y,7),F=F+E|0,I=ie(I^F,16),S=S+I|0,E=ie(E^S,12),F=F+E|0,I=ie(I^F,8),S=S+I|0,E=ie(E^S,7),U=U+p|0,O=ie(O^U,16),w=w+O|0,p=ie(p^w,12),U=U+p|0,O=ie(O^U,8),w=w+O|0,p=ie(p^w,7),A=A+q|0,B=ie(B^A,16),g=g+B|0,q=ie(q^g,12),A=A+q|0,B=ie(B^A,8),g=g+B|0,q=ie(q^g,7);let L=0;r[L++]=o+$|0,r[L++]=a+F|0,r[L++]=f+U|0,r[L++]=c+A|0,r[L++]=u+q|0,r[L++]=d+k|0,r[L++]=h+E|0,r[L++]=l+p|0,r[L++]=b+w|0,r[L++]=m+g|0,r[L++]=v+y|0,r[L++]=D+S|0,r[L++]=C+I|0,r[L++]=x+O|0,r[L++]=_+B|0,r[L++]=R+T|0}const K6=k6(V6,{counterRight:!1,counterLength:4,allowShortKeys:!1}),G6=new Uint8Array(16),_0=(e,t)=>{e.update(t);const n=t.length%16;n&&e.update(G6.subarray(n))},Z6=new Uint8Array(32);function x0(e,t,n,r,i){const s=e(t,n,Z6),o=H6.create(s);i&&_0(o,i),_0(o,r);const a=C6(r.length,i?i.length:0,!0);o.update(a);const f=o.digest();return $r(s,a),f}const Y6=e=>(t,n,r)=>({encrypt(i,s){const o=i.length;s=y0(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);e(t,n,a,a,1);const f=x0(e,t,n,a,r);return s.set(f,o),$r(f),s},decrypt(i,s){s=y0(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),f=x0(e,t,n,o,r);if(!R6(a,f))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),e(t,n,s,s,1),$r(f),s}}),S0=N6({blockSize:64,nonceLength:12,tagLength:16},Y6(K6));class I0 extends Hs{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,zs(t);const r=Dt(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?t.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=t.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),mt(s)}update(t){return On(this),this.iHash.update(t),this}digestInto(t){On(this),Bt(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return t=t,t.finished=i,t.destroyed=s,t.blockLen=o,t.outputLen=a,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Ks=(e,t,n)=>new I0(e,t).update(n).digest();Ks.create=(e,t)=>new I0(e,t);function W6(e,t,n){return zs(e),n===void 0&&(n=new Uint8Array(e.outputLen)),Ks(e,Dt(n),Dt(t))}const wc=Uint8Array.from([0]),O0=Uint8Array.of();function X6(e,t,n,r=32){zs(e),tn(r);const i=e.outputLen;if(r>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(r/i);n===void 0&&(n=O0);const o=new Uint8Array(s*i),a=Ks.create(e,t),f=a._cloneInto(),c=new Uint8Array(a.outputLen);for(let u=0;u<s;u++)wc[0]=u+1,f.update(u===0?O0:c).update(n).update(wc).digestInto(c),o.set(c,i*u),a._cloneInto(f);return a.destroy(),f.destroy(),mt(c,wc),o.slice(0,r)}const J6=(e,t,n,r,i)=>X6(e,W6(e,t,n),r,i),Gs=g0,Ec=BigInt(0),vc=BigInt(1);function Zs(e,t=""){if(typeof e!="boolean"){const n=t&&`"${t}"`;throw new Error(n+"expected boolean, got type="+typeof e)}return e}function nr(e,t,n=""){const r=ks(e),i=e?.length,s=t!==void 0;if(!r||s&&i!==t){const o=n&&`"${n}" `,a=s?` of length ${t}`:"",f=r?`length=${i}`:`type=${typeof e}`;throw new Error(o+"expected Uint8Array"+a+", got "+f)}return e}function Ys(e){const t=e.toString(16);return t.length&1?"0"+t:t}function B0(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?Ec:BigInt("0x"+e)}function Ws(e){return B0(Pr(e))}function Xs(e){return Bt(e),B0(Pr(Uint8Array.from(e).reverse()))}function _c(e,t){return qs(e.toString(16).padStart(t*2,"0"))}function xc(e,t){return _c(e,t).reverse()}function Le(e,t,n){let r;if(typeof t=="string")try{r=qs(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if(ks(t))r=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(e+" of length "+n+" expected, got "+i);return r}const Sc=e=>typeof e=="bigint"&&Ec<=e;function Q6(e,t,n){return Sc(e)&&Sc(t)&&Sc(n)&&t<=e&&e<n}function Ic(e,t,n,r){if(!Q6(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}function D0(e){let t;for(t=0;e>Ec;e>>=vc,t+=1);return t}const Ii=e=>(vc<<BigInt(e))-vc;function e4(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");const r=h=>new Uint8Array(h),i=h=>Uint8Array.of(h);let s=r(e),o=r(e),a=0;const f=()=>{s.fill(1),o.fill(0),a=0},c=(...h)=>n(o,s,...h),u=(h=r(0))=>{o=c(i(0),h),s=c(),h.length!==0&&(o=c(i(1),h),s=c())},d=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const l=[];for(;h<t;){s=c();const b=s.slice();l.push(b),h+=s.length}return Dn(...l)};return(h,l)=>{f(),u(h);let b;for(;!(b=l(d()));)u();return f(),b}}function Js(e,t,n={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function r(i,s,o){const a=e[i];if(o&&a===void 0)return;const f=typeof a;if(f!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${f}`)}Object.entries(t).forEach(([i,s])=>r(i,s,!1)),Object.entries(n).forEach(([i,s])=>r(i,s,!0))}function A0(e){const t=new WeakMap;return(n,...r)=>{const i=t.get(n);if(i!==void 0)return i;const s=e(n,...r);return t.set(n,s),s}}const tt=BigInt(0),He=BigInt(1),rr=BigInt(2),T0=BigInt(3),R0=BigInt(4),N0=BigInt(5),t4=BigInt(7),C0=BigInt(8),n4=BigInt(9),P0=BigInt(16);function ft(e,t){const n=e%t;return n>=tt?n:t+n}function At(e,t,n){let r=e;for(;t-- >tt;)r*=r,r%=n;return r}function $0(e,t){if(e===tt)throw new Error("invert: expected non-zero number");if(t<=tt)throw new Error("invert: expected positive modulus, got "+t);let n=ft(e,t),r=t,i=tt,s=He;for(;n!==tt;){const o=r/n,a=r%n,f=i-s*o;r=n,n=a,i=s,s=f}if(r!==He)throw new Error("invert: does not exist");return ft(i,t)}function Oc(e,t,n){if(!e.eql(e.sqr(t),n))throw new Error("Cannot find square root")}function L0(e,t){const n=(e.ORDER+He)/R0,r=e.pow(t,n);return Oc(e,r,t),r}function r4(e,t){const n=(e.ORDER-N0)/C0,r=e.mul(t,rr),i=e.pow(r,n),s=e.mul(t,i),o=e.mul(e.mul(s,rr),i),a=e.mul(s,e.sub(o,e.ONE));return Oc(e,a,t),a}function i4(e){const t=Ln(e),n=U0(e),r=n(t,t.neg(t.ONE)),i=n(t,r),s=n(t,t.neg(r)),o=(e+t4)/P0;return(a,f)=>{let c=a.pow(f,o),u=a.mul(c,r);const d=a.mul(c,i),h=a.mul(c,s),l=a.eql(a.sqr(u),f),b=a.eql(a.sqr(d),f);c=a.cmov(c,u,l),u=a.cmov(h,d,b);const m=a.eql(a.sqr(u),f),v=a.cmov(c,u,m);return Oc(a,v,f),v}}function U0(e){if(e<T0)throw new Error("sqrt is not defined for small field");let t=e-He,n=0;for(;t%rr===tt;)t/=rr,n++;let r=rr;const i=Ln(e);for(;j0(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return L0;let s=i.pow(r,t);const o=(t+He)/rr;return function(a,f){if(a.is0(f))return f;if(j0(a,f)!==1)throw new Error("Cannot find square root");let c=n,u=a.mul(a.ONE,s),d=a.pow(f,t),h=a.pow(f,o);for(;!a.eql(d,a.ONE);){if(a.is0(d))return a.ZERO;let l=1,b=a.sqr(d);for(;!a.eql(b,a.ONE);)if(l++,b=a.sqr(b),l===c)throw new Error("Cannot find square root");const m=He<<BigInt(c-l-1),v=a.pow(u,m);c=l,u=a.sqr(v),d=a.mul(d,u),h=a.mul(h,v)}return h}}function s4(e){return e%R0===T0?L0:e%C0===N0?r4:e%P0===n4?i4(e):U0(e)}const o4=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function a4(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=o4.reduce((r,i)=>(r[i]="function",r),t);return Js(e,n),e}function c4(e,t,n){if(n<tt)throw new Error("invalid exponent, negatives unsupported");if(n===tt)return e.ONE;if(n===He)return t;let r=e.ONE,i=t;for(;n>tt;)n&He&&(r=e.mul(r,i)),i=e.sqr(i),n>>=He;return r}function F0(e,t,n=!1){const r=new Array(t.length).fill(n?e.ZERO:void 0),i=t.reduce((o,a,f)=>e.is0(a)?o:(r[f]=o,e.mul(o,a)),e.ONE),s=e.inv(i);return t.reduceRight((o,a,f)=>e.is0(a)?o:(r[f]=e.mul(o,r[f]),e.mul(o,a)),s),r}function j0(e,t){const n=(e.ORDER-He)/rr,r=e.pow(t,n),i=e.eql(r,e.ONE),s=e.eql(r,e.ZERO),o=e.eql(r,e.neg(e.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function M0(e,t){t!==void 0&&tn(t);const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Ln(e,t,n=!1,r={}){if(e<=tt)throw new Error("invalid field: expected ORDER > 0, got "+e);let i,s,o=!1,a;if(typeof t=="object"&&t!=null){if(r.sqrt||n)throw new Error("cannot specify opts in two arguments");const h=t;h.BITS&&(i=h.BITS),h.sqrt&&(s=h.sqrt),typeof h.isLE=="boolean"&&(n=h.isLE),typeof h.modFromBytes=="boolean"&&(o=h.modFromBytes),a=h.allowedLengths}else typeof t=="number"&&(i=t),r.sqrt&&(s=r.sqrt);const{nBitLength:f,nByteLength:c}=M0(e,i);if(c>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const d=Object.freeze({ORDER:e,isLE:n,BITS:f,BYTES:c,MASK:Ii(f),ZERO:tt,ONE:He,allowedLengths:a,create:h=>ft(h,e),isValid:h=>{if(typeof h!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof h);return tt<=h&&h<e},is0:h=>h===tt,isValidNot0:h=>!d.is0(h)&&d.isValid(h),isOdd:h=>(h&He)===He,neg:h=>ft(-h,e),eql:(h,l)=>h===l,sqr:h=>ft(h*h,e),add:(h,l)=>ft(h+l,e),sub:(h,l)=>ft(h-l,e),mul:(h,l)=>ft(h*l,e),pow:(h,l)=>c4(d,h,l),div:(h,l)=>ft(h*$0(l,e),e),sqrN:h=>h*h,addN:(h,l)=>h+l,subN:(h,l)=>h-l,mulN:(h,l)=>h*l,inv:h=>$0(h,e),sqrt:s||(h=>(u||(u=s4(e)),u(d,h))),toBytes:h=>n?xc(h,c):_c(h,c),fromBytes:(h,l=!0)=>{if(a){if(!a.includes(h.length)||h.length>c)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+h.length);const m=new Uint8Array(c);m.set(h,n?0:m.length-h.length),h=m}if(h.length!==c)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+h.length);let b=n?Xs(h):Ws(h);if(o&&(b=ft(b,e)),!l&&!d.isValid(b))throw new Error("invalid field element: outside of range 0..ORDER");return b},invertBatch:h=>F0(d,h),cmov:(h,l,b)=>b?l:h});return Object.freeze(d)}function k0(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function z0(e){const t=k0(e);return t+Math.ceil(t/2)}function f4(e,t,n=!1){const r=e.length,i=k0(t),s=z0(t);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=n?Xs(e):Ws(e),a=ft(o,t-He)+He;return n?xc(a,i):_c(a,i)}const Lr=BigInt(0),ir=BigInt(1);function Qs(e,t){const n=t.negate();return e?n:t}function Bc(e,t){const n=F0(e.Fp,t.map(r=>r.Z));return t.map((r,i)=>e.fromAffine(r.toAffine(n[i])))}function q0(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Dc(e,t){q0(e,t);const n=Math.ceil(t/e)+1,r=2**(e-1),i=2**e,s=Ii(e),o=BigInt(e);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function H0(e,t,n){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n;let a=Number(e&i),f=e>>o;a>r&&(a-=s,f+=ir);const c=t*r,u=c+Math.abs(a)-1,d=a===0,h=a<0,l=t%2!==0;return{nextN:f,offset:u,isZero:d,isNeg:h,isNegF:l,offsetF:c}}function u4(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((n,r)=>{if(!(n instanceof t))throw new Error("invalid point at index "+r)})}function l4(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((n,r)=>{if(!t.isValid(n))throw new Error("invalid scalar at index "+r)})}const Ac=new WeakMap,V0=new WeakMap;function Tc(e){return V0.get(e)||1}function K0(e){if(e!==Lr)throw new Error("invalid wNAF")}class h4{constructor(t,n){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=n}_unsafeLadder(t,n,r=this.ZERO){let i=t;for(;n>Lr;)n&ir&&(r=r.add(i)),i=i.double(),n>>=ir;return r}precomputeWindow(t,n){const{windows:r,windowSize:i}=Dc(n,this.bits),s=[];let o=t,a=o;for(let f=0;f<r;f++){a=o,s.push(a);for(let c=1;c<i;c++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(t,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=Dc(t,this.bits);for(let a=0;a<o.windows;a++){const{nextN:f,offset:c,isZero:u,isNeg:d,isNegF:h,offsetF:l}=H0(r,a,o);r=f,u?s=s.add(Qs(h,n[l])):i=i.add(Qs(d,n[c]))}return K0(r),{p:i,f:s}}wNAFUnsafe(t,n,r,i=this.ZERO){const s=Dc(t,this.bits);for(let o=0;o<s.windows&&r!==Lr;o++){const{nextN:a,offset:f,isZero:c,isNeg:u}=H0(r,o,s);if(r=a,!c){const d=n[f];i=i.add(u?d.negate():d)}}return K0(r),i}getPrecomputes(t,n,r){let i=Ac.get(n);return i||(i=this.precomputeWindow(n,t),t!==1&&(typeof r=="function"&&(i=r(i)),Ac.set(n,i))),i}cached(t,n,r){const i=Tc(t);return this.wNAF(i,this.getPrecomputes(i,t,r),n)}unsafe(t,n,r,i){const s=Tc(t);return s===1?this._unsafeLadder(t,n,i):this.wNAFUnsafe(s,this.getPrecomputes(s,t,r),n,i)}createCache(t,n){q0(n,this.bits),V0.set(t,n),Ac.delete(t)}hasCache(t){return Tc(t)!==1}}function d4(e,t,n,r){let i=t,s=e.ZERO,o=e.ZERO;for(;n>Lr||r>Lr;)n&ir&&(s=s.add(i)),r&ir&&(o=o.add(i)),i=i.double(),n>>=ir,r>>=ir;return{p1:s,p2:o}}function g4(e,t,n,r){u4(n,e),l4(r,t);const i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=e.ZERO,a=D0(BigInt(i));let f=1;a>12?f=a-3:a>4?f=a-2:a>0&&(f=2);const c=Ii(f),u=new Array(Number(c)+1).fill(o),d=Math.floor((t.BITS-1)/f)*f;let h=o;for(let l=d;l>=0;l-=f){u.fill(o);for(let m=0;m<s;m++){const v=r[m],D=Number(v>>BigInt(l)&c);u[D]=u[D].add(n[m])}let b=o;for(let m=u.length-1,v=o;m>0;m--)v=v.add(u[m]),b=b.add(v);if(h=h.add(b),l!==0)for(let m=0;m<f;m++)h=h.double()}return h}function G0(e,t,n){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return a4(t),t}else return Ln(e,{isLE:n})}function p4(e,t,n={},r){if(r===void 0&&(r=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(const a of["p","n","h"]){const f=t[a];if(!(typeof f=="bigint"&&f>Lr))throw new Error(`CURVE.${a} must be positive bigint`)}const i=G0(t.p,n.Fp,r),s=G0(t.n,n.Fn,r),o=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(const a of o)if(!i.isValid(t[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:i,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),s0("HashToScalar-");const Oi=BigInt(0),Ur=BigInt(1),eo=BigInt(2);function b4(e){return Js(e,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze(Nr({},e))}function y4(e){const t=b4(e),{P:n,type:r,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=t,a=r==="x25519";if(!a&&r!=="x448")throw new Error("invalid type");const f=o||tr,c=a?255:448,u=a?32:56,d=BigInt(a?9:5),h=BigInt(a?121665:39081),l=a?eo**BigInt(254):eo**BigInt(447),b=a?BigInt(8)*eo**BigInt(251)-Ur:BigInt(4)*eo**BigInt(445)-Ur,m=l+b+Ur,v=E=>ft(E,n),D=C(d);function C(E){return xc(v(E),u)}function x(E){const p=Le("u coordinate",E,u);return a&&(p[31]&=127),v(Xs(p))}function _(E){return Xs(i(Le("scalar",E,u)))}function R(E,p){const w=U(x(p),_(E));if(w===Oi)throw new Error("invalid private or public key received");return C(w)}function $(E){return R(E,D)}function F(E,p,w){const g=v(E*(p-w));return p=v(p-g),w=v(w+g),{x_2:p,x_3:w}}function U(E,p){Ic("u",E,Oi,n),Ic("scalar",p,l,m);const w=p,g=E;let y=Ur,S=Oi,I=E,O=Ur,B=Oi;for(let L=BigInt(c-1);L>=Oi;L--){const P=w>>L&Ur;B^=P,{x_2:y,x_3:I}=F(B,y,I),{x_2:S,x_3:O}=F(B,S,O),B=P;const j=y+S,N=v(j*j),M=y-S,z=v(M*M),G=N-z,H=I+O,K=I-O,J=v(K*j),ee=v(H*M),re=J+ee,he=J-ee;I=v(re*re),O=v(g*v(he*he)),y=v(N*z),S=v(G*(N+v(h*G)))}({x_2:y,x_3:I}=F(B,y,I)),{x_2:S,x_3:O}=F(B,S,O);const T=s(S);return v(y*T)}const A={secretKey:u,publicKey:u,seed:u},q=(E=f(u))=>(Bt(E,A.seed),E);function k(E){const p=q(E);return{secretKey:p,publicKey:$(p)}}return{keygen:k,getSharedSecret:(E,p)=>R(E,p),getPublicKey:E=>$(E),scalarMult:R,scalarMultBase:$,utils:{randomSecretKey:q,randomPrivateKey:q},GuBytes:D.slice(),lengths:A}}const m4=BigInt(1),Z0=BigInt(2),w4=BigInt(3),E4=BigInt(5),v4=BigInt(8),Y0=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),_4={p:Y0,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:v4,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function x4(e){const t=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),s=Y0,o=e*e%s*e%s,a=At(o,Z0,s)*o%s,f=At(a,m4,s)*e%s,c=At(f,E4,s)*f%s,u=At(c,t,s)*c%s,d=At(u,n,s)*u%s,h=At(d,r,s)*d%s,l=At(h,i,s)*h%s,b=At(l,i,s)*h%s,m=At(b,t,s)*c%s;return{pow_p_5_8:At(m,Z0,s)*e%s,b2:o}}function S4(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}const I4=Ln(_4.p,{isLE:!0}),Rc=(()=>{const e=I4.ORDER;return y4({P:e,type:"x25519",powPminus2:t=>{const{pow_p_5_8:n,b2:r}=x4(t);return ft(At(n,w4,e)*r,e)},adjustScalarBytes:S4})})(),W0=(e,t)=>(e+(e>=0?t:-t)/X0)/t;function O4(e,t,n){const[[r,i],[s,o]]=t,a=W0(o*e,n),f=W0(-i*e,n);let c=e-a*r-f*s,u=-a*i-f*o;const d=c<on,h=u<on;d&&(c=-c),h&&(u=-u);const l=Ii(Math.ceil(D0(n)/2))+Fr;if(c<on||c>=l||u<on||u>=l)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:d,k1:c,k2neg:h,k2:u}}function Nc(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function Cc(e,t){const n={};for(let r of Object.keys(t))n[r]=e[r]===void 0?t[r]:e[r];return Zs(n.lowS,"lowS"),Zs(n.prehash,"prehash"),n.format!==void 0&&Nc(n.format),n}class B4 extends Error{constructor(t=""){super(t)}}const sn={Err:B4,_tlv:{encode:(e,t)=>{const{Err:n}=sn;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length&1)throw new n("tlv.encode: unpadded data");const r=t.length/2,i=Ys(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?Ys(i.length/2|128):"";return Ys(e)+s+i+t},decode(e,t){const{Err:n}=sn;let r=0;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length<2||t[r++]!==e)throw new n("tlv.decode: wrong tlv");const i=t[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const f=i&127;if(!f)throw new n("tlv.decode(long): indefinite length not supported");if(f>4)throw new n("tlv.decode(long): byte length is too big");const c=t.subarray(r,r+f);if(c.length!==f)throw new n("tlv.decode: length bytes not complete");if(c[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const u of c)o=o<<8|u;if(r+=f,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=t.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:t.subarray(r+o)}}},_int:{encode(e){const{Err:t}=sn;if(e<on)throw new t("integer: negative integers are not allowed");let n=Ys(e);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return n},decode(e){const{Err:t}=sn;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return Ws(e)}},toSig(e){const{Err:t,_int:n,_tlv:r}=sn,i=Le("signature",e),{v:s,l:o}=r.decode(48,i);if(o.length)throw new t("invalid signature: left bytes after parsing");const{v:a,l:f}=r.decode(2,s),{v:c,l:u}=r.decode(2,f);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(c)}},hexFromSig(e){const{_tlv:t,_int:n}=sn,r=t.encode(2,n.encode(e.r)),i=t.encode(2,n.encode(e.s)),s=r+i;return t.encode(48,s)}},on=BigInt(0),Fr=BigInt(1),X0=BigInt(2),to=BigInt(3),D4=BigInt(4);function jr(e,t){const{BYTES:n}=e;let r;if(typeof t=="bigint")r=t;else{let i=Le("private key",t);try{r=e.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof t}`)}}if(!e.isValidNot0(r))throw new Error("invalid private key: out of range [1..N-1]");return r}function A4(e,t={}){const n=p4("weierstrass",e,t),{Fp:r,Fn:i}=n;let s=n.CURVE;const{h:o,n:a}=s;Js(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:f}=t;if(f&&(!r.is0(s.a)||typeof f.beta!="bigint"||!Array.isArray(f.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const c=Q0(r,i);function u(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function d(E,p,w){const{x:g,y}=p.toAffine(),S=r.toBytes(g);if(Zs(w,"isCompressed"),w){u();const I=!r.isOdd(y);return Dn(J0(I),S)}else return Dn(Uint8Array.of(4),S,r.toBytes(y))}function h(E){nr(E,void 0,"Point");const{publicKey:p,publicKeyUncompressed:w}=c,g=E.length,y=E[0],S=E.subarray(1);if(g===p&&(y===2||y===3)){const I=r.fromBytes(S);if(!r.isValid(I))throw new Error("bad point: is not on curve, wrong x");const O=m(I);let B;try{B=r.sqrt(O)}catch(L){const P=L instanceof Error?": "+L.message:"";throw new Error("bad point: is not on curve, sqrt error"+P)}u();const T=r.isOdd(B);return(y&1)===1!==T&&(B=r.neg(B)),{x:I,y:B}}else if(g===w&&y===4){const I=r.BYTES,O=r.fromBytes(S.subarray(0,I)),B=r.fromBytes(S.subarray(I,I*2));if(!v(O,B))throw new Error("bad point: is not on curve");return{x:O,y:B}}else throw new Error(`bad point: got length ${g}, expected compressed=${p} or uncompressed=${w}`)}const l=t.toBytes||d,b=t.fromBytes||h;function m(E){const p=r.sqr(E),w=r.mul(p,E);return r.add(r.add(w,r.mul(E,s.a)),s.b)}function v(E,p){const w=r.sqr(p),g=m(E);return r.eql(w,g)}if(!v(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const D=r.mul(r.pow(s.a,to),D4),C=r.mul(r.sqr(s.b),BigInt(27));if(r.is0(r.add(D,C)))throw new Error("bad curve params: a or b");function x(E,p,w=!1){if(!r.isValid(p)||w&&r.is0(p))throw new Error(`bad point coordinate ${E}`);return p}function _(E){if(!(E instanceof A))throw new Error("ProjectivePoint expected")}function R(E){if(!f||!f.basises)throw new Error("no endo");return O4(E,f.basises,i.ORDER)}const $=A0((E,p)=>{const{X:w,Y:g,Z:y}=E;if(r.eql(y,r.ONE))return{x:w,y:g};const S=E.is0();p==null&&(p=S?r.ONE:r.inv(y));const I=r.mul(w,p),O=r.mul(g,p),B=r.mul(y,p);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(B,r.ONE))throw new Error("invZ was invalid");return{x:I,y:O}}),F=A0(E=>{if(E.is0()){if(t.allowInfinityPoint&&!r.is0(E.Y))return;throw new Error("bad point: ZERO")}const{x:p,y:w}=E.toAffine();if(!r.isValid(p)||!r.isValid(w))throw new Error("bad point: x or y not field elements");if(!v(p,w))throw new Error("bad point: equation left != right");if(!E.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function U(E,p,w,g,y){return w=new A(r.mul(w.X,E),w.Y,w.Z),p=Qs(g,p),w=Qs(y,w),p.add(w)}class A{constructor(p,w,g){this.X=x("x",p),this.Y=x("y",w,!0),this.Z=x("z",g),Object.freeze(this)}static CURVE(){return s}static fromAffine(p){const{x:w,y:g}=p||{};if(!p||!r.isValid(w)||!r.isValid(g))throw new Error("invalid affine point");if(p instanceof A)throw new Error("projective point not allowed");return r.is0(w)&&r.is0(g)?A.ZERO:new A(w,g,r.ONE)}static fromBytes(p){const w=A.fromAffine(b(nr(p,void 0,"point")));return w.assertValidity(),w}static fromHex(p){return A.fromBytes(Le("pointHex",p))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(p=8,w=!0){return k.createCache(this,p),w||this.multiply(to),this}assertValidity(){F(this)}hasEvenY(){const{y:p}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(p)}equals(p){_(p);const{X:w,Y:g,Z:y}=this,{X:S,Y:I,Z:O}=p,B=r.eql(r.mul(w,O),r.mul(S,y)),T=r.eql(r.mul(g,O),r.mul(I,y));return B&&T}negate(){return new A(this.X,r.neg(this.Y),this.Z)}double(){const{a:p,b:w}=s,g=r.mul(w,to),{X:y,Y:S,Z:I}=this;let O=r.ZERO,B=r.ZERO,T=r.ZERO,L=r.mul(y,y),P=r.mul(S,S),j=r.mul(I,I),N=r.mul(y,S);return N=r.add(N,N),T=r.mul(y,I),T=r.add(T,T),O=r.mul(p,T),B=r.mul(g,j),B=r.add(O,B),O=r.sub(P,B),B=r.add(P,B),B=r.mul(O,B),O=r.mul(N,O),T=r.mul(g,T),j=r.mul(p,j),N=r.sub(L,j),N=r.mul(p,N),N=r.add(N,T),T=r.add(L,L),L=r.add(T,L),L=r.add(L,j),L=r.mul(L,N),B=r.add(B,L),j=r.mul(S,I),j=r.add(j,j),L=r.mul(j,N),O=r.sub(O,L),T=r.mul(j,P),T=r.add(T,T),T=r.add(T,T),new A(O,B,T)}add(p){_(p);const{X:w,Y:g,Z:y}=this,{X:S,Y:I,Z:O}=p;let B=r.ZERO,T=r.ZERO,L=r.ZERO;const P=s.a,j=r.mul(s.b,to);let N=r.mul(w,S),M=r.mul(g,I),z=r.mul(y,O),G=r.add(w,g),H=r.add(S,I);G=r.mul(G,H),H=r.add(N,M),G=r.sub(G,H),H=r.add(w,y);let K=r.add(S,O);return H=r.mul(H,K),K=r.add(N,z),H=r.sub(H,K),K=r.add(g,y),B=r.add(I,O),K=r.mul(K,B),B=r.add(M,z),K=r.sub(K,B),L=r.mul(P,H),B=r.mul(j,z),L=r.add(B,L),B=r.sub(M,L),L=r.add(M,L),T=r.mul(B,L),M=r.add(N,N),M=r.add(M,N),z=r.mul(P,z),H=r.mul(j,H),M=r.add(M,z),z=r.sub(N,z),z=r.mul(P,z),H=r.add(H,z),N=r.mul(M,H),T=r.add(T,N),N=r.mul(K,H),B=r.mul(G,B),B=r.sub(B,N),N=r.mul(G,M),L=r.mul(K,L),L=r.add(L,N),new A(B,T,L)}subtract(p){return this.add(p.negate())}is0(){return this.equals(A.ZERO)}multiply(p){const{endo:w}=t;if(!i.isValidNot0(p))throw new Error("invalid scalar: out of range");let g,y;const S=I=>k.cached(this,I,O=>Bc(A,O));if(w){const{k1neg:I,k1:O,k2neg:B,k2:T}=R(p),{p:L,f:P}=S(O),{p:j,f:N}=S(T);y=P.add(N),g=U(w.beta,L,j,I,B)}else{const{p:I,f:O}=S(p);g=I,y=O}return Bc(A,[g,y])[0]}multiplyUnsafe(p){const{endo:w}=t,g=this;if(!i.isValid(p))throw new Error("invalid scalar: out of range");if(p===on||g.is0())return A.ZERO;if(p===Fr)return g;if(k.hasCache(this))return this.multiply(p);if(w){const{k1neg:y,k1:S,k2neg:I,k2:O}=R(p),{p1:B,p2:T}=d4(A,g,S,O);return U(w.beta,B,T,y,I)}else return k.unsafe(g,p)}multiplyAndAddUnsafe(p,w,g){const y=this.multiplyUnsafe(w).add(p.multiplyUnsafe(g));return y.is0()?void 0:y}toAffine(p){return $(this,p)}isTorsionFree(){const{isTorsionFree:p}=t;return o===Fr?!0:p?p(A,this):k.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:p}=t;return o===Fr?this:p?p(A,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(p=!0){return Zs(p,"isCompressed"),this.assertValidity(),l(A,this,p)}toHex(p=!0){return Pr(this.toBytes(p))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(p=!0){return this.toBytes(p)}_setWindowSize(p){this.precompute(p)}static normalizeZ(p){return Bc(A,p)}static msm(p,w){return g4(A,i,p,w)}static fromPrivateKey(p){return A.BASE.multiply(jr(i,p))}}A.BASE=new A(s.Gx,s.Gy,r.ONE),A.ZERO=new A(r.ZERO,r.ONE,r.ZERO),A.Fp=r,A.Fn=i;const q=i.BITS,k=new h4(A,t.endo?Math.ceil(q/2):q);return A.BASE.precompute(8),A}function J0(e){return Uint8Array.of(e?2:3)}function Q0(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function T4(e,t={}){const{Fn:n}=e,r=t.randomBytes||tr,i=Object.assign(Q0(e.Fp,n),{seed:z0(n.ORDER)});function s(h){try{return!!jr(n,h)}catch{return!1}}function o(h,l){const{publicKey:b,publicKeyUncompressed:m}=i;try{const v=h.length;return l===!0&&v!==b||l===!1&&v!==m?!1:!!e.fromBytes(h)}catch{return!1}}function a(h=r(i.seed)){return f4(nr(h,i.seed,"seed"),n.ORDER)}function f(h,l=!0){return e.BASE.multiply(jr(n,h)).toBytes(l)}function c(h){const l=a(h);return{secretKey:l,publicKey:f(l)}}function u(h){if(typeof h=="bigint")return!1;if(h instanceof e)return!0;const{secretKey:l,publicKey:b,publicKeyUncompressed:m}=i;if(n.allowedLengths||l===b)return;const v=Le("key",h).length;return v===b||v===m}function d(h,l,b=!0){if(u(h)===!0)throw new Error("first arg must be private key");if(u(l)===!1)throw new Error("second arg must be public key");const m=jr(n,h);return e.fromHex(l).multiply(m).toBytes(b)}return Object.freeze({getPublicKey:f,getSharedSecret:d,keygen:c,Point:e,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:h=>jr(n,h),precompute(h=8,l=e.BASE){return l.precompute(h,!1)}},lengths:i})}function R4(e,t,n={}){zs(t),Js(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const r=n.randomBytes||tr,i=n.hmac||((w,...g)=>Ks(t,w,Dn(...g))),{Fp:s,Fn:o}=e,{ORDER:a,BITS:f}=o,{keygen:c,getPublicKey:u,getSharedSecret:d,utils:h,lengths:l}=T4(e,n),b={prehash:!1,lowS:typeof n.lowS=="boolean"?n.lowS:!1,format:void 0,extraEntropy:!1},m="compact";function v(w){const g=a>>Fr;return w>g}function D(w,g){if(!o.isValidNot0(g))throw new Error(`invalid signature ${w}: out of range 1..Point.Fn.ORDER`);return g}function C(w,g){Nc(g);const y=l.signature,S=g==="compact"?y:g==="recovered"?y+1:void 0;return nr(w,S,`${g} signature`)}class x{constructor(g,y,S){this.r=D("r",g),this.s=D("s",y),S!=null&&(this.recovery=S),Object.freeze(this)}static fromBytes(g,y=m){C(g,y);let S;if(y==="der"){const{r:T,s:L}=sn.toSig(nr(g));return new x(T,L)}y==="recovered"&&(S=g[0],y="compact",g=g.subarray(1));const I=o.BYTES,O=g.subarray(0,I),B=g.subarray(I,I*2);return new x(o.fromBytes(O),o.fromBytes(B),S)}static fromHex(g,y){return this.fromBytes(qs(g),y)}addRecoveryBit(g){return new x(this.r,this.s,g)}recoverPublicKey(g){const y=s.ORDER,{r:S,s:I,recovery:O}=this;if(O==null||![0,1,2,3].includes(O))throw new Error("recovery id invalid");if(a*X0<y&&O>1)throw new Error("recovery id is ambiguous for h>1 curve");const B=O===2||O===3?S+a:S;if(!s.isValid(B))throw new Error("recovery id 2 or 3 invalid");const T=s.toBytes(B),L=e.fromBytes(Dn(J0((O&1)===0),T)),P=o.inv(B),j=R(Le("msgHash",g)),N=o.create(-j*P),M=o.create(I*P),z=e.BASE.multiplyUnsafe(N).add(L.multiplyUnsafe(M));if(z.is0())throw new Error("point at infinify");return z.assertValidity(),z}hasHighS(){return v(this.s)}toBytes(g=m){if(Nc(g),g==="der")return qs(sn.hexFromSig(this));const y=o.toBytes(this.r),S=o.toBytes(this.s);if(g==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Dn(Uint8Array.of(this.recovery),y,S)}return Dn(y,S)}toHex(g){return Pr(this.toBytes(g))}assertValidity(){}static fromCompact(g){return x.fromBytes(Le("sig",g),"compact")}static fromDER(g){return x.fromBytes(Le("sig",g),"der")}normalizeS(){return this.hasHighS()?new x(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Pr(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Pr(this.toBytes("compact"))}}const _=n.bits2int||function(w){if(w.length>8192)throw new Error("input is too large");const g=Ws(w),y=w.length*8-f;return y>0?g>>BigInt(y):g},R=n.bits2int_modN||function(w){return o.create(_(w))},$=Ii(f);function F(w){return Ic("num < 2^"+f,w,on,$),o.toBytes(w)}function U(w,g){return nr(w,void 0,"message"),g?nr(t(w),void 0,"prehashed message"):w}function A(w,g,y){if(["recovered","canonical"].some(M=>M in y))throw new Error("sign() legacy options not supported");const{lowS:S,prehash:I,extraEntropy:O}=Cc(y,b);w=U(w,I);const B=R(w),T=jr(o,g),L=[F(T),F(B)];if(O!=null&&O!==!1){const M=O===!0?r(l.secretKey):O;L.push(Le("extraEntropy",M))}const P=Dn(...L),j=B;function N(M){const z=_(M);if(!o.isValidNot0(z))return;const G=o.inv(z),H=e.BASE.multiply(z).toAffine(),K=o.create(H.x);if(K===on)return;const J=o.create(G*o.create(j+K*T));if(J===on)return;let ee=(H.x===K?0:2)|Number(H.y&Fr),re=J;return S&&v(J)&&(re=o.neg(J),ee^=1),new x(K,re,ee)}return{seed:P,k2sig:N}}function q(w,g,y={}){w=Le("message",w);const{seed:S,k2sig:I}=A(w,g,y);return e4(t.outputLen,o.BYTES,i)(S,I)}function k(w){let g;const y=typeof w=="string"||ks(w),S=!y&&w!==null&&typeof w=="object"&&typeof w.r=="bigint"&&typeof w.s=="bigint";if(!y&&!S)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(S)g=new x(w.r,w.s);else if(y){try{g=x.fromBytes(Le("sig",w),"der")}catch(I){if(!(I instanceof sn.Err))throw I}if(!g)try{g=x.fromBytes(Le("sig",w),"compact")}catch{return!1}}return g||!1}function E(w,g,y,S={}){const{lowS:I,prehash:O,format:B}=Cc(S,b);if(y=Le("publicKey",y),g=U(Le("message",g),O),"strict"in S)throw new Error("options.strict was renamed to lowS");const T=B===void 0?k(w):x.fromBytes(Le("sig",w),B);if(T===!1)return!1;try{const L=e.fromBytes(y);if(I&&T.hasHighS())return!1;const{r:P,s:j}=T,N=R(g),M=o.inv(j),z=o.create(N*M),G=o.create(P*M),H=e.BASE.multiplyUnsafe(z).add(L.multiplyUnsafe(G));return H.is0()?!1:o.create(H.x)===P}catch{return!1}}function p(w,g,y={}){const{prehash:S}=Cc(y,b);return g=U(g,S),x.fromBytes(w,"recovered").recoverPublicKey(g).toBytes()}return Object.freeze({keygen:c,getPublicKey:u,getSharedSecret:d,utils:h,lengths:l,Point:e,sign:q,verify:E,recoverPublicKey:p,Signature:x,hash:t})}function N4(e){const t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},n=e.Fp;let r=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=Ln(t.n,{BITS:e.nBitLength,allowedLengths:r,modFromBytes:e.wrapPrivateKey}),s={Fp:n,Fn:i,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes};return{CURVE:t,curveOpts:s}}function C4(e){const{CURVE:t,curveOpts:n}=N4(e),r={hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN};return{CURVE:t,curveOpts:n,hash:e.hash,ecdsaOpts:r}}function P4(e,t){const n=t.Point;return Object.assign({},t,{ProjectivePoint:n,CURVE:Object.assign({},e,M0(n.Fn.ORDER,n.Fn.BITS))})}function $4(e){const{CURVE:t,curveOpts:n,hash:r,ecdsaOpts:i}=C4(e),s=A4(t,n),o=R4(s,r,i);return P4(e,o)}function Pc(e,t){const n=r=>$4(yi(Nr({},e),{hash:r}));return yi(Nr({},n(t)),{create:n})}const eg={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},tg={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},ng={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},L4=Ln(eg.p),U4=Ln(tg.p),F4=Ln(ng.p),j4=Pc(yi(Nr({},eg),{Fp:L4,lowS:!1}),g0);Pc(yi(Nr({},tg),{Fp:U4,lowS:!1}),v6),Pc(yi(Nr({},ng),{Fp:F4,lowS:!1,allowedPrivateKeyLengths:[130,131,132]}),E6);const M4=j4,rg="base10",Ve="base16",sr="base64pad",$c="base64url",Bi="utf8",ig=0,Mr=1,no=2,k4=0,sg=1,Di=12,Lc=32;function z4(){const e=Rc.utils.randomPrivateKey(),t=Rc.getPublicKey(e);return{privateKey:Qe(e,Ve),publicKey:Qe(t,Ve)}}function Uc(){const e=tr(Lc);return Qe(e,Ve)}function q4(e,t){const n=Rc.getSharedSecret(ot(e,Ve),ot(t,Ve)),r=J6(Gs,n,void 0,void 0,Lc);return Qe(r,Ve)}function H4(e){const t=Gs(ot(e,Ve));return Qe(t,Ve)}function ro(e){const t=Gs(ot(e,Bi));return Qe(t,Ve)}function og(e){return ot(`${e}`,rg)}function or(e){return Number(Qe(e,rg))}function ag(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function cg(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n=(4-t.length%4)%4;return t+"=".repeat(n)}function V4(e){const t=og(typeof e.type<"u"?e.type:ig);if(or(t)===Mr&&typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const n=typeof e.senderPublicKey<"u"?ot(e.senderPublicKey,Ve):void 0,r=typeof e.iv<"u"?ot(e.iv,Ve):tr(Di),i=ot(e.symKey,Ve),s=S0(i,r).encrypt(ot(e.message,Bi)),o=fg({type:t,sealed:s,iv:r,senderPublicKey:n});return e.encoding===$c?ag(o):o}function K4(e){const t=ot(e.symKey,Ve),{sealed:n,iv:r}=Ai({encoded:e.encoded,encoding:e.encoding}),i=S0(t,r).decrypt(n);if(i===null)throw new Error("Failed to decrypt");return Qe(i,Bi)}function G4(e,t){const n=og(no),r=tr(Di),i=ot(e,Bi),s=fg({type:n,sealed:i,iv:r});return t===$c?ag(s):s}function Z4(e,t){const{sealed:n}=Ai({encoded:e,encoding:t});return Qe(n,Bi)}function fg(e){if(or(e.type)===no)return Qe(bi([e.type,e.sealed]),sr);if(or(e.type)===Mr){if(typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Qe(bi([e.type,e.senderPublicKey,e.iv,e.sealed]),sr)}return Qe(bi([e.type,e.iv,e.sealed]),sr)}function Ai(e){const t=(e.encoding||sr)===$c?cg(e.encoded):e.encoded,n=ot(t,sr),r=n.slice(k4,sg),i=sg;if(or(r)===Mr){const f=i+Lc,c=f+Di,u=n.slice(i,f),d=n.slice(f,c),h=n.slice(c);return{type:r,sealed:h,iv:d,senderPublicKey:u}}if(or(r)===no){const f=n.slice(i),c=tr(Di);return{type:r,sealed:f,iv:c}}const s=i+Di,o=n.slice(i,s),a=n.slice(s);return{type:r,sealed:a,iv:o}}function Y4(e,t){const n=Ai({encoded:e,encoding:t?.encoding});return ug({type:or(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?Qe(n.senderPublicKey,Ve):void 0,receiverPublicKey:t?.receiverPublicKey})}function ug(e){const t=e?.type||ig;if(t===Mr){if(typeof e?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof e?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:e?.senderPublicKey,receiverPublicKey:e?.receiverPublicKey}}function lg(e){return e.type===Mr&&typeof e.senderPublicKey=="string"&&typeof e.receiverPublicKey=="string"}function hg(e){return e.type===no}function W4(e){const t=Buffer.from(e.x,"base64"),n=Buffer.from(e.y,"base64");return bi([new Uint8Array([4]),t,n])}function X4(e,t){const[n,r,i]=e.split("."),s=Buffer.from(cg(i),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),f=`${n}.${r}`,c=Gs(f),u=W4(t);if(!M4.verify(bi([o,a]),c,u))throw new Error("Invalid signature");return Jo(e).payload}const J4="irn";function io(e){return e?.relay||{protocol:J4}}function kr(e){const t=S8[e];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${e}`);return t}var Q4=Object.defineProperty,e_=Object.defineProperties,t_=Object.getOwnPropertyDescriptors,dg=Object.getOwnPropertySymbols,n_=Object.prototype.hasOwnProperty,r_=Object.prototype.propertyIsEnumerable,gg=(e,t,n)=>t in e?Q4(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Fc=(e,t)=>{for(var n in t||(t={}))n_.call(t,n)&&gg(e,n,t[n]);if(dg)for(var n of dg(t))r_.call(t,n)&&gg(e,n,t[n]);return e},i_=(e,t)=>e_(e,t_(t));function s_(e,t="-"){const n={},r="relay"+t;return Object.keys(e).forEach(i=>{if(i.startsWith(r)){const s=i.replace(r,""),o=e[i];n[s]=o}}),n}function pg(e){if(!e.includes("wc:")){const c=Yd(e);c!=null&&c.includes("wc:")&&(e=c)}e=e.includes("wc://")?e.replace("wc://",""):e,e=e.includes("wc:")?e.replace("wc:",""):e;const t=e.indexOf(":"),n=e.indexOf("?")!==-1?e.indexOf("?"):void 0,r=e.substring(0,t),i=e.substring(t+1,n).split("@"),s=typeof n<"u"?e.substring(n):"",o=new URLSearchParams(s),a=Object.fromEntries(o.entries()),f=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:r,topic:o_(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:s_(a),methods:f,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function o_(e){return e.startsWith("//")?e.substring(2):e}function a_(e,t="-"){const n="relay",r={};return Object.keys(e).forEach(i=>{const s=i,o=n+t+s;e[s]&&(r[o]=e[s])}),r}function bg(e){const t=new URLSearchParams,n=Fc(Fc(i_(Fc({},a_(e.relay)),{symKey:e.symKey}),e.expiryTimestamp&&{expiryTimestamp:e.expiryTimestamp.toString()}),e.methods&&{methods:e.methods.join(",")});return Object.entries(n).sort(([r],[i])=>r.localeCompare(i)).forEach(([r,i])=>{i!==void 0&&t.append(r,String(i))}),`${e.protocol}:${e.topic}@${e.version}?${t}`}const c_={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},f_={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function oe(e,t){const{message:n,code:r}=f_[e];return{message:t?`${n} ${t}`:n,code:r}}function Ti(e,t){const{message:n,code:r}=c_[e];return{message:t?`${n} ${t}`:n,code:r}}function zr(e){return typeof e>"u"}function yg(e,t){return t&&zr(e)?!0:typeof e=="string"&&!!e.trim().length}function u_(e){function t(n){try{return typeof new URL(n)<"u"}catch{return!1}}try{if(yg(e,!1)){if(t(e))return!0;const n=Yd(e);return t(n)}}catch{}return!1}function l_(e){var t;return(t=e?.proposer)==null?void 0:t.publicKey}function h_(e){return e?.topic}function jc(e){return typeof e<"u"&&typeof e!==null}function mg(){const e=js();return new Promise(t=>{switch(e){case It.browser:t(d_());break;case It.reactNative:t(g_());break;case It.node:t(p_());break;default:t(!0)}})}function d_(){return mi()&&navigator?.onLine}async function g_(){if(er()&&typeof global<"u"&&global!=null&&global.NetInfo){const e=await(global==null?void 0:global.NetInfo.fetch());return e?.isConnected}return!0}function p_(){return!0}function b_(e){switch(js()){case It.browser:y_(e);break;case It.reactNative:m_(e);break}}function y_(e){!er()&&mi()&&(window.addEventListener("online",()=>e(!0)),window.addEventListener("offline",()=>e(!1)))}function m_(e){er()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(t=>e(t?.isConnected))}function w_(){var e;return mi()&&br()?((e=br())==null?void 0:e.visibilityState)==="visible":!0}function E_({logger:e,name:t}){const n=typeof e=="string"?Mf({opts:{level:e,name:t}}).logger:e;return n.level=typeof e=="string"?e:e.level,n}var v_=Object.defineProperty,__=(e,t,n)=>t in e?v_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ft=(e,t,n)=>__(e,typeof t!="symbol"?t+"":t,n);class wg{constructor(t,n){this.core=t,this.logger=n,Ft(this,"keychain",new Map),Ft(this,"name",Kf),Ft(this,"version",Gf),Ft(this,"initialized",!1),Ft(this,"storagePrefix",Et),Ft(this,"init",async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}}),Ft(this,"has",r=>(this.isInitialized(),this.keychain.has(r))),Ft(this,"set",async(r,i)=>{this.isInitialized(),this.keychain.set(r,i),await this.persist()}),Ft(this,"get",r=>{this.isInitialized();const i=this.keychain.get(r);if(typeof i>"u"){const{message:s}=oe("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(s)}return i}),Ft(this,"del",async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()}),this.core=t,this.logger=it(n,this.name)}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,sc(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?oc(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}}var x_=Object.defineProperty,S_=(e,t,n)=>t in e?x_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Se=(e,t,n)=>S_(e,typeof t!="symbol"?t+"":t,n);class Eg{constructor(t,n,r){this.core=t,this.logger=n,Se(this,"name",Hf),Se(this,"keychain"),Se(this,"randomSessionIdentifier",Uc()),Se(this,"initialized",!1),Se(this,"clientId"),Se(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Se(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),Se(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const i=await this.getClientSeed(),s=bl(i),o=pl(s.publicKey);return this.clientId=o,o}),Se(this,"generateKeyPair",()=>{this.isInitialized();const i=z4();return this.setPrivateKey(i.publicKey,i.privateKey)}),Se(this,"signJWT",async i=>{this.isInitialized();const s=await this.getClientSeed(),o=bl(s),a=this.randomSessionIdentifier;return await Uw(a,i,Vf,o)}),Se(this,"generateSharedKey",(i,s,o)=>{this.isInitialized();const a=this.getPrivateKey(i),f=q4(a,s);return this.setSymKey(f,o)}),Se(this,"setSymKey",async(i,s)=>{this.isInitialized();const o=s||H4(i);return await this.keychain.set(o,i),o}),Se(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),Se(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),Se(this,"encode",async(i,s,o)=>{this.isInitialized();const a=ug(o),f=zn(s);if(hg(a))return G4(f,o?.encoding);if(lg(a)){const h=a.senderPublicKey,l=a.receiverPublicKey;i=await this.generateSharedKey(h,l)}const c=this.getSymKey(i),{type:u,senderPublicKey:d}=a;return V4({type:u,symKey:c,message:f,senderPublicKey:d,encoding:o?.encoding})}),Se(this,"decode",async(i,s,o)=>{this.isInitialized();const a=Y4(s,o);if(hg(a)){const f=Z4(s,o?.encoding);return fr(f)}if(lg(a)){const f=a.receiverPublicKey,c=a.senderPublicKey;i=await this.generateSharedKey(f,c)}try{const f=this.getSymKey(i),c=K4({symKey:f,encoded:s,encoding:o?.encoding});return fr(c)}catch(f){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(f)}}),Se(this,"getPayloadType",(i,s=sr)=>{const o=Ai({encoded:i,encoding:s});return or(o.type)}),Se(this,"getPayloadSenderPublicKey",(i,s=sr)=>{const o=Ai({encoded:i,encoding:s});return o.senderPublicKey?Qe(o.senderPublicKey,Ve):void 0}),this.core=t,this.logger=it(n,this.name),this.keychain=r||new wg(this.core,this.logger)}get context(){return rt(this.logger)}async setPrivateKey(t,n){return await this.keychain.set(t,n),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(Ao)}catch{t=Uc(),await this.keychain.set(Ao,t)}return ot(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}}var I_=Object.defineProperty,O_=Object.defineProperties,B_=Object.getOwnPropertyDescriptors,vg=Object.getOwnPropertySymbols,D_=Object.prototype.hasOwnProperty,A_=Object.prototype.propertyIsEnumerable,Mc=(e,t,n)=>t in e?I_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,T_=(e,t)=>{for(var n in t||(t={}))D_.call(t,n)&&Mc(e,n,t[n]);if(vg)for(var n of vg(t))A_.call(t,n)&&Mc(e,n,t[n]);return e},R_=(e,t)=>O_(e,B_(t)),ut=(e,t,n)=>Mc(e,typeof t!="symbol"?t+"":t,n);class _g extends D1{constructor(t,n){super(t,n),this.logger=t,this.core=n,ut(this,"messages",new Map),ut(this,"messagesWithoutClientAck",new Map),ut(this,"name",Zf),ut(this,"version",Yf),ut(this,"initialized",!1),ut(this,"storagePrefix",Et),ut(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}}),ut(this,"set",async(r,i,s)=>{this.isInitialized();const o=ro(i);let a=this.messages.get(r);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(r,a),s===Xr.inbound){const f=this.messagesWithoutClientAck.get(r)||{};this.messagesWithoutClientAck.set(r,R_(T_({},f),{[o]:i}))}return await this.persist(),o}),ut(this,"get",r=>{this.isInitialized();let i=this.messages.get(r);return typeof i>"u"&&(i={}),i}),ut(this,"getWithoutAck",r=>{this.isInitialized();const i={};for(const s of r){const o=this.messagesWithoutClientAck.get(s)||{};i[s]=Object.values(o)}return i}),ut(this,"has",(r,i)=>{this.isInitialized();const s=this.get(r),o=ro(i);return typeof s[o]<"u"}),ut(this,"ack",async(r,i)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(r);if(typeof s>"u")return;const o=ro(i);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(r):this.messagesWithoutClientAck.set(r,s),await this.persist()}),ut(this,"del",async r=>{this.isInitialized(),this.messages.delete(r),this.messagesWithoutClientAck.delete(r),await this.persist()}),this.logger=it(t,this.name),this.core=n}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,sc(t))}async setRelayerMessagesWithoutClientAck(t){await this.core.storage.setItem(this.storageKeyWithoutClientAck,sc(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?oc(t):void 0}async getRelayerMessagesWithoutClientAck(){const t=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof t<"u"?oc(t):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}}const N_="PARSE_ERROR",C_="INVALID_REQUEST",P_="METHOD_NOT_FOUND",$_="INVALID_PARAMS",xg="INTERNAL_ERROR",kc="SERVER_ERROR",L_=[-32700,-32600,-32601,-32602,-32603],Ri={[N_]:{code:-32700,message:"Parse error"},[C_]:{code:-32600,message:"Invalid Request"},[P_]:{code:-32601,message:"Method not found"},[$_]:{code:-32602,message:"Invalid params"},[xg]:{code:-32603,message:"Internal error"},[kc]:{code:-32e3,message:"Server error"}},Sg=kc;function U_(e){return L_.includes(e)}function Ig(e){return Object.keys(Ri).includes(e)?Ri[e]:Ri[Sg]}function F_(e){const t=Object.values(Ri).find(n=>n.code===e);return t||Ri[Sg]}function j_(e,t,n){return e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${n} RPC url at ${t}`):e}var Og={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var zc=function(e,t){return zc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},zc(e,t)};function M_(e,t){zc(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var qc=function(){return qc=Object.assign||function(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},qc.apply(this,arguments)};function k_(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function z_(e,t,n,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}function q_(e,t){return function(n,r){t(n,r,e)}}function H_(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function V_(e,t,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function f(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,f)}c((r=r.apply(e,t||[])).next())})}function K_(e,t){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return f([c,u])}}function f(c){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=t.call(e,n)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function G_(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}function Z_(e,t){for(var n in e)n!=="default"&&!t.hasOwnProperty(n)&&(t[n]=e[n])}function Hc(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Bg(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,s=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function Y_(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Bg(arguments[t]));return e}function W_(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function Ni(e){return this instanceof Ni?(this.v=e,this):new Ni(e)}function X_(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(e,t||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(h){r[h]&&(i[h]=function(l){return new Promise(function(b,m){s.push([h,l,b,m])>1||a(h,l)})})}function a(h,l){try{f(r[h](l))}catch(b){d(s[0][3],b)}}function f(h){h.value instanceof Ni?Promise.resolve(h.value.v).then(c,u):d(s[0][2],h)}function c(h){a("next",h)}function u(h){a("throw",h)}function d(h,l){h(l),s.shift(),s.length&&a(s[0][0],s[0][1])}}function J_(e){var t,n;return t={},r("next"),r("throw",function(i){throw i}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(i,s){t[i]=e[i]?function(o){return(n=!n)?{value:Ni(e[i](o)),done:i==="return"}:s?s(o):o}:s}}function Q_(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof Hc=="function"?Hc(e):e[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=e[s]&&function(o){return new Promise(function(a,f){o=e[s](o),i(a,f,o.done,o.value)})}}function i(s,o,a,f){Promise.resolve(f).then(function(c){s({value:c,done:a})},o)}}function e5(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function t5(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function n5(e){return e&&e.__esModule?e:{default:e}}function r5(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function i5(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n}var s5=Object.freeze({__proto__:null,__extends:M_,get __assign(){return qc},__rest:k_,__decorate:z_,__param:q_,__metadata:H_,__awaiter:V_,__generator:K_,__createBinding:G_,__exportStar:Z_,__values:Hc,__read:Bg,__spread:Y_,__spreadArrays:W_,__await:Ni,__asyncGenerator:X_,__asyncDelegator:J_,__asyncValues:Q_,__makeTemplateObject:e5,__importStar:t5,__importDefault:n5,__classPrivateFieldGet:r5,__classPrivateFieldSet:i5}),o5=nf(s5),an={},Dg;function a5(){if(Dg)return an;Dg=1,Object.defineProperty(an,"__esModule",{value:!0}),an.isBrowserCryptoAvailable=an.getSubtleCrypto=an.getBrowerCrypto=void 0;function e(){return Tt?.crypto||Tt?.msCrypto||{}}an.getBrowerCrypto=e;function t(){const r=e();return r.subtle||r.webkitSubtle}an.getSubtleCrypto=t;function n(){return!!e()&&!!t()}return an.isBrowserCryptoAvailable=n,an}var cn={},Ag;function c5(){if(Ag)return cn;Ag=1,Object.defineProperty(cn,"__esModule",{value:!0}),cn.isBrowser=cn.isNode=cn.isReactNative=void 0;function e(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}cn.isReactNative=e;function t(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}cn.isNode=t;function n(){return!e()&&!t()}return cn.isBrowser=n,cn}(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=o5;t.__exportStar(a5(),e),t.__exportStar(c5(),e)})(Og);function Tg(e=3){const t=Date.now()*Math.pow(10,e),n=Math.floor(Math.random()*Math.pow(10,e));return t+n}function so(e=6){return BigInt(Tg(e))}function Vc(e,t,n){return{id:n||Tg(),jsonrpc:"2.0",method:e,params:t}}function Rg(e,t){return{id:e,jsonrpc:"2.0",result:t}}function Ng(e,t,n){return{id:e,jsonrpc:"2.0",error:f5(t,n)}}function f5(e,t){return typeof e>"u"?Ig(xg):(typeof e=="string"&&(e=Object.assign(Object.assign({},Ig(kc)),{message:e})),typeof t<"u"&&(e.data=t),U_(e.code)&&(e=F_(e.code)),e)}class u5{}class l5 extends u5{constructor(){super()}}class h5 extends l5{constructor(t){super()}}const d5="^wss?:";function g5(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(!(!t||!t.length))return t[0]}function p5(e,t){const n=g5(e);return typeof n>"u"?!1:new RegExp(t).test(n)}function Cg(e){return p5(e,d5)}function b5(e){return new RegExp("wss?://localhost(:d{2,5})?").test(e)}function Pg(e){return typeof e=="object"&&"id"in e&&"jsonrpc"in e&&e.jsonrpc==="2.0"}function $g(e){return Pg(e)&&"method"in e}function Kc(e){return Pg(e)&&(Lg(e)||oo(e))}function Lg(e){return"result"in e}function oo(e){return"error"in e}class y5 extends h5{constructor(t){super(t),this.events=new lt.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,n){this.events.on(t,n)}once(t,n){this.events.once(t,n)}off(t,n){this.events.off(t,n)}removeListener(t,n){this.events.removeListener(t,n)}async request(t,n){return this.requestStrict(Vc(t.method,t.params||[],t.id||so().toString()),n)}async requestStrict(t,n){return new Promise(async(r,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${t.id}`,s=>{oo(s)?i(s.error):r(s.result)});try{await this.connection.send(t,n)}catch(s){i(s)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),Kc(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const m5=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),w5=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Ug=e=>e.split("?")[0],Fg=10,E5=m5();class v5{constructor(t){if(this.url=t,this.events=new lt.exports.EventEmitter,this.registering=!1,!Cg(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,n){this.events.on(t,n)}once(t,n){this.events.once(t,n)}off(t,n){this.events.off(t,n)}removeListener(t,n){this.events.removeListener(t,n)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,n)=>{if(typeof this.socket>"u"){n(new Error("Connection already closed"));return}this.socket.onclose=r=>{this.onClose(r),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(zn(t))}catch(n){this.onError(t.id,n)}}register(t=this.url){if(!Cg(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const n=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=n||this.events.listenerCount("open")>=n)&&this.events.setMaxListeners(n+1),new Promise((r,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=t,this.registering=!0,new Promise((n,r)=>{const i=Og.isReactNative()?void 0:{rejectUnauthorized:!b5(t)},s=new E5(t,[],i);w5()?s.onerror=o=>{const a=o;r(this.emitError(a.error))}:s.on("error",o=>{r(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),n(s)}})}onOpen(t){t.onmessage=n=>this.onPayload(n),t.onclose=n=>this.onClose(n),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const n=typeof t.data=="string"?fr(t.data):t.data;this.events.emit("payload",n)}onError(t,n){const r=this.parseError(n),i=r.message||r.toString(),s=Ng(t,i);this.events.emit("payload",s)}parseError(t,n=this.url){return j_(t,Ug(n),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Fg&&this.events.setMaxListeners(Fg)}emitError(t){const n=this.parseError(new Error(t?.message||`WebSocket connection failed for host: ${Ug(this.url)}`));return this.events.emit("register_error",n),n}}var _5=Object.defineProperty,x5=Object.defineProperties,S5=Object.getOwnPropertyDescriptors,jg=Object.getOwnPropertySymbols,I5=Object.prototype.hasOwnProperty,O5=Object.prototype.propertyIsEnumerable,Gc=(e,t,n)=>t in e?_5(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,qr=(e,t)=>{for(var n in t||(t={}))I5.call(t,n)&&Gc(e,n,t[n]);if(jg)for(var n of jg(t))O5.call(t,n)&&Gc(e,n,t[n]);return e},Mg=(e,t)=>x5(e,S5(t)),wt=(e,t,n)=>Gc(e,typeof t!="symbol"?t+"":t,n);class B5 extends A1{constructor(t,n){super(t,n),this.relayer=t,this.logger=n,wt(this,"events",new lt.exports.EventEmitter),wt(this,"name",Xf),wt(this,"queue",new Map),wt(this,"publishTimeout",W.toMiliseconds(W.ONE_MINUTE)),wt(this,"initialPublishTimeout",W.toMiliseconds(W.ONE_SECOND*15)),wt(this,"needsTransportRestart",!1),wt(this,"publish",async(r,i,s)=>{var o,a,f,c,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:i,opts:s}});const d=s?.ttl||Wf,h=s?.prompt||!1,l=s?.tag||0,b=s?.id||so().toString(),m=kr(io().protocol),v={id:b,method:s?.publishMethod||m.publish,params:qr({topic:r,message:i,ttl:d,prompt:h,tag:l,attestation:s?.attestation},s?.tvf)},D=`Failed to publish payload, please try again. id:${b} tag:${l}`;try{zr((o=v.params)==null?void 0:o.prompt)&&((a=v.params)==null||delete a.prompt),zr((f=v.params)==null?void 0:f.tag)&&((c=v.params)==null||delete c.tag);const C=new Promise(async x=>{const _=({id:$})=>{var F;((F=v.id)==null?void 0:F.toString())===$.toString()&&(this.removeRequestFromQueue($),this.relayer.events.removeListener(be.publish,_),x())};this.relayer.events.on(be.publish,_);const R=Lt(new Promise(($,F)=>{this.rpcPublish(v,s).then($).catch(U=>{this.logger.warn(U,U?.message),F(U)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${b} tag:${l}`);try{await R,this.events.removeListener(be.publish,_)}catch($){this.queue.set(b,{request:v,opts:s,attempt:1}),this.logger.warn($,$?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:b,topic:r,message:i,opts:s}}),await Lt(C,this.publishTimeout,D)}catch(C){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(C),(u=s?.internal)!=null&&u.throwOnFailedPublish)throw C}finally{this.queue.delete(b)}}),wt(this,"publishCustom",async r=>{var i,s,o,a,f;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:r});const{payload:c,opts:u={}}=r,{attestation:d,tvf:h,publishMethod:l,prompt:b,tag:m,ttl:v=W.FIVE_MINUTES}=u,D=u.id||so().toString(),C=kr(io().protocol),x=l||C.publish,_={id:D,method:x,params:qr(Mg(qr({},c),{ttl:v,prompt:b,tag:m,attestation:d}),h)},R=`Failed to publish custom payload, please try again. id:${D} tag:${m}`;try{zr((i=_.params)==null?void 0:i.prompt)&&((s=_.params)==null||delete s.prompt),zr((o=_.params)==null?void 0:o.tag)&&((a=_.params)==null||delete a.tag);const $=new Promise(async F=>{const U=({id:q})=>{var k;((k=_.id)==null?void 0:k.toString())===q.toString()&&(this.removeRequestFromQueue(q),this.relayer.events.removeListener(be.publish,U),F())};this.relayer.events.on(be.publish,U);const A=Lt(new Promise((q,k)=>{this.rpcPublish(_,u).then(q).catch(E=>{this.logger.warn(E,E?.message),k(E)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${x} id:${D} tag:${m}`);try{await A,this.events.removeListener(be.publish,U)}catch(q){this.queue.set(D,{request:_,opts:u,attempt:1}),this.logger.warn(q,q?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:D,payload:c,opts:u}}),await Lt($,this.publishTimeout,R)}catch($){if(this.logger.debug("Failed to Publish Payload"),this.logger.error($),(f=u?.internal)!=null&&f.throwOnFailedPublish)throw $}finally{this.queue.delete(D)}}),wt(this,"on",(r,i)=>{this.events.on(r,i)}),wt(this,"once",(r,i)=>{this.events.once(r,i)}),wt(this,"off",(r,i)=>{this.events.off(r,i)}),wt(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.relayer=t,this.logger=it(n,this.name),this.registerEventListeners()}get context(){return rt(this.logger)}async rpcPublish(t,n){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:t});const r=await this.relayer.request(t);return this.relayer.events.emit(be.publish,qr(qr({},t),n)),this.logger.debug("Successfully Published Payload"),r}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async(t,n)=>{var r;const i=t.attempt+1;this.queue.set(n,Mg(qr({},t),{attempt:i})),this.logger.warn({},`Publisher: queue->publishing: ${t.request.id}, tag: ${(r=t.request.params)==null?void 0:r.tag}, attempt: ${i}`),await this.rpcPublish(t.request,t.opts),this.logger.warn({},`Publisher: queue->published: ${t.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Mn.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(be.connection_stalled);return}this.checkQueue()}),this.relayer.on(be.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}var D5=Object.defineProperty,A5=(e,t,n)=>t in e?D5(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Hr=(e,t,n)=>A5(e,typeof t!="symbol"?t+"":t,n);class T5{constructor(){Hr(this,"map",new Map),Hr(this,"set",(t,n)=>{const r=this.get(t);this.exists(t,n)||this.map.set(t,[...r,n])}),Hr(this,"get",t=>this.map.get(t)||[]),Hr(this,"exists",(t,n)=>this.get(t).includes(n)),Hr(this,"delete",(t,n)=>{if(typeof n>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const r=this.get(t);if(!this.exists(t,n))return;const i=r.filter(s=>s!==n);if(!i.length){this.map.delete(t);return}this.map.set(t,i)}),Hr(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var R5=Object.defineProperty,N5=Object.defineProperties,C5=Object.getOwnPropertyDescriptors,kg=Object.getOwnPropertySymbols,P5=Object.prototype.hasOwnProperty,$5=Object.prototype.propertyIsEnumerable,Zc=(e,t,n)=>t in e?R5(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ci=(e,t)=>{for(var n in t||(t={}))P5.call(t,n)&&Zc(e,n,t[n]);if(kg)for(var n of kg(t))$5.call(t,n)&&Zc(e,n,t[n]);return e},Yc=(e,t)=>N5(e,C5(t)),fe=(e,t,n)=>Zc(e,typeof t!="symbol"?t+"":t,n);class zg extends N1{constructor(t,n){super(t,n),this.relayer=t,this.logger=n,fe(this,"subscriptions",new Map),fe(this,"topicMap",new T5),fe(this,"events",new lt.exports.EventEmitter),fe(this,"name",su),fe(this,"version",ou),fe(this,"pending",new Map),fe(this,"cached",[]),fe(this,"initialized",!1),fe(this,"storagePrefix",Et),fe(this,"subscribeTimeout",W.toMiliseconds(W.ONE_MINUTE)),fe(this,"initialSubscribeTimeout",W.toMiliseconds(W.ONE_SECOND*15)),fe(this,"clientId"),fe(this,"batchSubscribeTopicsLimit",500),fe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),fe(this,"subscribe",async(r,i)=>{var s;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}});try{const o=io(i),a={topic:r,relay:o,transportType:i?.transportType};(s=i?.internal)!=null&&s.skipSubscribe||this.pending.set(r,a);const f=await this.rpcSubscribe(r,o,i);return typeof f=="string"&&(this.onSubscribe(f,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}})),f}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),fe(this,"unsubscribe",async(r,i)=>{this.isInitialized(),typeof i?.id<"u"?await this.unsubscribeById(r,i.id,i):await this.unsubscribeByTopic(r,i)}),fe(this,"isSubscribed",r=>new Promise(i=>{i(this.topicMap.topics.includes(r))})),fe(this,"isKnownTopic",r=>new Promise(i=>{i(this.topicMap.topics.includes(r)||this.pending.has(r)||this.cached.some(s=>s.topic===r))})),fe(this,"on",(r,i)=>{this.events.on(r,i)}),fe(this,"once",(r,i)=>{this.events.once(r,i)}),fe(this,"off",(r,i)=>{this.events.off(r,i)}),fe(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),fe(this,"start",async()=>{await this.onConnect()}),fe(this,"stop",async()=>{await this.onDisconnect()}),fe(this,"restart",async()=>{await this.restore(),await this.onRestart()}),fe(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}),fe(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Mn.pulse,async()=>{await this.checkPending()}),this.events.on(Ge.created,async r=>{const i=Ge.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(Ge.deleted,async r=>{const i=Ge.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}),this.relayer=t,this.logger=it(n,this.name),this.clientId=""}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(t,n){let r=!1;try{r=this.getSubscription(t).topic===n}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,n){const r=this.topicMap.get(t);await Promise.all(r.map(async i=>await this.unsubscribeById(t,i,n)))}async unsubscribeById(t,n,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:n,opts:r}});try{const i=io(r);await this.restartToComplete({topic:t,id:n,relay:i}),await this.rpcUnsubscribe(t,n,i);const s=Ti("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,n,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:n,opts:r}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(t,n,r){var i,s;const o=await this.getSubscriptionId(t);if((i=r?.internal)!=null&&i.skipSubscribe)return o;(!r||r?.transportType===Hn.relay)&&await this.restartToComplete({topic:t,id:t,relay:n});const a={method:kr(n.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const f=(s=r?.internal)==null?void 0:s.throwOnFailedPublish;try{if(r?.transportType===Hn.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(d=>this.logger.warn(d))},W.toMiliseconds(W.ONE_SECOND)),o;const c=new Promise(async d=>{const h=l=>{l.topic===t&&(this.events.removeListener(Ge.created,h),d(l.id))};this.events.on(Ge.created,h);try{const l=await Lt(new Promise((b,m)=>{this.relayer.request(a).catch(v=>{this.logger.warn(v,v?.message),m(v)}).then(b)}),this.initialSubscribeTimeout,`Subscribing to ${t} failed, please try again`);this.events.removeListener(Ge.created,h),d(l)}catch{}}),u=await Lt(c,this.subscribeTimeout,`Subscribing to ${t} failed, please try again`);if(!u&&f)throw new Error(`Subscribing to ${t} failed, please try again`);return u?o:null}catch(c){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(be.connection_stalled),f)throw c}return null}async rpcBatchSubscribe(t){if(!t.length)return;const n=t[0].relay,r={method:kr(n.protocol).batchSubscribe,params:{topics:t.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await Lt(new Promise(i=>{this.relayer.request(r).catch(s=>this.logger.warn(s)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(be.connection_stalled)}}async rpcBatchFetchMessages(t){if(!t.length)return;const n=t[0].relay,r={method:kr(n.protocol).batchFetchMessages,params:{topics:t.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});let i;try{i=await await Lt(new Promise((s,o)=>{this.relayer.request(r).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(be.connection_stalled)}return i}rpcUnsubscribe(t,n,r){const i={method:kr(r.protocol).unsubscribe,params:{topic:t,id:n}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(t,n){this.setSubscription(t,Yc(Ci({},n),{id:t})),this.pending.delete(n.topic)}onBatchSubscribe(t){t.length&&t.forEach(n=>{this.setSubscription(n.id,Ci({},n)),this.pending.delete(n.topic)})}async onUnsubscribe(t,n,r){this.events.removeAllListeners(n),this.hasSubscription(n,t)&&this.deleteSubscription(n,r),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,n){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:n}),this.addSubscription(t,n)}addSubscription(t,n){this.subscriptions.set(t,Ci({},n)),this.topicMap.set(n.topic,t),this.events.emit(Ge.created,n)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const n=this.subscriptions.get(t);if(!n){const{message:r}=oe("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(r)}return n}deleteSubscription(t,n){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:n});const r=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(r.topic,t),this.events.emit(Ge.deleted,Yc(Ci({},r),{reason:n}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ge.sync)}async onRestart(){if(this.cached.length){const t=[...this.cached],n=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<n;r++){const i=t.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(Ge.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size&&!t.every(n=>{var r;return n.topic===((r=this.subscriptions.get(n.id))==null?void 0:r.topic)})){const{message:n}=oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(n)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){t.length&&(await this.rpcBatchSubscribe(t),this.onBatchSubscribe(await Promise.all(t.map(async n=>Yc(Ci({},n),{id:await this.getSubscriptionId(n.topic)})))))}async batchFetchMessages(t){if(!t.length)return;this.logger.trace(`Fetching batch messages for ${t.length} subscriptions`);const n=await this.rpcBatchFetchMessages(t);n&&n.messages&&(await q8(W.toMiliseconds(W.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(n.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(t){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(t),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(t){return ro(t+await this.getClientId())}}var L5=Object.defineProperty,qg=Object.getOwnPropertySymbols,U5=Object.prototype.hasOwnProperty,F5=Object.prototype.propertyIsEnumerable,Wc=(e,t,n)=>t in e?L5(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Hg=(e,t)=>{for(var n in t||(t={}))U5.call(t,n)&&Wc(e,n,t[n]);if(qg)for(var n of qg(t))F5.call(t,n)&&Wc(e,n,t[n]);return e},se=(e,t,n)=>Wc(e,typeof t!="symbol"?t+"":t,n);class Vg extends T1{constructor(t){var n;super(t),se(this,"protocol","wc"),se(this,"version",2),se(this,"core"),se(this,"logger"),se(this,"events",new lt.exports.EventEmitter),se(this,"provider"),se(this,"messages"),se(this,"subscriber"),se(this,"publisher"),se(this,"name",eu),se(this,"transportExplicitlyClosed",!1),se(this,"initialized",!1),se(this,"connectionAttemptInProgress",!1),se(this,"relayUrl"),se(this,"projectId"),se(this,"packageName"),se(this,"bundleId"),se(this,"hasExperiencedNetworkDisruption",!1),se(this,"pingTimeout"),se(this,"heartBeatTimeout",W.toMiliseconds(W.THIRTY_SECONDS+W.FIVE_SECONDS)),se(this,"reconnectTimeout"),se(this,"connectPromise"),se(this,"reconnectInProgress",!1),se(this,"requestsInFlight",[]),se(this,"connectTimeout",W.toMiliseconds(W.ONE_SECOND*15)),se(this,"request",async r=>{var i,s;this.logger.debug("Publishing Request Payload");const o=r.id||so().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:r.method,topic:(i=r.params)==null?void 0:i.topic},"relayer.request - publishing...");const a=`${o}:${((s=r.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(a);const f=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==a),f}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),se(this,"resetPingTimeout",()=>{Fs()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,i,s,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null?void 0:s.terminate)==null||o.call(s)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),se(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),se(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit(be.connect)}),se(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),se(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(be.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),se(this,"registerProviderListeners",()=>{this.provider.on(st.payload,this.onPayloadHandler),this.provider.on(st.connect,this.onConnectHandler),this.provider.on(st.disconnect,this.onDisconnectHandler),this.provider.on(st.error,this.onProviderErrorHandler)}),this.core=t.core,this.logger=E_({logger:(n=t.logger)!=null?n:Qf,name:this.name}),this.messages=new _g(this.logger,t.core),this.subscriber=new zg(this,this.logger),this.publisher=new B5(this,this.logger),this.projectId=t?.projectId,this.relayUrl=t?.relayUrl||To,N8()?this.packageName=qd():C8()&&(this.bundleId=qd()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(t=>this.logger.warn(t,t?.message))}get context(){return rt(this.logger)}get connected(){var t,n,r;return((r=(n=(t=this.provider)==null?void 0:t.connection)==null?void 0:n.socket)==null?void 0:r.readyState)===1||!1}get connecting(){var t,n,r;return((r=(n=(t=this.provider)==null?void 0:t.connection)==null?void 0:n.socket)==null?void 0:r.readyState)===0||this.connectPromise!==void 0||!1}async publish(t,n,r){this.isInitialized(),await this.publisher.publish(t,n,r),await this.recordMessageEvent({topic:t,message:n,publishedAt:Date.now(),transportType:Hn.relay},Xr.outbound)}async publishCustom(t){this.isInitialized(),await this.publisher.publishCustom(t)}async subscribe(t,n){var r,i,s;this.isInitialized(),(!(n!=null&&n.transportType)||n?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((r=n?.internal)==null?void 0:r.throwOnFailedPublish)>"u"?!0:(i=n?.internal)==null?void 0:i.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"",f;const c=u=>{u.topic===t&&(this.subscriber.off(Ge.created,c),f())};return await Promise.all([new Promise(u=>{f=u,this.subscriber.on(Ge.created,c)}),new Promise(async(u,d)=>{a=await this.subscriber.subscribe(t,Hg({internal:{throwOnFailedPublish:o}},n)).catch(h=>{o&&d(h)})||a,u()})]),a}async unsubscribe(t,n){this.isInitialized(),await this.subscriber.unsubscribe(t,n)}on(t,n){this.events.on(t,n)}once(t,n){this.events.once(t,n)}off(t,n){this.events.off(t,n)}removeListener(t,n){this.events.removeListener(t,n)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Lt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(t){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(n,r)=>{await this.connect(t).then(n).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(t){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await mg())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(t){if(t?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const n=t.sort((r,i)=>r.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${n.length} message events sorted`);for(const r of n)try{await this.onMessageEvent(r)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+i?.message)}this.logger.trace(`Batch of ${n.length} message events processed`)}async onLinkMessageEvent(t,n){const{topic:r}=t;if(!n.sessionExists){const i=wi(W.FIVE_MINUTES),s={topic:r,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(r,s)}this.events.emit(be.message,t),await this.recordMessageEvent(t,Xr.inbound)}async connect(t){await this.confirmOnlineStateOrThrow(),t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let n=1;for(;n<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${n}...`),await this.createProvider(),await new Promise(async(r,i)=>{const s=()=>{i(new Error("Connection interrupted while trying to connect"))};this.provider.once(st.disconnect,s),await Lt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(st.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const f=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(st.disconnect,f),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(st.disconnect,f)})}),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){await this.subscriber.stop();const i=r;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${n}`);break}await new Promise(r=>setTimeout(r,W.toMiliseconds(n*1))),n++}}startPingTimeout(){var t,n,r,i,s;if(Fs())try{(n=(t=this.provider)==null?void 0:t.connection)!=null&&n.socket&&((s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new y5(new v5(F8({sdkVersion:Yi,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(t,n){const{topic:r,message:i}=t;await this.messages.set(r,i,n)}async shouldIgnoreMessageEvent(t){const{topic:n,message:r}=t;if(!r||r.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(n))return this.logger.warn(`Ignoring message for unknown topic ${n}`),!0;const i=this.messages.has(n,r);return i&&this.logger.warn(`Ignoring duplicate message: ${r}`),i}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),$g(t)){if(!t.method.endsWith(tu))return;const n=t.params,{topic:r,message:i,publishedAt:s,attestation:o}=n.data,a={topic:r,message:i,publishedAt:s,transportType:Hn.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Hg({type:"event",event:n.id},a)),this.events.emit(n.id,a),await this.acknowledgePayload(t),await this.onMessageEvent(a)}else Kc(t)&&this.events.emit(be.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(await this.recordMessageEvent(t,Xr.inbound),this.events.emit(be.message,t))}async acknowledgePayload(t){const n=Rg(t.id,!0);await this.provider.connection.send(n)}unregisterProviderListeners(){this.provider.off(st.payload,this.onPayloadHandler),this.provider.off(st.connect,this.onConnectHandler),this.provider.off(st.disconnect,this.onDisconnectHandler),this.provider.off(st.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let t=await mg();b_(async n=>{t!==n&&(t=n,n?await this.transportOpen().catch(r=>this.logger.error(r,r?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Mn.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&w_())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(n){this.logger.warn(n,n?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(be.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(t=>this.logger.error(t,t?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},W.toMiliseconds(nu)))))}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function j5(e,t){return e===t||Number.isNaN(e)&&Number.isNaN(t)}function Kg(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function Gg(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const M5="[object RegExp]",k5="[object String]",z5="[object Number]",q5="[object Boolean]",Zg="[object Arguments]",H5="[object Symbol]",V5="[object Date]",K5="[object Map]",G5="[object Set]",Z5="[object Array]",Y5="[object Function]",W5="[object ArrayBuffer]",Xc="[object Object]",X5="[object Error]",J5="[object DataView]",Q5="[object Uint8Array]",ex="[object Uint8ClampedArray]",tx="[object Uint16Array]",nx="[object Uint32Array]",rx="[object BigUint64Array]",ix="[object Int8Array]",sx="[object Int16Array]",ox="[object Int32Array]",ax="[object BigInt64Array]",cx="[object Float32Array]",fx="[object Float64Array]";function ux(){}function Yg(e){if(!e||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype||Object.getPrototypeOf(t)===null?Object.prototype.toString.call(e)==="[object Object]":!1}function lx(e,t,n){return Pi(e,t,void 0,void 0,void 0,void 0,n)}function Pi(e,t,n,r,i,s,o){const a=o(e,t,n,r,i,s);if(a!==void 0)return a;if(typeof e==typeof t)switch(typeof e){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return e===t;case"number":return e===t||Object.is(e,t);case"function":return e===t;case"object":return $i(e,t,s,o)}return $i(e,t,s,o)}function $i(e,t,n,r){if(Object.is(e,t))return!0;let i=Gg(e),s=Gg(t);if(i===Zg&&(i=Xc),s===Zg&&(s=Xc),i!==s)return!1;switch(i){case k5:return e.toString()===t.toString();case z5:{const f=e.valueOf(),c=t.valueOf();return j5(f,c)}case q5:case V5:case H5:return Object.is(e.valueOf(),t.valueOf());case M5:return e.source===t.source&&e.flags===t.flags;case Y5:return e===t}n=n??new Map;const o=n.get(e),a=n.get(t);if(o!=null&&a!=null)return o===t;n.set(e,t),n.set(t,e);try{switch(i){case K5:{if(e.size!==t.size)return!1;for(const[f,c]of e.entries())if(!t.has(f)||!Pi(c,t.get(f),f,e,t,n,r))return!1;return!0}case G5:{if(e.size!==t.size)return!1;const f=Array.from(e.values()),c=Array.from(t.values());for(let u=0;u<f.length;u++){const d=f[u],h=c.findIndex(l=>Pi(d,l,void 0,e,t,n,r));if(h===-1)return!1;c.splice(h,1)}return!0}case Z5:case Q5:case ex:case tx:case nx:case rx:case ix:case sx:case ox:case ax:case cx:case fx:{if(typeof Buffer<"u"&&Buffer.isBuffer(e)!==Buffer.isBuffer(t)||e.length!==t.length)return!1;for(let f=0;f<e.length;f++)if(!Pi(e[f],t[f],f,e,t,n,r))return!1;return!0}case W5:return e.byteLength!==t.byteLength?!1:$i(new Uint8Array(e),new Uint8Array(t),n,r);case J5:return e.byteLength!==t.byteLength||e.byteOffset!==t.byteOffset?!1:$i(new Uint8Array(e),new Uint8Array(t),n,r);case X5:return e.name===t.name&&e.message===t.message;case Xc:{if(!($i(e.constructor,t.constructor,n,r)||Yg(e)&&Yg(t)))return!1;const c=[...Object.keys(e),...Kg(e)],u=[...Object.keys(t),...Kg(t)];if(c.length!==u.length)return!1;for(let d=0;d<c.length;d++){const h=c[d],l=e[h];if(!Object.hasOwn(t,h))return!1;const b=t[h];if(!Pi(l,b,h,e,t,n,r))return!1}return!0}default:return!1}}finally{n.delete(e),n.delete(t)}}function hx(e,t){return lx(e,t,ux)}var dx=Object.defineProperty,Wg=Object.getOwnPropertySymbols,gx=Object.prototype.hasOwnProperty,px=Object.prototype.propertyIsEnumerable,Jc=(e,t,n)=>t in e?dx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Xg=(e,t)=>{for(var n in t||(t={}))gx.call(t,n)&&Jc(e,n,t[n]);if(Wg)for(var n of Wg(t))px.call(t,n)&&Jc(e,n,t[n]);return e},nt=(e,t,n)=>Jc(e,typeof t!="symbol"?t+"":t,n);class Jg extends R1{constructor(t,n,r,i=Et,s=void 0){super(t,n,r,i),this.core=t,this.logger=n,this.name=r,nt(this,"map",new Map),nt(this,"version",ru),nt(this,"cached",[]),nt(this,"initialized",!1),nt(this,"getKey"),nt(this,"storagePrefix",Et),nt(this,"recentlyDeleted",[]),nt(this,"recentlyDeletedLimit",200),nt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!zr(o)?this.map.set(this.getKey(o),o):l_(o)?this.map.set(o.id,o):h_(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),nt(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),nt(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),nt(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(f=>hx(a[f],o[f]))):this.values)),nt(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const f=Xg(Xg({},this.getData(o)),a);this.map.set(o,f),await this.persist()}),nt(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=it(n,this.name),this.storagePrefix=i,this.getKey=s}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(t){this.recentlyDeleted.push(t),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const n=this.map.get(t);if(!n){if(this.recentlyDeleted.includes(t)){const{message:i}=oe("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${t}`);throw this.logger.error(i),new Error(i)}const{message:r}=oe("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(r),new Error(r)}return n}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:n}=oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}}var bx=Object.defineProperty,yx=(e,t,n)=>t in e?bx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ne=(e,t,n)=>yx(e,typeof t!="symbol"?t+"":t,n);class Qg{constructor(t,n){this.core=t,this.logger=n,ne(this,"name",au),ne(this,"version",cu),ne(this,"events",new lt.exports),ne(this,"pairings"),ne(this,"initialized",!1),ne(this,"storagePrefix",Et),ne(this,"ignoredPayloadTypes",[Mr]),ne(this,"registeredMethods",[]),ne(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),ne(this,"register",({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]}),ne(this,"create",async r=>{this.isInitialized();const i=Uc(),s=await this.core.crypto.setSymKey(i),o=wi(W.FIVE_MINUTES),a={protocol:Jf},f={topic:s,expiry:o,relay:a,active:!1,methods:r?.methods},c=bg({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:r?.methods});return this.events.emit(hr.create,f),this.core.expirer.set(s,o),await this.pairings.set(s,f),await this.core.relayer.subscribe(s,{transportType:r?.transportType,internal:r?.internal}),{topic:s,uri:c}}),ne(this,"pair",async r=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:r?.uri,trace:[Nt.pairing_started]}});this.isValidPair(r,i);const{topic:s,symKey:o,relay:a,expiryTimestamp:f,methods:c}=pg(r.uri);i.props.properties.topic=s,i.addTrace(Nt.pairing_uri_validation_success),i.addTrace(Nt.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(s)){if(u=this.pairings.get(s),i.addTrace(Nt.existing_pairing),u.active)throw i.setError(Mt.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);i.addTrace(Nt.pairing_not_expired)}const d=f||wi(W.FIVE_MINUTES),h={topic:s,relay:a,expiry:d,active:!1,methods:c};this.core.expirer.set(s,d),await this.pairings.set(s,h),i.addTrace(Nt.store_new_pairing),r.activatePairing&&await this.activate({topic:s}),this.events.emit(hr.create,h),i.addTrace(Nt.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),i.addTrace(Nt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(Mt.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(l){throw i.setError(Mt.subscribe_pairing_topic_failure),l}return i.addTrace(Nt.subscribe_pairing_topic_success),h}),ne(this,"activate",async({topic:r})=>{this.isInitialized();const i=wi(W.FIVE_MINUTES);this.core.expirer.set(r,i),await this.pairings.update(r,{active:!0,expiry:i})}),ne(this,"ping",async r=>{this.isInitialized(),await this.isValidPing(r),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=r;if(this.pairings.keys.includes(i)){const s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:f}=j8();this.events.once(ac("pairing_ping",s),({error:c})=>{c?f(c):a()}),await o()}}),ne(this,"updateExpiry",async({topic:r,expiry:i})=>{this.isInitialized(),await this.pairings.update(r,{expiry:i})}),ne(this,"updateMetadata",async({topic:r,metadata:i})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:i})}),ne(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),ne(this,"disconnect",async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",Ti("USER_DISCONNECTED")),await this.deletePairing(i))}),ne(this,"formatUriFromPairing",r=>{this.isInitialized();const{topic:i,relay:s,expiry:o,methods:a}=r,f=this.core.crypto.keychain.get(i);return bg({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:f,relay:s,expiryTimestamp:o,methods:a})}),ne(this,"sendRequest",async(r,i,s)=>{const o=Vc(i,s),a=await this.core.crypto.encode(r,o),f=lr[i].req;return this.core.history.set(r,o),this.core.relayer.publish(r,a,f),o.id}),ne(this,"sendResult",async(r,i,s)=>{const o=Rg(r,s),a=await this.core.crypto.encode(i,o),f=(await this.core.history.get(i,r)).request.method,c=lr[f].res;await this.core.relayer.publish(i,a,c),await this.core.history.resolve(o)}),ne(this,"sendError",async(r,i,s)=>{const o=Ng(r,s),a=await this.core.crypto.encode(i,o),f=(await this.core.history.get(i,r)).request.method,c=lr[f]?lr[f].res:lr.unregistered_method.res;await this.core.relayer.publish(i,a,c),await this.core.history.resolve(o)}),ne(this,"deletePairing",async(r,i)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,Ti("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),i?Promise.resolve():this.core.expirer.del(r)])}),ne(this,"cleanup",async()=>{const r=this.pairings.getAll().filter(i=>Kd(i.expiry));await Promise.all(r.map(i=>this.deletePairing(i.topic)))}),ne(this,"onRelayEventRequest",async r=>{const{topic:i,payload:s}=r;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,s);default:return await this.onUnknownRpcMethodRequest(i,s)}}),ne(this,"onRelayEventResponse",async r=>{const{topic:i,payload:s}=r,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}}),ne(this,"onPairingPingRequest",async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult(s,r,!0),this.events.emit(hr.ping,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),ne(this,"onPairingPingResponse",(r,i)=>{const{id:s}=i;setTimeout(()=>{Lg(i)?this.events.emit(ac("pairing_ping",s),{}):oo(i)&&this.events.emit(ac("pairing_ping",s),{error:i.error})},500)}),ne(this,"onPairingDeleteRequest",async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit(hr.delete,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),ne(this,"onUnknownRpcMethodRequest",async(r,i)=>{const{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=Ti("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,r,a),this.logger.error(a)}catch(a){await this.sendError(s,r,a),this.logger.error(a)}}),ne(this,"onUnknownRpcMethodResponse",r=>{this.registeredMethods.includes(r)||this.logger.error(Ti("WC_METHOD_UNSUPPORTED",r))}),ne(this,"isValidPair",(r,i)=>{var s;if(!jc(r)){const{message:a}=oe("MISSING_OR_INVALID",`pair() params: ${r}`);throw i.setError(Mt.malformed_pairing_uri),new Error(a)}if(!u_(r.uri)){const{message:a}=oe("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw i.setError(Mt.malformed_pairing_uri),new Error(a)}const o=pg(r?.uri);if(!((s=o?.relay)!=null&&s.protocol)){const{message:a}=oe("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(Mt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=oe("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(Mt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&W.toMiliseconds(o?.expiryTimestamp)<Date.now()){i.setError(Mt.pairing_expired);const{message:a}=oe("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),ne(this,"isValidPing",async r=>{if(!jc(r)){const{message:s}=oe("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidPairingTopic(i)}),ne(this,"isValidDisconnect",async r=>{if(!jc(r)){const{message:s}=oe("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidPairingTopic(i)}),ne(this,"isValidPairingTopic",async r=>{if(!yg(r,!1)){const{message:i}=oe("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.pairings.keys.includes(r)){const{message:i}=oe("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(Kd(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:i}=oe("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}),this.core=t,this.logger=it(n,this.name),this.pairings=new Jg(this.core,this.logger,this.name,this.storagePrefix)}get context(){return rt(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(be.message,async t=>{const{topic:n,message:r,transportType:i}=t;if(this.pairings.keys.includes(n)&&i!==Hn.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{const s=await this.core.crypto.decode(n,r);$g(s)?(this.core.history.set(n,s),await this.onRelayEventRequest({topic:n,payload:s})):Kc(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:n,payload:s}),this.core.history.delete(n,s.id)),await this.core.relayer.messages.ack(n,r)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(dt.expired,async t=>{const{topic:n}=z8(t.target);n&&this.pairings.keys.includes(n)&&(await this.deletePairing(n,!0),this.events.emit(hr.expire,{topic:n}))})}}var mx=Object.defineProperty,wx=(e,t,n)=>t in e?mx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ae=(e,t,n)=>wx(e,typeof t!="symbol"?t+"":t,n);class ep extends B1{constructor(t,n){super(t,n),this.core=t,this.logger=n,Ae(this,"records",new Map),Ae(this,"events",new lt.exports.EventEmitter),Ae(this,"name",fu),Ae(this,"version",uu),Ae(this,"cached",[]),Ae(this,"initialized",!1),Ae(this,"storagePrefix",Et),Ae(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ae(this,"set",(r,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:i,chainId:s}),this.records.has(i.id))return;const o={id:i.id,topic:r,request:{method:i.method,params:i.params||null},chainId:s,expiry:wi(W.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(ht.created,o)}),Ae(this,"resolve",async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const i=await this.getRecord(r.id);typeof i.response>"u"&&(i.response=oo(r)?{error:r.error}:{result:r.result},this.records.set(i.id,i),this.persist(),this.events.emit(ht.updated,i))}),Ae(this,"get",async(r,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:i}),await this.getRecord(i))),Ae(this,"delete",(r,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===r){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(ht.deleted,s)}}),this.persist()}),Ae(this,"exists",async(r,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===r:!1)),Ae(this,"on",(r,i)=>{this.events.on(r,i)}),Ae(this,"once",(r,i)=>{this.events.once(r,i)}),Ae(this,"off",(r,i)=>{this.events.off(r,i)}),Ae(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=it(n,this.name)}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(n=>{if(typeof n.response<"u")return;const r={topic:n.topic,request:Vc(n.request.method,n.request.params,n.id),chainId:n.chainId};return t.push(r)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const n=this.records.get(t);if(!n){const{message:r}=oe("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(r)}return n}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(ht.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:n}=oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(ht.created,t=>{const n=ht.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:t})}),this.events.on(ht.updated,t=>{const n=ht.updated;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:t})}),this.events.on(ht.deleted,t=>{const n=ht.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:t})}),this.core.heartbeat.on(Mn.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let t=!1;this.records.forEach(n=>{W.toMiliseconds(n.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${n.id}`),this.records.delete(n.id),this.events.emit(ht.deleted,n,!1),t=!0)}),t&&this.persist()}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}}var Ex=Object.defineProperty,vx=(e,t,n)=>t in e?Ex(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ue=(e,t,n)=>vx(e,typeof t!="symbol"?t+"":t,n);class tp extends C1{constructor(t,n){super(t,n),this.core=t,this.logger=n,Ue(this,"expirations",new Map),Ue(this,"events",new lt.exports.EventEmitter),Ue(this,"name",lu),Ue(this,"version",hu),Ue(this,"cached",[]),Ue(this,"initialized",!1),Ue(this,"storagePrefix",Et),Ue(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ue(this,"has",r=>{try{const i=this.formatTarget(r);return typeof this.getExpiration(i)<"u"}catch{return!1}}),Ue(this,"set",(r,i)=>{this.isInitialized();const s=this.formatTarget(r),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(dt.created,{target:s,expiration:o})}),Ue(this,"get",r=>{this.isInitialized();const i=this.formatTarget(r);return this.getExpiration(i)}),Ue(this,"del",r=>{if(this.isInitialized(),this.has(r)){const i=this.formatTarget(r),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(dt.deleted,{target:i,expiration:s})}}),Ue(this,"on",(r,i)=>{this.events.on(r,i)}),Ue(this,"once",(r,i)=>{this.events.once(r,i)}),Ue(this,"off",(r,i)=>{this.events.off(r,i)}),Ue(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=it(n,this.name)}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return M8(t);if(typeof t=="number")return k8(t);const{message:n}=oe("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(n)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(dt.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:n}=oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const n=this.expirations.get(t);if(!n){const{message:r}=oe("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.warn(r),new Error(r)}return n}checkExpiry(t,n){const{expiry:r}=n;W.toMiliseconds(r)-Date.now()<=0&&this.expire(t,n)}expire(t,n){this.expirations.delete(t),this.events.emit(dt.expired,{target:t,expiration:n})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,n)=>this.checkExpiry(n,t))}registerEventListeners(){this.core.heartbeat.on(Mn.pulse,()=>this.checkExpirations()),this.events.on(dt.created,t=>{const n=dt.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:t}),this.persist()}),this.events.on(dt.expired,t=>{const n=dt.expired;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:t}),this.persist()}),this.events.on(dt.deleted,t=>{const n=dt.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}}var _x=Object.defineProperty,xx=(e,t,n)=>t in e?_x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ye=(e,t,n)=>xx(e,typeof t!="symbol"?t+"":t,n);class np extends P1{constructor(t,n,r){super(t,n,r),this.core=t,this.logger=n,this.store=r,ye(this,"name",du),ye(this,"abortController"),ye(this,"isDevEnv"),ye(this,"verifyUrlV3",pu),ye(this,"storagePrefix",Et),ye(this,"version",Do),ye(this,"publicKey"),ye(this,"fetchPromise"),ye(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&W.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),ye(this,"register",async i=>{if(!mi()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=i,f=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const c=br(),u=this.startAbortTimer(W.ONE_SECOND*5),d=await new Promise((h,l)=>{const b=()=>{window.removeEventListener("message",v),c.body.removeChild(m),l("attestation aborted")};this.abortController.signal.addEventListener("abort",b);const m=c.createElement("iframe");m.src=f,m.style.display="none",m.addEventListener("error",b,{signal:this.abortController.signal});const v=D=>{if(D.data&&typeof D.data=="string")try{const C=JSON.parse(D.data);if(C.type==="verify_attestation"){if(Jo(C.attestation).payload.id!==o)return;clearInterval(u),c.body.removeChild(m),this.abortController.signal.removeEventListener("abort",b),window.removeEventListener("message",v),h(C.attestation===null?"":C.attestation)}}catch(C){this.logger.warn(C)}};c.body.appendChild(m),window.addEventListener("message",v,{signal:this.abortController.signal})});return this.logger.debug(d,"jwt attestation"),d}catch(c){this.logger.warn(c)}return""}),ye(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=i;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(Jo(s).payload.id!==a)return;const c=await this.isValidJwtAttestation(s);if(c){if(!c.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return c}}if(!o)return;const f=this.getVerifyUrl(i?.verifyUrl);return this.fetchAttestation(o,f)}),ye(this,"fetchAttestation",async(i,s)=>{this.logger.debug(`resolving attestation: ${i} from url: ${s}`);const o=this.startAbortTimer(W.ONE_SECOND*5),a=await fetch(`${s}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),ye(this,"getVerifyUrl",i=>{let s=i||Jr;return bu.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${Jr}`),s=Jr),s}),ye(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(W.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await s.json()}catch(i){this.logger.warn(i)}}),ye(this,"persistPublicKey",async i=>{this.logger.debug(i,"persisting public key to local storage"),await this.store.setItem(this.storeKey,i),this.publicKey=i}),ye(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),ye(this,"isValidJwtAttestation",async i=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(i,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),ye(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),ye(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),ye(this,"validateAttestation",(i,s)=>{const o=X4(i,s.publicKey),a={hasExpired:W.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=it(n,this.name),this.abortController=new AbortController,this.isDevEnv=Zd(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return rt(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),W.toMiliseconds(t))}}var Sx=Object.defineProperty,Ix=(e,t,n)=>t in e?Sx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,rp=(e,t,n)=>Ix(e,typeof t!="symbol"?t+"":t,n);class ip extends $1{constructor(t,n){super(t,n),this.projectId=t,this.logger=n,rp(this,"context",yu),rp(this,"registerDeviceToken",async r=>{const{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=r,f=`${mu}/${this.projectId}/clients`;await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})}),this.logger=it(n,this.context)}}var Ox=Object.defineProperty,sp=Object.getOwnPropertySymbols,Bx=Object.prototype.hasOwnProperty,Dx=Object.prototype.propertyIsEnumerable,Qc=(e,t,n)=>t in e?Ox(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Li=(e,t)=>{for(var n in t||(t={}))Bx.call(t,n)&&Qc(e,n,t[n]);if(sp)for(var n of sp(t))Dx.call(t,n)&&Qc(e,n,t[n]);return e},Ie=(e,t,n)=>Qc(e,typeof t!="symbol"?t+"":t,n);class op extends L1{constructor(t,n,r=!0){super(t,n,r),this.core=t,this.logger=n,Ie(this,"context",Eu),Ie(this,"storagePrefix",Et),Ie(this,"storageVersion",wu),Ie(this,"events",new Map),Ie(this,"shouldPersist",!1),Ie(this,"init",async()=>{if(!Zd())try{const i={eventId:Gd(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Hd(this.core.relayer.protocol,this.core.relayer.version,Yi)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),Ie(this,"createEvent",i=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:f}}=i,c=Gd(),u=this.core.projectId||"",d=Date.now(),h=Li({eventId:c,timestamp:d,props:{event:s,type:o,properties:{topic:a,trace:f}},bundleId:u,domain:this.getAppDomain()},this.setMethods(c));return this.telemetryEnabled&&(this.events.set(c,h),this.shouldPersist=!0),h}),Ie(this,"getEvent",i=>{const{eventId:s,topic:o}=i;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(f=>f.props.properties.topic===o);if(a)return Li(Li({},a),this.setMethods(a.eventId))}),Ie(this,"deleteEvent",i=>{const{eventId:s}=i;this.events.delete(s),this.shouldPersist=!0}),Ie(this,"setEventListeners",()=>{this.core.heartbeat.on(Mn.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{W.fromMiliseconds(Date.now())-W.fromMiliseconds(i.timestamp)>vu&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),Ie(this,"setMethods",i=>({addTrace:s=>this.addTrace(i,s),setError:s=>this.setError(i,s)})),Ie(this,"addTrace",(i,s)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(s),this.events.set(i,o),this.shouldPersist=!0)}),Ie(this,"setError",(i,s)=>{const o=this.events.get(i);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),Ie(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ie(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(s=>{this.events.set(s.eventId,Li(Li({},s),this.setMethods(s.eventId)))})}catch(i){this.logger.warn(i)}}),Ie(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[s,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const s of i)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),Ie(this,"sendEvent",async i=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${_u}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Yi}${s}`,{method:"POST",body:JSON.stringify(i)})}),Ie(this,"getAppDomain",()=>$8().url),this.logger=it(n,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var Ax=Object.defineProperty,ap=Object.getOwnPropertySymbols,Tx=Object.prototype.hasOwnProperty,Rx=Object.prototype.propertyIsEnumerable,ef=(e,t,n)=>t in e?Ax(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,cp=(e,t)=>{for(var n in t||(t={}))Tx.call(t,n)&&ef(e,n,t[n]);if(ap)for(var n of ap(t))Rx.call(t,n)&&ef(e,n,t[n]);return e},le=(e,t,n)=>ef(e,typeof t!="symbol"?t+"":t,n);class ao extends x1{constructor(t){var n;super(t),le(this,"protocol",Bo),le(this,"version",Do),le(this,"name",Wr),le(this,"relayUrl"),le(this,"projectId"),le(this,"customStoragePrefix"),le(this,"events",new lt.exports.EventEmitter),le(this,"logger"),le(this,"heartbeat"),le(this,"relayer"),le(this,"crypto"),le(this,"storage"),le(this,"history"),le(this,"expirer"),le(this,"pairing"),le(this,"verify"),le(this,"echoClient"),le(this,"linkModeSupportedApps"),le(this,"eventClient"),le(this,"initialized",!1),le(this,"logChunkController"),le(this,"on",(a,f)=>this.events.on(a,f)),le(this,"once",(a,f)=>this.events.once(a,f)),le(this,"off",(a,f)=>this.events.off(a,f)),le(this,"removeListener",(a,f)=>this.events.removeListener(a,f)),le(this,"dispatchEnvelope",({topic:a,message:f,sessionExists:c})=>{if(!a||!f)return;const u={topic:a,message:f,publishedAt:Date.now(),transportType:Hn.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:c})});const r=this.getGlobalCore(t?.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(a){console.warn("Failed to copy global core",a)}this.projectId=t?.projectId,this.relayUrl=t?.relayUrl||To,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const i=b1({level:typeof t?.logger=="string"&&t.logger?t.logger:zf.logger,name:Wr}),{logger:s,chunkLoggerController:o}=Mf({opts:i,maxSizeInBytes:t?.maxLogBlobSizeInBytes,loggerOverride:t?.logger});this.logChunkController=o,(n=this.logChunkController)!=null&&n.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,f;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((f=this.logChunkController)==null||f.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=it(s,this.name),this.heartbeat=new yo,this.crypto=new Eg(this,this.logger,t?.keychain),this.history=new ep(this,this.logger),this.expirer=new tp(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new Nb(cp(cp({},qf),t?.storageOptions)),this.relayer=new Vg({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Qg(this,this.logger),this.verify=new np(this,this.logger,this.storage),this.echoClient=new ip(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new op(this,this.logger,t?.telemetryEnabled),this.setGlobalCore(this)}static async init(t){const n=new ao(t);await n.initialize();const r=await n.crypto.getClientId();return await n.storage.setItem(iu,r),n}get context(){return rt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var t;return(t=this.logChunkController)==null?void 0:t.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(t){this.linkModeSupportedApps.includes(t)||(this.linkModeSupportedApps.push(t),await this.storage.setItem(Ro,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Ro)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(t,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(t.message),t}}getGlobalCore(t=""){try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${t}`,r=`${n}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[n]}catch(n){console.warn("Failed to get global WalletConnect core",n);return}}setGlobalCore(t){var n;try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${((n=t.opts)==null?void 0:n.customStoragePrefix)||""}`;globalThis[r]=t}catch(r){console.warn("Failed to set global WalletConnect core",r)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const Nx=ao;V.CORE_CONTEXT=Wr,V.CORE_DEFAULT=zf,V.CORE_PROTOCOL=Bo,V.CORE_STORAGE_OPTIONS=qf,V.CORE_STORAGE_PREFIX=Et,V.CORE_VERSION=Do,V.CRYPTO_CLIENT_SEED=Ao,V.CRYPTO_CONTEXT=Hf,V.CRYPTO_JWT_TTL=Vf,V.Core=Nx,V.Crypto=Eg,V.ECHO_CONTEXT=yu,V.ECHO_URL=mu,V.EVENTS_CLIENT_API_URL=_u,V.EVENTS_STORAGE_CLEANUP_INTERVAL=vu,V.EVENTS_STORAGE_CONTEXT=Eu,V.EVENTS_STORAGE_VERSION=wu,V.EVENT_CLIENT_AUTHENTICATE_ERRORS=Z1,V.EVENT_CLIENT_AUTHENTICATE_TRACES=G1,V.EVENT_CLIENT_CONTEXT=H1,V.EVENT_CLIENT_PAIRING_ERRORS=Mt,V.EVENT_CLIENT_PAIRING_TRACES=Nt,V.EVENT_CLIENT_SESSION_ERRORS=K1,V.EVENT_CLIENT_SESSION_TRACES=V1,V.EXPIRER_CONTEXT=lu,V.EXPIRER_DEFAULT_TTL=z1,V.EXPIRER_EVENTS=dt,V.EXPIRER_STORAGE_VERSION=hu,V.EchoClient=ip,V.EventClient=op,V.Expirer=tp,V.HISTORY_CONTEXT=fu,V.HISTORY_EVENTS=ht,V.HISTORY_STORAGE_VERSION=uu,V.JsonRpcHistory=ep,V.KEYCHAIN_CONTEXT=Kf,V.KEYCHAIN_STORAGE_VERSION=Gf,V.KeyChain=wg,V.MESSAGES_CONTEXT=Zf,V.MESSAGES_STORAGE_VERSION=Yf,V.MESSAGE_DIRECTION=Xr,V.MessageTracker=_g,V.PAIRING_CONTEXT=au,V.PAIRING_DEFAULT_TTL=k1,V.PAIRING_EVENTS=hr,V.PAIRING_RPC_OPTS=lr,V.PAIRING_STORAGE_VERSION=cu,V.PENDING_SUB_RESOLUTION_TIMEOUT=M1,V.PUBLISHER_CONTEXT=Xf,V.PUBLISHER_DEFAULT_TTL=Wf,V.Pairing=Qg,V.RELAYER_CONTEXT=eu,V.RELAYER_DEFAULT_LOGGER=Qf,V.RELAYER_DEFAULT_PROTOCOL=Jf,V.RELAYER_DEFAULT_RELAY_URL=To,V.RELAYER_EVENTS=be,V.RELAYER_PROVIDER_EVENTS=st,V.RELAYER_RECONNECT_TIMEOUT=nu,V.RELAYER_SDK_VERSION=Yi,V.RELAYER_STORAGE_OPTIONS=U1,V.RELAYER_SUBSCRIBER_SUFFIX=tu,V.RELAYER_TRANSPORT_CUTOFF=F1,V.Relayer=Vg,V.STORE_STORAGE_VERSION=ru,V.SUBSCRIBER_CONTEXT=su,V.SUBSCRIBER_DEFAULT_TTL=j1,V.SUBSCRIBER_EVENTS=Ge,V.SUBSCRIBER_STORAGE_VERSION=ou,V.Store=Jg,V.Subscriber=zg,V.TRANSPORT_TYPES=Hn,V.TRUSTED_VERIFY_URLS=bu,V.VERIFY_CONTEXT=du,V.VERIFY_SERVER=Jr,V.VERIFY_SERVER_V3=pu,V.Verify=np,V.WALLETCONNECT_CLIENT_ID=iu,V.WALLETCONNECT_LINK_MODE_APPS=Ro,V.default=ao,Object.defineProperty(V,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
